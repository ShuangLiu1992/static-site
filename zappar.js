!function(e){function r(){}function i(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],h(e,this)}function p(a,r){for(;3===a._state;)a=a._value;return 0===a._state?void a._deferreds.push(r):(a._handled=!0,void i._immediateFn(function(){var e=1===a._state?r.onFulfilled:r.onRejected;if(null!==e){var t;try{t=e(a._value)}catch(e){return void o(r.promise,e)}s(r.promise,t)}else(1===a._state?s:o)(r.promise,a._value)}))}function s(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var a=e.then;if(e instanceof i)return t._state=3,t._value=e,void n(t);if("function"==typeof a)return void h((r=a,p=e,function(){r.apply(p,arguments)}),t)}t._state=1,t._value=e,n(t)}catch(e){o(t,e)}var r,p}function o(e,t){e._state=2,e._value=t,n(e)}function n(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,a=e._deferreds.length;t<a;t++)p(e,e._deferreds[t]);e._deferreds=null}function _(e,t,a){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=a}function h(e,t){var a=!1;try{e(function(e){a||(a=!0,s(t,e))},function(e){a||(a=!0,o(t,e))})}catch(e){if(a)return;a=!0,o(t,e)}}var t=setTimeout;i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var a=new this.constructor(r);return p(this,new _(e,t,a)),a},i.all=function(e){var o=Array.prototype.slice.call(e);return new i(function(r,p){function i(t,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var a=e.then;if("function"==typeof a)return void a.call(e,function(e){i(t,e)},p)}o[t]=e,0==--s&&r(o)}catch(e){p(e)}}if(0===o.length)return r([]);for(var s=o.length,e=0;e<o.length;e++)i(e,o[e])})},i.resolve=function(t){return t&&"object"==typeof t&&t.constructor===i?t:new i(function(e){e(t)})},i.reject=function(a){return new i(function(e,t){t(a)})},i.race=function(p){return new i(function(e,t){for(var a=0,r=p.length;a<r;a++)p[a].then(e,t)})},i._immediateFn="function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){t(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},i._setImmediateFn=function(e){i._immediateFn=e},i._setUnhandledRejectionFn=function(e){i._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=i:e.Promise||(e.Promise=i)}(this),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.WHATWGFetch={})}(this,function(o){"use strict";var a="URLSearchParams"in self,r="Symbol"in self&&"iterator"in Symbol,n="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),p="FormData"in self,i="ArrayBuffer"in self;if(i)var t=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],s=ArrayBuffer.isView||function(e){return e&&-1<t.indexOf(Object.prototype.toString.call(e))};function _(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function h(e){return"string"!=typeof e&&(e=String(e)),e}function e(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return r&&(e[Symbol.iterator]=function(){return e}),e}function d(t){this.map={},t instanceof d?t.forEach(function(e,t){this.append(t,e)},this):Array.isArray(t)?t.forEach(function(e){this.append(e[0],e[1])},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function c(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function l(a){return new Promise(function(e,t){a.onload=function(){e(a.result)},a.onerror=function(){t(a.error)}})}function u(e){var t=new FileReader,a=l(t);return t.readAsArrayBuffer(e),a}function z(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function f(){return this.bodyUsed=!1,this._initBody=function(e){var t;(this._bodyInit=e)?"string"==typeof e?this._bodyText=e:n&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:p&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:a&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():i&&n&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=z(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):i&&(ArrayBuffer.prototype.isPrototypeOf(e)||s(e))?this._bodyArrayBuffer=z(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},n&&(this.blob=function(){var e=c(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?c(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(u)}),this.text=function(){var e,t,a,r=c(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,a=l(t),t.readAsText(e),a;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),a=new Array(t.length),r=0;r<t.length;r++)a[r]=String.fromCharCode(t[r]);return a.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},p&&(this.formData=function(){return this.text().then(g)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=_(e),t=h(t);var a=this.map[e];this.map[e]=a?a+", "+t:t},d.prototype.delete=function(e){delete this.map[_(e)]},d.prototype.get=function(e){return e=_(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(_(e))},d.prototype.set=function(e,t){this.map[_(e)]=h(t)},d.prototype.forEach=function(e,t){for(var a in this.map)this.map.hasOwnProperty(a)&&e.call(t,this.map[a],a,this)},d.prototype.keys=function(){var a=[];return this.forEach(function(e,t){a.push(t)}),e(a)},d.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),e(t)},d.prototype.entries=function(){var a=[];return this.forEach(function(e,t){a.push([t,e])}),e(a)},r&&(d.prototype[Symbol.iterator]=d.prototype.entries);var M=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function m(e,t){var a,r,p=(t=t||{}).body;if(e instanceof m){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,p||null==e._bodyInit||(p=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(a=t.method||this.method||"GET",r=a.toUpperCase(),-1<M.indexOf(r)?r:a),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&p)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(p)}function g(e){var p=new FormData;return e.trim().split("&").forEach(function(e){if(e){var t=e.split("="),a=t.shift().replace(/\+/g," "),r=t.join("=").replace(/\+/g," ");p.append(decodeURIComponent(a),decodeURIComponent(r))}}),p}function y(e,t){t=t||{},this.type="default",this.status=void 0===t.status?200:t.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}m.prototype.clone=function(){return new m(this,{body:this._bodyInit})},f.call(m.prototype),f.call(y.prototype),y.prototype.clone=function(){return new y(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},y.error=function(){var e=new y(null,{status:0,statusText:""});return e.type="error",e};var A=[301,302,303,307,308];y.redirect=function(e,t){if(-1===A.indexOf(t))throw new RangeError("Invalid status code");return new y(null,{status:t,headers:{location:e}})},o.DOMException=self.DOMException;try{new o.DOMException}catch(e){o.DOMException=function(e,t){this.message=e,this.name=t;var a=Error(e);this.stack=a.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function T(p,s){return new Promise(function(r,e){var t=new m(p,s);if(t.signal&&t.signal.aborted)return e(new o.DOMException("Aborted","AbortError"));var i=new XMLHttpRequest;function a(){i.abort()}i.onload=function(){var e,p,t={status:i.status,statusText:i.statusText,headers:(e=i.getAllResponseHeaders()||"",p=new d,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(e){var t=e.split(":"),a=t.shift().trim();if(a){var r=t.join(":").trim();p.append(a,r)}}),p)};t.url="responseURL"in i?i.responseURL:t.headers.get("X-Request-URL");var a="response"in i?i.response:i.responseText;r(new y(a,t))},i.onerror=function(){e(new TypeError("Network request failed"))},i.ontimeout=function(){e(new TypeError("Network request failed"))},i.onabort=function(){e(new o.DOMException("Aborted","AbortError"))},i.open(t.method,t.url,!0),"include"===t.credentials?i.withCredentials=!0:"omit"===t.credentials&&(i.withCredentials=!1),"responseType"in i&&n&&(i.responseType="blob"),t.headers.forEach(function(e,t){i.setRequestHeader(t,e)}),t.signal&&(t.signal.addEventListener("abort",a),i.onreadystatechange=function(){4===i.readyState&&t.signal.removeEventListener("abort",a)}),i.send(void 0===t._bodyInit?null:t._bodyInit)})}T.polyfill=!0,self.fetch||(self.fetch=T,self.Headers=d,self.Request=m,self.Response=y),o.Headers=d,o.Request=m,o.Response=y,o.fetch=T,Object.defineProperty(o,"__esModule",{value:!0})});var zappar={messageQueue:[],nextObject:0,objectsByRef:[],frame:[],_currentTime:0,afters:[],everyOffs:[],ready:[],_readyMessages:[],_doneReady:!1,everyOff:function(e){zappar.everyOffs.push(e)},every:function(e,t){var a=function(){zappar.after(e,function(){var e=zappar.everyOffs.indexOf(t);-1===e?!1!==t()&&a():zappar.everyOffs.splice(e,1)})};a()},everyOffFix:!0,on:function(e,t){return this[e]||(this[e]=[]),this[e].push(t),this},one:function(e,t){var a;this[e]||(this[e]=[]),a=function(){this.off(e,a),t.apply(this,arguments)},this.on(e,a)},off:function(e,t){if(void 0!==this[e]){var a=this[e].indexOf(t);0<=a&&this[e].splice(a,1)}},emit:function(e){if(void 0!==this[e])for(var t=this[e].slice(),a=Array.prototype.splice.call(arguments,1,99999),r=0,p=t.length;r<p;r++)t[r].apply(this,a)},filenameMap:function(e){return e},byId:function(){return null},node:function(){return null},newContext:function(){return Object.create(zappar)},_version:475};console.log("ZapparJS "+zappar._version),zappar._base=function(e){this._ctx=e,this._events={},this._dependingCount=0,this._dependsOnMe=[],this._readyMessage=null},zappar._base.prototype.on=function(e,t){return this._events[e]||(this._events[e]=[]),this._events[e].push(t),"ready"===e?0===this._dependingCount&&t.call(this):"notready"===e&&0!==this._dependingCount&&t.call(this),this},zappar._base.prototype.one=function(e,t){var a;return a=function(){this.off(e,a),t.apply(this,arguments)},this.on(e,a),this},zappar._base.prototype.off=function(e,t){if(void 0===this._events[e])return this;if(void 0===t)return this._events[e]=[],this;for(var a;0<=(a=this._events[e].indexOf(t));)this._events[e].splice(a,1);return this},zappar._base.prototype.emit=function(e){if(void 0===this._events[e])return this;for(var t=this._events[e].slice(),a=Array.prototype.splice.call(arguments,1,99999),r=0,p=t.length;r<p;r++)t[r].apply(this,a);return this},zappar._base.prototype.addDependCount=function(e){if(0<e){0===this._dependingCount&&(this._readyMessage?(this._readyMessage[0]=null,this._readyMessage=null):(this._readyMessage=[this,!1],zappar._readyMessages.push(this._readyMessage))),this._dependingCount+=e;for(var t=0,a=this._dependsOnMe.length;t<a;t++)this._dependsOnMe[t].addDependCount.call(this._dependsOnMe[t],e)}else{this._dependingCount+=e,e<0&&0===this._dependingCount&&(this._readyMessage?(this._readyMessage[0]=null,this._readyMessage=null):(this._readyMessage=[this,!0],zappar._readyMessages.push(this._readyMessage)));for(t=0,a=this._dependsOnMe.length;t<a;t++)this._dependsOnMe[t].addDependCount.call(this._dependsOnMe[t],e)}this.emit("dependschange",this._dependingCount)},zappar._base.prototype.notReadyCount=function(){return this._dependingCount},zappar._base.prototype.pushDependent=function(e){this._dependsOnMe.push(e),0!=this._dependingCount&&e.addDependCount(this._dependingCount)},zappar._base.prototype.removeDependent=function(e){var t=this._dependsOnMe.indexOf(e);-1!=t&&this._dependsOnMe.splice(t,1),0!=this._dependingCount&&e.addDependCount(-1*this._dependingCount)},zappar._base.prototype.tags=function(e){return void 0===e?this._tags?this._tags.slice():[]:(this._tags&&this._ctx.tagManager.unregisterTags(this,this._tags),this._tags=e.slice(),this._ctx.tagManager.registerTags(this,this._tags),this)},zappar._base.prototype.pushTag=function(e){return this._tags||(this._tags=[]),0<=this._tags.indexOf(e)||(this._tags.push(e),this._ctx.tagManager.registerTags(this,e)),this},zappar._base.prototype.removeTag=function(e){if(!this._tags)return this;var t=this._tags.indexOf(e);return 0<=t&&(this._tags.splice(t,1),this._ctx.tagManager.unregisterTags(this,e)),this},zappar._base.prototype.hasTag=function(e){return!!this._tags&&0<=this._tags.indexOf(e)},zappar.after=function(e,t){zappar.afters.push({end:zappar._currentTime+e,func:t})},zappar._types={SCREEN_TRANSFORM:1,OBJECT:2,OBJECTTYPE:3,GROUP:4,DEVICE:5,FILELOADER:6,IMAGETEXTURE:7,CAMERA_TRANSFORM:8,FONT:9,TEXT:10,BACKPATCH:11,TARGETFINDER:12,TARGET:13,TARGETINSTANCE:14,AUDIO:15,SCREENSIZECONSTRAIN:16,BILLBOARD:17,ACCELEROMETER:18,MATERIAL:19,VIDEOTEXTURE:20,BEZIER:21,PROMPT:22,KEYBOARD:23,STATS:24,CAMERAMANAGER:25,CAMERATEXTURE:27,DATATEXTURE:28,ATTITUDEORIENT:29,TAGMANAGER:30,RAYCASTER:31,HEADSETMANAGER:36,GRAVITYBILLBOARD:37,VIDEO:38,TRIGGERREGION:39,DATAOBJECTTYPE:40,FACEFINDER:41,FACEINSTANCE:42,OBJECTATTACHMENTPOINT:43,FLASHLIGHTSTATIC:44,TRANSFORMEDTEXTURE:45,DIRECTIONALLIGHT:46,POINTLIGHT:47,SPOTLIGHT:48,ENVIRONMENTLIGHT:49,STANDARDLIGHTINGMATERIAL:50,TOONMATERIAL:51,PBRMATERIAL:52,CUBEMAPTEXTURE:53,VIDEORECORDER:54,WORLDTRACKER:55,ANCHOR:56,PLANEANCHOR:57,FACEDATAOBJECTTYPE:58,DATAFILE:59,EMBEDDEDTEXTURE:60,CUSTOMANCHOR:61,PLANEANCHORDATAOBJECTTYPE:62,INSTANTTRACKER:63,INSTANTTRACKERANCHOR:64,BARCODEFINDER:65,BARCODEINSTANCE:66,IMAGELOOKUP:67},zappar._methods={METHOD_ALLOC:1,METHOD_SETSCENE:2,METHOD_SETLAYOUTLIST:3,METHOD_HIBERNATE:4,METHOD_LOADINGPERCENT:5,METHOD_ERROR:6},zappar.currentFrameTime=function(){return zappar._currentTime},zappar.msg=function(e){var t=e[e.length-1];zappar._currentTime=t;for(var a=0,r=e.length-1;a<r;a++)zappar.objectsByRef[e[a][0]]._message(e[a]);zappar.emit("frame",t);var p=zappar.afters;for(a=p.length-1;0<=a;a--)t>p[a].end&&(p[a].func(),p.splice(a,1));for(;0<zappar._readyMessages.length;){var i=zappar._readyMessages.splice(0,1)[0];if(i[0]){var s=i[1]?"ready":"notready";i[0]._readyMessage=null,i[0].emit.call(i[0],s)}}if(!zappar._doneReady){zappar._doneReady=!0;for(a=0,r=zappar.ready.length;a<r;a++)zappar.ready[a]()}var o=zappar.messageQueue;return zappar.messageQueue=[],JSON.stringify(o)},zappar.sendMessage=function(e){zappar.messageQueue.push(e)},zappar._messageReceiver=function(e,t){zappar._base.call(this,t),this.refId=zappar.nextObject++,zappar.objectsByRef.push(this),zappar.messageQueue.push([0,zappar._methods.METHOD_ALLOC,e])},zappar._messageReceiver.prototype=Object.create(zappar._base.prototype),zappar._messageReceiver.prototype.constructor=zappar._messageReceiver,zappar._messageReceiver.methods={METHOD_INTERPOLATE:1,METHOD_INTERPOLATECANCEL:2},zappar._messageReceiver.prototype._message=function(e){console.log("Unhandled message: "+e)},zappar._messageReceiver.prototype.toString=function(){return"Unknown"},zappar._interpolations=[],zappar._messageReceiver.prototype._interpolateSingle=function(e,t,a,r,p){var i=zappar._currentTime;this[t]=function(e){return e?(console.log("Warning - trying to set variable undergoing interpolation"),this):r+(p-r)*(zappar._currentTime-i)/a}},zappar._messageReceiver.prototype._interpolateArray=function(e,t,r,p,i){var s=e.length,o=-1,n=e.slice(),_=zappar._currentTime;this[t]=function(e){if(e)return console.log("Warning - trying to set variable undergoing interpolation"),this;var t=zappar._currentTime;if(o!==t){for(var a=0;a<s;a++)n[a]=p[a]+(i[a]-p[a])*(t-_)/r;o=t}return n.slice()}},zappar._messageReceiver.prototype.interpolate=function(t,e,a,r){this["_"+t+"_interpolation"]&&this["_"+t+"_interpolation"].cancel();var p=this["_"+t];a=a||p;var i=this,s=zappar._currentTime,o={startTime:s,endTime:s+e,ended:!1,atEnd:function(){!0!==o.ended&&(i["_"+t]=r,delete i[t],delete i["_"+t+"_interpolation"],o.ended=!0,o.finish&&o.finish())},on:function(e,t){o[e]=t},cancel:function(){if(!0!==o.ended){var e=i[t].call(i);i["_"+t]=e,delete i[t],delete i["_"+t+"_interpolation"],o.ended=!0,zappar.sendMessage([i.refId,zappar._messageReceiver.methods.METHOD_INTERPOLATECANCEL,[i["_"+t+"_id"],e]])}}};return void 0===p.length?this._interpolateSingle(p,t,e,a,r):this._interpolateArray(p,t,e,a.slice(),r.slice()),this["_"+t+"_interpolation"]=o,zappar._interpolations.splice(0,0,o),zappar.sendMessage([this.refId,zappar._messageReceiver.methods.METHOD_INTERPOLATE,[this["_"+t+"_id"],s,o.endTime,a,r]]),o},zappar._messageReceiver.prototype.valuify=function(e,t,a){var r=this[t+"_valuify_"];return r?r(e,a):a},zappar.on("frame",function(e){for(var t=[],a=zappar._interpolations.length-1;0<=a;a--){var r=zappar._interpolations[a];e>r.endTime&&t.push(r.atEnd),!0===r.ended&&zappar._interpolations.splice(a,1)}a=0;for(var p=t.length;a<p;a++)t[a]()}),zappar._valuify={},zappar._valuify.mediaFile=function(e,t){return"string"==typeof t?e.filenameMap(t):t},zappar._valuify.imageTexture=function(e,t){if("string"!=typeof t)return t;if(""===t)return null;var a=e.byId(t);return a||e.ImageTexture(e.filenameMap(t))},zappar._valuify.cubemapTexture=function(e,t){if("string"!=typeof t)return t;if(""===t)return null;var a=e.byId(t);return a||e.CubemapTexture()},zappar._valuify.enum=function(a){return function(e,t){return"string"!=typeof t?t:a[t]}},zappar._valuify.objectType=function(e,t){return"string"!=typeof t?t:e.ObjectType(e.filenameMap(t))},zappar._stats=function(e){zappar._messageReceiver.call(this,zappar._types.STATS,e)},zappar._stats.methods={METHOD_LOGEVENT:50,METHOD_LOGTARGET:51},zappar._stats.prototype=Object.create(zappar._messageReceiver.prototype),zappar._stats.prototype.constructor=zappar._stats,zappar._stats.prototype.logEvent=function(e){return zappar.sendMessage([this.refId,zappar._stats.methods.METHOD_LOGEVENT,e]),this},zappar._stats.prototype.logTarget=function(e){return zappar.sendMessage([this.refId,zappar._stats.methods.METHOD_LOGTARGET,e]),this},zappar._fileLoader=function(e,t){console.log(e),zappar._messageReceiver.call(this,zappar._types.FILELOADER,t),(zappar._fileLoaderCache[e]=this)._resolvedFilename=null,this._retries=0,this._retryDelay=3e3;var a=this;this._complete=new Promise(function(e,t){a._completeResolve=e,a._completeReject=t}),zappar.sendMessage([this.refId,zappar._fileLoader.methods.METHOD_URL,e])},zappar._fileLoader.methods={METHOD_URL:50,METHOD_START:51},zappar._fileLoader.prototype=Object.create(zappar._messageReceiver.prototype),zappar._fileLoader.prototype.constructor=zappar._fileLoader,zappar._fileLoader.prototype._message=function(e){if("l"===e[1])return this._resolvedFilename=e[2],this.emit("downloaded",e[2]),void this._completeResolve(e[2]);if("e"!==e[1])zappar._messageReceiver.prototype._message.call(this,e);else if(this._resolvedFilename=e[2],0<this._retries){--this._retries;var t=this;zappar.after(this._retryDelay,function(){zappar.sendMessage([t.refId,zappar._fileLoader.methods.METHOD_START,null])}),this.emit("error")}else this.emit("error"),this.emit("downloaded",e[2]),this._completeReject()},zappar._fileLoader._isAbsoluteRegex=/(^[A-Za-z]*:\/\/)|(^\/)/,zappar._fileLoader._pathRegex=/.*\//,zappar._fileLoader.getFullPath=function(e,t){if(!0===zappar._fileLoader._isAbsoluteRegex.test(t))return t;var a=zappar._fileLoader._pathRegex.exec(e);return a?a[0]+t:t},zappar._fileLoader.prototype.retries=function(e){return void 0===e?this._retries:(this._retries=e,this)},zappar._fileLoader.prototype.retryDelay=function(e){return void 0===e?this._retryDelay:(this._retryDelay=e,this)},zappar._fileLoader.prototype.complete=function(){return this._complete},zappar._fileLoader.prototype.on=function(e,t){return"downloaded"===e&&this._resolvedFilename&&t.call(this,this._resolvedFilename),zappar._messageReceiver.prototype.on.call(this,e,t)},zappar._fileLoaderCache={},zappar.FileLoader=function(e){return zappar._fileLoaderCache[e]?zappar._fileLoaderCache[e]:new zappar._fileLoader(e,this)},zappar.Texture={Mipmap:{none:1,fast:2,best:3},Wrap:{repeat:1,clamp:2},Channel:{r:0,g:1,b:2,a:3}},zappar._texture=function(e,t){zappar._messageReceiver.call(this,e,t),this._position=[0,0],this._scale=[1,1],this._rotation=0,this._size=[0,0],this._material=t.Material(),this._material.skin(this),this._isTexture=!0,this._isLoading=!1,this._valid=!1},zappar._texture.methods={PARAM_POSITION:50,PARAM_SCALE:51,PARAM_ROTATION:52,PARAM_MIPMAP:53,PARAM_WRAP:54},zappar._texture.prototype=Object.create(zappar._messageReceiver.prototype),zappar._texture.prototype.constructor=zappar._texture,zappar._texture.prototype._message=function(e){"dims"!==e[1]?"v"!==e[1]?zappar._messageReceiver.prototype._message.call(this,e):this._valid=e[2]:this._size=e[2].slice()},zappar._texture.prototype._position_id=zappar._texture.methods.PARAM_POSITION,zappar._texture.prototype.position=function(e){return e?(this._position=e.slice(),zappar.sendMessage([this.refId,zappar._texture.methods.PARAM_POSITION,this._position]),this):this._position.slice()},zappar._texture.prototype._scale_id=zappar._texture.methods.PARAM_SCALE,zappar._texture.prototype.scale=function(e){return e?(this._scale=e.slice(),zappar.sendMessage([this.refId,zappar._texture.methods.PARAM_SCALE,this._scale]),this):this._scale.slice()},zappar._texture.prototype._rotation_id=zappar._texture.methods.PARAM_ROTATION,zappar._texture.prototype.rotation=function(e){return void 0!==e?(this._rotation=e,zappar.sendMessage([this.refId,zappar._texture.methods.PARAM_ROTATION,this._rotation]),this):this._rotation},zappar._texture.prototype.mipmap_valuify_=zappar._valuify.enum(zappar.Texture.Mipmap),zappar._texture.prototype._mipmap_id=zappar._texture.methods.PARAM_MIPMAP,zappar._texture.prototype.mipmap=function(e){return void 0!==e?(this._mipmap=this.mipmap_valuify_(this._ctx,e),this._isLoading||(this._isLoading=!0,this.addDependCount(1)),zappar.sendMessage([this.refId,zappar._texture.methods.PARAM_MIPMAP,this._mipmap]),this):this._mipmap},zappar._texture.prototype.wrap_valuify_=zappar._valuify.enum(zappar.Texture.Wrap),zappar._texture.prototype._wrap_id=zappar._texture.methods.PARAM_WRAP,zappar._texture.prototype.wrap=function(e){return void 0!==e?(this._wrap=this.wrap_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._texture.methods.PARAM_WRAP,this._wrap]),this):this._wrap},zappar._texture.prototype.size=function(){return this._size},zappar._texture.prototype.valid=function(){return this._valid},zappar._texture.prototype.toString=function(){return"Texture"},zappar._imageTexture=function(e,t){zappar._texture.call(this,zappar._types.IMAGETEXTURE,t),e&&this.source(e)},zappar._imageTexture.methods={METHOD_SRC:100,METHOD_DISPOSE:101},zappar._imageTexture.prototype=Object.create(zappar._texture.prototype),zappar._imageTexture.prototype.constructor=zappar._imageTexture,zappar._imageTexture.prototype._message=function(e){if("load"===e[1])return this._isLoading=!1,void this.addDependCount(-1);zappar._texture.prototype._message.call(this,e)},zappar._imageTexture.prototype.toString=function(){return"ImageTexture ("+this._source+")"},zappar._imageTexture.prototype.source_valuify_=zappar._valuify.mediaFile,zappar._imageTexture.prototype.source=function(e){if(void 0===e)return this._source;this._source=this._ctx.filenameMap(e);var t=this._ctx.FileLoader(this._source),a=this;return this._isLoading||(this._isLoading=!0,this.addDependCount(1)),t.on("downloaded",function(e){zappar.sendMessage([a.refId,zappar._imageTexture.methods.METHOD_SRC,e])}),this},zappar._imageTexture.prototype.dispose=function(){return zappar.sendMessage([this.refId,zappar._imageTexture.methods.METHOD_DISPOSE,null]),this},zappar.ImageTexture=function(e){return new zappar._imageTexture(e,this)},zappar._cubemapTexture=function(e){zappar._texture.call(this,zappar._types.CUBEMAPTEXTURE,e),this._rightFile=null,this._leftFile=null,this._topFile=null,this._bottomFile=null,this._frontFile=null,this._backFile=null},zappar._cubemapTexture.methods={METHOD_RIGHT:200,METHOD_LEFT:201,METHOD_TOP:202,METHOD_BOTTOM:203,METHOD_FRONT:204,METHOD_BACK:205},zappar._cubemapTexture.prototype=Object.create(zappar._texture.prototype),zappar._cubemapTexture.prototype.constructor=zappar._cubemapTexture,zappar._cubemapTexture.prototype._message=function(e){if("load"===e[1])return this._isLoading=!1,void this.addDependCount(-1);zappar._texture.prototype._message.call(this,e)},zappar._cubemapTexture.prototype.toString=function(){return"CubemapTexture"},zappar._cubemapTexture.prototype.right_valuify_=zappar._valuify.mediaFile,zappar._cubemapTexture.prototype.right=function(e){if(void 0===e)return this._rightFile;this._rightFile=this._ctx.filenameMap(e);var t=this._ctx.FileLoader(this._rightFile),a=this;return this._isLoading||(this._isLoading=!0,this.addDependCount(1)),t.on("downloaded",function(e){zappar.sendMessage([a.refId,zappar._cubemapTexture.methods.METHOD_RIGHT,e])}),this},zappar._cubemapTexture.prototype.left_valuify_=zappar._valuify.mediaFile,zappar._cubemapTexture.prototype.left=function(e){if(void 0===e)return this._leftFile;this._leftFile=this._ctx.filenameMap(e);var t=this._ctx.FileLoader(this._leftFile),a=this;return this._isLoading||(this._isLoading=!0,this.addDependCount(1)),t.on("downloaded",function(e){zappar.sendMessage([a.refId,zappar._cubemapTexture.methods.METHOD_LEFT,e])}),this},zappar._cubemapTexture.prototype.top_valuify_=zappar._valuify.mediaFile,zappar._cubemapTexture.prototype.top=function(e){if(void 0===e)return this._topFile;this._topFile=this._ctx.filenameMap(e);var t=this._ctx.FileLoader(this._topFile),a=this;return this._isLoading||(this._isLoading=!0,this.addDependCount(1)),t.on("downloaded",function(e){zappar.sendMessage([a.refId,zappar._cubemapTexture.methods.METHOD_TOP,e])}),this},zappar._cubemapTexture.prototype.bottom_valuify_=zappar._valuify.mediaFile,zappar._cubemapTexture.prototype.bottom=function(e){if(void 0===e)return this._bottomFile;this._bottomFile=this._ctx.filenameMap(e);var t=this._ctx.FileLoader(this._bottomFile),a=this;return this._isLoading||(this._isLoading=!0,this.addDependCount(1)),t.on("downloaded",function(e){zappar.sendMessage([a.refId,zappar._cubemapTexture.methods.METHOD_BOTTOM,e])}),this},zappar._cubemapTexture.prototype.front_valuify_=zappar._valuify.mediaFile,zappar._cubemapTexture.prototype.front=function(e){if(void 0===e)return this._frontFile;this._frontFile=this._ctx.filenameMap(e);var t=this._ctx.FileLoader(this._frontFile),a=this;return this._isLoading||(this._isLoading=!0,this.addDependCount(1)),t.on("downloaded",function(e){zappar.sendMessage([a.refId,zappar._cubemapTexture.methods.METHOD_FRONT,e])}),this},zappar._cubemapTexture.prototype.back_valuify_=zappar._valuify.mediaFile,zappar._cubemapTexture.prototype.back=function(e){if(void 0===e)return this._backFile;this._backFile=this._ctx.filenameMap(e);var t=this._ctx.FileLoader(this._backFile),a=this;return this._isLoading||(this._isLoading=!0,this.addDependCount(1)),t.on("downloaded",function(e){zappar.sendMessage([a.refId,zappar._cubemapTexture.methods.METHOD_BACK,e])}),this},zappar.CubemapTexture=function(){return new zappar._cubemapTexture(this)},zappar._videoTexture=function(e,t){zappar._texture.call(this,zappar._types.VIDEOTEXTURE,t),this._mask=!1,e&&this.source(e)},zappar._videoTexture.methods={METHOD_SRC:100,METHOD_START:101,METHOD_PAUSE:102,METHOD_RESTART:103,PARAM_MASK:104},zappar._videoTexture.prototype=Object.create(zappar._texture.prototype),zappar._videoTexture.prototype.constructor=zappar._videoTexture,zappar._videoTexture.prototype.source_valuify_=zappar._valuify.mediaFile,zappar._videoTexture.prototype.source=function(e){if(void 0===e)return this._source;var t=this;return this._isLoading||(this._isLoading=!0,this.addDependCount(1)),this._source=this.source_valuify_(this._ctx,e),this._ctx.FileLoader(this._source).on("downloaded",function(e){zappar.sendMessage([t.refId,zappar._videoTexture.methods.METHOD_SRC,e])}),this},zappar._videoTexture.prototype.start=function(){return zappar.sendMessage([this.refId,zappar._videoTexture.methods.METHOD_START,null]),this},zappar._videoTexture.prototype.pause=function(){return zappar.sendMessage([this.refId,zappar._videoTexture.methods.METHOD_PAUSE,null]),this},zappar._videoTexture.prototype.restart=function(){return zappar.sendMessage([this.refId,zappar._videoTexture.methods.METHOD_RESTART,null]),this},zappar._videoTexture.prototype.mask=function(e){return void 0!==e?(this._mask=e,zappar.sendMessage([this.refId,zappar._videoTexture.methods.PARAM_MASK,this._mask]),this):this._mask},zappar._videoTexture.prototype._message=function(e){if("load"===e[1])return this._isLoading=!1,void this.addDependCount(-1);"f"!==e[1]?zappar._texture.prototype._message.call(this,e):this.emit("finish")},zappar._videoTexture.prototype.toString=function(){return"VideoTexture"},zappar.VideoTexture=function(e){return new zappar._videoTexture(e,this)},zappar._objectTypes={},zappar._objectType=function(e,t){zappar._messageReceiver.call(this,zappar._types.OBJECTTYPE,t),(zappar._objectTypes[e]=this)._fileLoader=t.FileLoader(e),this._src=e;var a=this;this._fileLoader.on("downloaded",function(e){zappar.sendMessage([a.refId,zappar._objectType.methods.PARAM_SRC,e])}),this.addDependCount(1),this._materials=[],this._dataFiles=[]},zappar._objectType.methods={PARAM_SRC:50,PARAM_MATERIALS:51,PARAM_DATAFILE:52,METHOD_DISPOSE:53},zappar._objectType.prototype=Object.create(zappar._messageReceiver.prototype),zappar._objectType.prototype.constructor=zappar._objectType,zappar._objectType.prototype._resolveToMaterial=function(e){var t=e;return"string"==typeof e&&(t=""===e?null:(t=this._ctx.byId(e))||this._ctx.ImageTexture(e)._material),t&&t._isTexture&&(t=t._material),t},zappar._objectType.prototype._applyEmbeddedMaterials=function(e){for(var t=[],a=0,r=e.length;a<r;a++)t.push(this._resolveEmbeddedMaterial(e[a]));this.materials(t)},zappar._objectType.prototype._resolveEmbeddedMaterial=function(e){if(void 0===e.type)return this._resolveToMaterial(e);var t=void 0;if("Unlit"===e.type){if(e.textures&&e.textures[0]){var a=e.textures[0].diffuseMap;a&&(t=(t=this._ctx.byId(a))||this._ctx.ImageTexture(a)._material)}}else if("PBR"===e.type){t=this._ctx.PBRMaterial(),void 0!==e.baseColor&&t.color(e.baseColor),void 0!==e.opacity&&t.opacity(e.opacity),void 0!==e.roughness&&t.roughness(e.roughness),void 0!==e.metalness&&t.metalness(e.metalness);for(var r=e.textures,p=0,i=r.length;p<i;p++){var s=r[p];if(void 0!==s.albedoMap){var o=s.albedoMap;s.embedded&&(o=this._ctx.EmbeddedTexture(this,parseInt(s.albedoMap))),t.albedoMap(o)}if(void 0!==s.metallicRoughnessMap){o=s.metallicRoughnessMap;s.embedded&&(o=this._ctx.EmbeddedTexture(this,parseInt(s.metallicRoughnessMap))),t.metallicRoughnessMap(o)}if(void 0!==s.normalMap){o=s.normalMap;s.embedded&&(o=this._ctx.EmbeddedTexture(this,parseInt(s.normalMap))),t.normalMap(o)}if(void 0!==s.emissiveMap){o=s.emissiveMap;s.embedded&&(o=this._ctx.EmbeddedTexture(this,parseInt(s.emissiveMap))),t.emissiveMap(o)}if(void 0!==s.ambientMap){o=s.ambientMap;s.embedded&&(o=this._ctx.EmbeddedTexture(this,parseInt(s.ambientMap))),t.ambientMap(o)}}}return t},zappar._objectType.prototype._resolveToDataFile=function(e){var t=e;return"string"==typeof e&&(t=""===e?null:(t=this._ctx.byId(e))||this._ctx.DataFile(e)),t},zappar._objectType.prototype.materials=function(e){if(void 0===e)return this._materials.slice();for(var t=[],a=[],r=0,p=e.length;r<p;r++){(i=this._resolveToMaterial(e[r]))?(i.pushDependent(this),a.push(i.refId)):a.push(null),t.push(i)}for(r=0,p=this._materials.length;r<p;r++){var i;(i=this._materials[r])&&i.removeDependent(this)}return this._materials=t,zappar.sendMessage([this.refId,zappar._objectType.methods.PARAM_MATERIALS,a]),this},zappar._objectType.prototype.dataFiles=function(e){if(void 0===e)return this._dataFiles.slice();for(var t=[],a=[],r=0,p=e.length;r<p;r++){var i=this._resolveToDataFile(e[r]);i?(i.pushDependent(this),a.push(i.refId)):a.push(null),t.push(i)}for(r=0;r<this._dataFiles.length;r++)this._dataFiles[r].removeDependent(this);return this._dataFiles=t,zappar.sendMessage([this.refId,zappar._objectType.methods.PARAM_DATAFILE,a]),this},zappar._objectType.prototype._message=function(e){"load"!==e[1]?"materials"!==e[1]?"dataFiles"!==e[1]?zappar._messageReceiver.prototype._message.call(this,e):this.dataFiles(e[2]):this._applyEmbeddedMaterials(e[2]):this.addDependCount(-1)},zappar._objectType.prototype.toString=function(){return"ObjectType"},zappar._objectType.prototype.dispose=function(e){if(delete zappar._objectTypes[this._src],zappar.sendMessage([this.refId,zappar._objectType.methods.METHOD_DISPOSE,null]),e)for(var t=0;t<this._materials.length;t++)this._materials[t].dispose&&this._materials[t].dispose(!0)},zappar.ObjectType=function(e){return e=this.filenameMap(e),zappar._objectTypes[e]?zappar._objectTypes[e]:new zappar._objectType(e,this)},zappar._backPatch=function(e,t,a){zappar._messageReceiver.call(this,zappar._types.BACKPATCH,a),this._material=null,this._patch=[0,1,0,1],e&&this.material(e),t&&this.patch(t),this._color=[1,1,1,1]},zappar._backPatch.methods={PARAM_PATCH:50,PARAM_MATERIAL:51,PARAM_COLOR:52},zappar._backPatch.prototype=Object.create(zappar._messageReceiver.prototype),zappar._backPatch.prototype.constructor=zappar._backPatch,zappar._backPatch.prototype.patch=function(e){return e?(this._patch=e.slice(),zappar.sendMessage([this.refId,zappar._backPatch.methods.PARAM_PATCH,this._patch]),this):this._patch.slice()},zappar._backPatch.prototype.material_valuify_=function(e,t){var a=t;return"string"==typeof t&&(a=""===t?null:(a=e.byId(t))||e.ImageTexture(e.filenameMap(t))._material),a&&a._isTexture&&(a=a._material),a},zappar._backPatch.prototype.material=function(e){if(void 0===e)return this._material;var t=this.material_valuify_(this._ctx,e);return t?(t.pushDependent(this),zappar.sendMessage([this.refId,zappar._backPatch.methods.PARAM_MATERIAL,t.refId])):zappar.sendMessage([this.refId,zappar._backPatch.methods.PARAM_MATERIAL,null]),this._material&&this._material.removeDependent(this),this._material=t,this},zappar._backPatch.prototype.color=function(e){return e?(this._color=e.slice(),zappar.sendMessage([this.refId,zappar._backPatch.methods.PARAM_COLOR,this._color]),this):this._color.slice()},zappar._backPatch.prototype.toString=function(){return"BackPatch"},zappar.BackPatch=function(e,t){return new zappar._backPatch(e,t,this)},zappar._fonts={},zappar._font=function(t,e){zappar._messageReceiver.call(this,zappar._types.FONT,e),(zappar._fonts[t]=this)._fileLoader=e.FileLoader(t);var a=this;this._fileLoader.on("downloaded",function(e){zappar.sendMessage([a.refId,zappar._font.methods.METHOD_SRC,e]),a._texture=a._ctx.ImageTexture(t),a._texture.pushDependent(this),a._texture.mipmap(a._ctx.Texture.Mipmap.best),zappar.sendMessage([a.refId,zappar._font.methods.METHOD_MATERIAL,a._texture._material.refId])}),this._url=t,this.addDependCount(1)},zappar._font.methods={METHOD_SRC:50,METHOD_MATERIAL:51},zappar._font.prototype=Object.create(zappar._messageReceiver.prototype),zappar._font.prototype.constructor=zappar._font,zappar._font.prototype._message=function(e){"l"!==e[1]?zappar._messageReceiver.prototype._message.call(this,e):this.addDependCount(-1)},zappar._font.prototype.toString=function(){return"Font ("+this._url+")"},zappar.Font=function(e){return e=this.filenameMap(e),zappar._fonts[e]?zappar._fonts[e]:new zappar._font(e,this)},zappar._audio=function(e,t){zappar._messageReceiver.call(this,zappar._types.AUDIO,t),this._registeredFinish=!1,this._volume=[1,1],e&&this.source(e)},zappar._audio.methods={METHOD_SRC:50,METHOD_START:51,METHOD_PAUSE:52,METHOD_RESTART:53,METHOD_FINISH:54,PARAM_VOLUME:55},zappar._audio.prototype=Object.create(zappar._messageReceiver.prototype),zappar._audio.prototype.constructor=zappar._audio,zappar._audio.prototype._message=function(e){"l"!==e[1]?"f"!==e[1]?zappar._messageReceiver.prototype._message.call(this,e):this.emit("finish"):this.addDependCount(-1)},zappar._audio.prototype.source_valuify_=zappar._valuify.mediaFile,zappar._audio.prototype.source=function(e){if(void 0===e)return this._url;this._url=this._ctx.filenameMap(e);var t=this;return this._ctx.FileLoader(this._url).on("downloaded",function(e){zappar.sendMessage([t.refId,zappar._audio.methods.METHOD_SRC,e])}),this.addDependCount(1),this},zappar._audio.prototype.start=function(){return zappar.sendMessage([this.refId,zappar._audio.methods.METHOD_START,null]),this},zappar._audio.prototype.pause=function(){return zappar.sendMessage([this.refId,zappar._audio.methods.METHOD_PAUSE,null]),this},zappar._audio.prototype.restart=function(){return zappar.sendMessage([this.refId,zappar._audio.methods.METHOD_RESTART,null]),this},zappar._audio.prototype.toString=function(){return"Audio ("+this._url+")"},zappar._audio.prototype._volume_id=zappar._audio.methods.PARAM_VOLUME,zappar._audio.prototype.volume=function(e){return void 0===e?this._volume.slice():(this._volume=e.slice(),zappar.sendMessage([this.refId,zappar._audio.methods.PARAM_VOLUME,this._volume]),this)},zappar._audio.prototype.on=function(e,t){return"finish"===e&&!1===this._registeredFinish&&(this._registeredFinish=!0,zappar.sendMessage([this.refId,zappar._audio.methods.METHOD_FINISH,null])),zappar._messageReceiver.prototype.on.call(this,e,t)},zappar.Audio=function(e){return new zappar._audio(e,this)},zappar.Blend={inherit:0,default:1,additive:2},zappar.CullFaces={inherit:0,back:1,front:2,both:3,none:4,auto_back:5,auto_front:6},zappar.FillDepthBuffer={inherit:null,true:!0,false:!1},zappar.RenderPass={inherit:0,mono:1,stereo_l:2,stereo_r:4,capture:8,all:15,non_capture:7},zappar.DepthTest=zappar.FillDepthBuffer,zappar.LayerMode={overlay:1,full_3d:2,test_3d:3,unset:4},zappar.FramePhase={after_render:0,after_early_updates:1},zappar._node=function(e,t){this._color=[1,1,1,1],this._position=[0,0,0],this._scale=[1,1,1],this._rotation=[0,0,0],this._depthRange=[0,1],this._relativeTo=[],this._relativeToProp=[1],this._visible=!0,this._enabled=!0,this._fillDepthBuffer=null,this._depthTest=null,this._blend=zappar.Blend.inherit,this._cullFaces=zappar.CullFaces.inherit,this._displaySizeMin=null,this._displaySizeMax=null,this._visibleForPasses=zappar.RenderPass.inherit,this._pointerEventPhase=zappar.FramePhase.after_render,this._renderLayer=null,zappar._messageReceiver.call(this,e,t)},zappar._node.methods={METHOD_RELATIVETO:49,PARAM_COLOR:50,PARAM_POSITION:51,PARAM_SCALE:52,PARAM_ROTATION:53,PARAM_VISIBLE:54,PARAM_FILLDEPTHBUFFER:55,PARAM_DEPTHTEST:56,PARAM_BLEND:57,PARAM_ENABLED:58,PARAM_RELATIVEPROP:59,PARAM_DEPTHRANGE:60,PARAM_CULLFACES:61,PARAM_VISIBLEFORPASSES:62,PARAM_POINTEREVENTPHASE:63,PARAM_RENDERLAYER:64},zappar._node.prototype=Object.create(zappar._messageReceiver.prototype),zappar._node.prototype.constructor=zappar._node,zappar._node.prototype._color_id=zappar._node.methods.PARAM_COLOR,zappar._node.prototype.color=function(e){return e?(this._color=e.slice(),zappar.sendMessage([this.refId,zappar._node.methods.PARAM_COLOR,this._color]),this):this._color.slice()},zappar._node.prototype._position_id=zappar._node.methods.PARAM_POSITION,zappar._node.prototype.position=function(e){return e?(this._position=e.slice(),zappar.sendMessage([this.refId,zappar._node.methods.PARAM_POSITION,this._position]),this):this._position.slice()},zappar._node.prototype._scale_id=zappar._node.methods.PARAM_SCALE,zappar._node.prototype.scale=function(e){return e?(this._scale=e.slice(),zappar.sendMessage([this.refId,zappar._node.methods.PARAM_SCALE,this._scale]),this):this._scale.slice()},zappar._node.prototype._rotation_id=zappar._node.methods.PARAM_ROTATION,zappar._node.prototype.rotation=function(e){return e?(this._rotation=e.slice(),zappar.sendMessage([this.refId,zappar._node.methods.PARAM_ROTATION,this._rotation]),this):this._rotation.slice()},zappar._node.prototype._depthRange_id=zappar._node.methods.PARAM_DEPTHRANGE,zappar._node.prototype.depthRange=function(e){return e?(this._depthRange=e.slice(),zappar.sendMessage([this.refId,zappar._node.methods.PARAM_DEPTHRANGE,this._depthRange]),this):this._depthRange.slice()},zappar._node.prototype._relativeToProp_id=zappar._node.methods.PARAM_RELATIVEPROP,zappar._node.prototype.relativeToProp=function(e){return e?(this._relativeToProp=e.slice(),zappar.sendMessage([this.refId,zappar._node.methods.PARAM_RELATIVEPROP,this._relativeToProp]),this):this._relativeToProp.slice()},zappar._node.prototype.visible=function(e){return void 0!==e?(this._visible=e,zappar.sendMessage([this.refId,zappar._node.methods.PARAM_VISIBLE,this._visible]),this):this._visible},zappar._node.prototype.enabled=function(e){return void 0!==e?(this._enabled=e,zappar.sendMessage([this.refId,zappar._node.methods.PARAM_ENABLED,this._enabled]),this):this._enabled},zappar._node.prototype.visibleForPasses=function(e){return void 0!==e?(this._visibleForPasses=e,zappar.sendMessage([this.refId,zappar._node.methods.PARAM_VISIBLEFORPASSES,this._visibleForPasses]),this):this._visibleForPasses},zappar._node.prototype.fillDepthBuffer_valuify_=zappar._valuify.enum(zappar.FillDepthBuffer),zappar._node.prototype.fillDepthBuffer=function(e){return void 0!==e?(this._fillDepthBuffer=this.fillDepthBuffer_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._node.methods.PARAM_FILLDEPTHBUFFER,this._fillDepthBuffer]),this):this._fillDepthBuffer},zappar._node.prototype.depthTest_valuify_=zappar._valuify.enum(zappar.DepthTest),zappar._node.prototype.depthTest=function(e){return void 0!==e?(this._depthTest=this.depthTest_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._node.methods.PARAM_DEPTHTEST,this._depthTest]),this):this._depthTest},zappar._node.prototype.blend_valuify_=zappar._valuify.enum(zappar.Blend),zappar._node.prototype.blend=function(e){return void 0!==e?(this._blend=this.blend_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._node.methods.PARAM_BLEND,this._blend]),this):this._blend},zappar._node.prototype.cullFaces_valuify_=zappar._valuify.enum(zappar.CullFaces),zappar._node.prototype.cullFaces=function(e){return void 0!==e?(this._cullFaces=this.cullFaces_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._node.methods.PARAM_CULLFACES,this._cullFaces]),this):this._cullFaces},zappar._node.prototype.pointerEventPhase_valuify_=zappar._valuify.enum(zappar.FramePhase),zappar._node.prototype.pointerEventPhase=function(e){return void 0!==e?(this._pointerEventPhase=e,zappar.sendMessage([this.refId,zappar._node.methods.PARAM_POINTEREVENTPHASE,this._pointerEventPhase]),this):this._pointerEventPhase},zappar._node.prototype.relativeTo_valuify_=function(e,t){if(null===t)return[];void 0!==t.length&&"string"!=typeof t||(t=[t]);for(var a=0,r=(t=t.slice()).length;a<r;a++)"string"==typeof t[a]&&(t[a]=e.byId(t[a]));return t},zappar._node.prototype.relativeTo=function(e){if(void 0===e)return this._relativeTo.slice();null===e&&(e=[]),this._relativeTo=e=this.relativeTo_valuify_(this._ctx,e);for(var t=[],a=0,r=e.length;a<r;a++)null!==e[a]&&t.push(e[a].refId);for(;this._relativeToProp.length<e.length;)this._relativeToProp.push(0);return zappar.sendMessage([this.refId,zappar._node.methods.METHOD_RELATIVETO,t]),this},zappar._node.prototype._renderLayer_id=zappar._node.methods.PARAM_RENDERLAYER,zappar._node.prototype.renderLayer=function(e){return void 0!==e?(this._renderLayer=e,zappar.sendMessage([this.refId,zappar._node.methods.PARAM_RENDERLAYER,this._renderLayer]),this):this._renderLayer},zappar._text=function(e){zappar._node.call(this,zappar._types.TEXT,e),this._font=null,this._text=null,this._layout=3,this._lines=6,this._lineScale=1,this._hAlign=1,this._vAlign=1,this._lineSpacing=1,this._ellipsis="...",this._textColor=[1,1,1,1],this._shadow=null,this._shadowColor=[0,0,0,1],this._backPatch=null,this._renderSorted=!1},zappar._text.methods={PARAM_TEXT:101,PARAM_NUMBERLINES:102,PARAM_LINESCALE:103,PARAM_HALIGN:104,PARAM_VALIGN:105,PARAM_LINESPACING:106,PARAM_TEXTCOLOR:107,PARAM_LAYOUT:108,PARAM_ELLIPSIS:109,PARAM_SHADOW:110,PARAM_SHADOWCOLOR:111,PARAM_RENDERSORTED:112,METHOD_FONT:150,METHOD_BACKPATCH:151},zappar._text.prototype=Object.create(zappar._node.prototype),zappar._text.prototype.constructor=zappar._text,zappar.Text=function(e){var t=new zappar._text(this);for(var a in e)t[a].call(t,e[a]);return t},zappar.Text.Layout={wrap:1,stretch:2,fit:3},zappar.Text.HAlign={left:1,center:2,right:3},zappar.Text.VAlign={top:1,center:2,bottom:3},zappar._text.prototype.font_valuify_=function(e,t){return"string"!=typeof t?t:e.Font(e.filenameMap(t))},zappar._text.prototype.font=function(e){return void 0===e?this._font:(this._font=this.font_valuify_(this._ctx,e),this._font?(this._font.pushDependent(this),zappar.sendMessage([this.refId,zappar._text.methods.METHOD_FONT,this._font.refId])):zappar.sendMessage([this.refId,zappar._text.methods.METHOD_FONT,null]),this)},zappar._text.prototype.text=function(e){return"string"==typeof e?(this._text=e,zappar.sendMessage([this.refId,zappar._text.methods.PARAM_TEXT,this._text]),this):this._text},zappar._text.prototype.layout_valuify_=zappar._valuify.enum(zappar.Text.Layout),zappar._text.prototype.layout=function(e){return e?(this._layout=this.layout_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._text.methods.PARAM_LAYOUT,this._layout]),this):this._layout},zappar._text.prototype._lines_id=zappar._text.methods.PARAM_NUMBERLINES,zappar._text.prototype.lines=function(e){return void 0!==e?(this._lines=e,zappar.sendMessage([this.refId,zappar._text.methods.PARAM_NUMBERLINES,this._lines]),this):this._lines},zappar._text.prototype._lineScale_id=zappar._text.methods.PARAM_LINESCALE,zappar._text.prototype.lineScale=function(e){return void 0!==e?(this._lineScale=e,zappar.sendMessage([this.refId,zappar._text.methods.PARAM_LINESCALE,this._lineScale]),this):this._lineScale},zappar._text.prototype._lineSpacing_id=zappar._text.methods.PARAM_LINESPACING,zappar._text.prototype.lineSpacing=function(e){return void 0!==e?(this._lineSpacing=e,zappar.sendMessage([this.refId,zappar._text.methods.PARAM_LINESPACING,this._lineSpacing]),this):this._lineSpacing},zappar._text.prototype.hAlign_valuify_=zappar._valuify.enum(zappar.Text.HAlign),zappar._text.prototype.hAlign=function(e){return void 0!==e?(this._hAlign=this.hAlign_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._text.methods.PARAM_HALIGN,this._hAlign]),this):this._hAlign},zappar._text.prototype.vAlign_valuify_=zappar._valuify.enum(zappar.Text.VAlign),zappar._text.prototype.vAlign=function(e){return void 0!==e?(this._vAlign=this.vAlign_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._text.methods.PARAM_VALIGN,this._vAlign]),this):this._vAlign},zappar._text.prototype._textColor_id=zappar._text.methods.PARAM_TEXTCOLOR,zappar._text.prototype.textColor=function(e){return void 0!==e?(this._textColor=e,zappar.sendMessage([this.refId,zappar._text.methods.PARAM_TEXTCOLOR,this._textColor]),this):this._textColor},zappar._text.prototype._shadow_id=zappar._text.methods.PARAM_SHADOW,zappar._text.prototype.shadow=function(e){return void 0!==e?(this._shadow=e,zappar.sendMessage([this.refId,zappar._text.methods.PARAM_SHADOW,this._shadow]),this):this._shadow},zappar._text.prototype._shadowColor_id=zappar._text.methods.PARAM_SHADOWCOLOR,zappar._text.prototype.shadowColor=function(e){return void 0!==e?(this._shadowColor=e,zappar.sendMessage([this.refId,zappar._text.methods.PARAM_SHADOWCOLOR,this._shadowColor]),this):this._shadowColor},zappar._text.prototype.ellipsis=function(e){return void 0!==e?(this._ellipsis=e,zappar.sendMessage([this.refId,zappar._text.methods.PARAM_ELLIPSIS,this._ellipsis]),this):this._ellipsis},zappar._text.prototype.backPatch_valuify_=function(e,t){if("string"!=typeof t)return t;if(""===t)return null;var a=e.byId(t);return a||e.BackPatch(e.filenameMap(t))},zappar._text.prototype.backPatch=function(e){return void 0===e?this._backPatch:(this._backPatch&&this._backPatch.removeDependent(this),this._backPatch=this.backPatch_valuify_(this._ctx,e),this._backPatch?(this._backPatch.pushDependent(this),zappar.sendMessage([this.refId,zappar._text.methods.METHOD_BACKPATCH,this._backPatch.refId])):zappar.sendMessage([this.refId,zappar._text.methods.METHOD_BACKPATCH,null]),this)},zappar._text.prototype._renderSorted_id=zappar._text.methods.PARAM_RENDERSORTED,zappar._text.prototype.renderSorted=function(e){return void 0!==e?(this._renderSorted=e,zappar.sendMessage([this.refId,zappar._text.methods.PARAM_RENDERSORTED,this._renderSorted]),this):this._renderSorted},zappar._text.prototype.layerMode_valuify_=zappar._valuify.enum(zappar.LayerMode),zappar._text.prototype.layerMode=function(e){if(void 0===e)return this._layerMode||(this._layerMode=zappar.LayerMode.unset),this._layerMode;switch(this._layerMode=this.layerMode_valuify_(this._ctx,e),this._layerMode){case zappar.LayerMode.full_3d:this.fillDepthBuffer(!0),this.depthTest(!0);break;case zappar.LayerMode.test_3d:this.fillDepthBuffer(!1),this.depthTest(!0);break;case zappar.LayerMode.overlay:this.fillDepthBuffer(!1),this.depthTest(!1)}return this},zappar._text.prototype._message=function(e){zappar._messageReceiver.prototype._message.call(this,e)},zappar._text.prototype.toString=function(){return"Text"},zappar._group=function(e,t){e=e||zappar._types.GROUP,zappar._node.call(this,e,t),this._children=[]},zappar._group.methods={METHOD_PUSH:100,METHOD_REMOVE:101,METHOD_INSERT:102},zappar._group.prototype=Object.create(zappar._node.prototype),zappar._group.prototype.constructor=zappar._group,zappar._group.prototype.children=function(){return this._children.slice()},zappar._group.prototype.child=function(e){return this._children[e]},zappar._group.prototype.moveChild=function(e,t){if(e<0||e>=this._children.length||t<0||t>=this._children.length)return console.log("index out of range: group.moveChild old_index:",e,"new_index:",t,"group size:",this._children.length),this;var a=this._children[e];return this.remove(a),this.insert(t,a),this},zappar._group.prototype.insert=function(e,t){if(e>this._children.length&&(e=this._children.length),t instanceof Array)for(var a=0,r=t.length;a<r;a++)this._children.splice(e+a,0,t[a]),t[a].pushDependent(this),zappar.sendMessage([this.refId,zappar._group.methods.METHOD_INSERT,[t[a].refId,e]]);else this._children.splice(e,0,t),t.pushDependent(this),zappar.sendMessage([this.refId,zappar._group.methods.METHOD_INSERT,[t.refId,e]]);return this},zappar._group.prototype.push=function(e){if(e instanceof Array)for(var t=0,a=e.length;t<a;t++)this._children.push(e[t]),e[t].pushDependent(this),zappar.sendMessage([this.refId,zappar._group.methods.METHOD_PUSH,e[t].refId]);else this._children.push(e),e.pushDependent(this),zappar.sendMessage([this.refId,zappar._group.methods.METHOD_PUSH,e.refId]);return this},zappar._group.prototype.toString=function(){return"Group"},zappar._group.prototype.clear=function(){for(;0<this._children.length;)this.remove(this._children[0]);return this},zappar._group.prototype.remove=function(e){if(e instanceof Array)for(var t=0,a=e.length;t<a;t++){var r;-1!=(r=this._children.indexOf(e[t]))&&(zappar.sendMessage([this.refId,zappar._group.methods.METHOD_REMOVE,r]),this._children.splice(r,1)),e[t].removeDependent(this)}else-1!=(r=this._children.indexOf(e))&&(zappar.sendMessage([this.refId,zappar._group.methods.METHOD_REMOVE,r]),this._children.splice(r,1)),e.removeDependent(this);return this},zappar.Group=function(e){var t=new zappar._group(void 0,this);for(var a in e)t[a].call(t,e[a]);return t},zappar._screentransform=function(e){zappar._group.call(this,zappar._types.SCREEN_TRANSFORM,e),this.children=[],this._zoom=1,this._depth=[-10,10],this._width=100,this._height=100},zappar._screentransform.methods={PARAM_ZOOM:200,PARAM_DEPTH:201},zappar._screentransform.prototype=Object.create(zappar._group.prototype),zappar._screentransform.prototype.constructor=zappar._screentransform,zappar._screentransform.prototype._message=function(e){if("r"===e[1])return this._width=e[2],this._height=e[3],void this.emit("resize",e[2],e[3]);zappar._messageReceiver.prototype._message.call(this,e)},zappar._screentransform.prototype._depth_id=zappar._screentransform.methods.PARAM_DEPTH,zappar._screentransform.prototype.depth=function(e){return e?(this._depth=e.slice(),zappar.sendMessage([this.refId,zappar._screentransform.methods.PARAM_DEPTH,this._depth]),this):this._depth.slice()},zappar._screentransform.prototype._zoom_id=zappar._screentransform.methods.PARAM_ZOOM,zappar._screentransform.prototype.zoom=function(e){return void 0===e?this._zoom:(this._zoom=e,zappar.sendMessage([this.refId,zappar._screentransform.methods.PARAM_ZOOM,this._zoom]),this)},zappar._screentransform.prototype.on=function(e,t){zappar._group.prototype.on.call(this,e,t),"resize"===e&&t.call(this,this._width,this._height)},zappar.ScreenTransform=function(){return new zappar._screentransform(this)},zappar._cameratransform=function(e){zappar._group.call(this,zappar._types.CAMERA_TRANSFORM,e),this._focalLength=-1,this._focalLengthMode=zappar.CameraTransform.FocalLengthMode.legacy,this._nearClippingPlane=-.1,this._farClippingPlane=-150},zappar._cameratransform.methods={PARAM_FOCALLENGTH:200,PARAM_FOCALLENGTHMODE:201,PARAM_NEARCLIPPINGPLANE:202,PARAM_FARCLIPPINGPLANE:203},zappar._cameratransform.prototype=Object.create(zappar._group.prototype),zappar._cameratransform.prototype.constructor=zappar._cameratransform,zappar.CameraTransform=function(){return new zappar._cameratransform(this)},zappar.CameraTransform.FocalLengthMode={legacy:0,screen_units:1},zappar._cameratransform.prototype._message=function(e){zappar._messageReceiver.prototype._message.call(this,e)},zappar._cameratransform.prototype._focalLength_id=zappar._cameratransform.methods.PARAM_FOCALLENGTH,zappar._cameratransform.prototype.focalLength=function(e){return void 0!==e?(this._focalLength=e,zappar.sendMessage([this.refId,zappar._cameratransform.methods.PARAM_FOCALLENGTH,this._focalLength]),this):this._focalLength},zappar._cameratransform.prototype._nearClippingPlane_id=zappar._cameratransform.methods.PARAM_NEARCLIPPINGPLANE,zappar._cameratransform.prototype.nearClippingPlane=function(e){return void 0!==e?(this._nearClippingPlane=e,zappar.sendMessage([this.refId,zappar._cameratransform.methods.PARAM_NEARCLIPPINGPLANE,this._nearClippingPlane]),this):this._nearClippingPlane},zappar._cameratransform.prototype._farClippingPlane_id=zappar._cameratransform.methods.PARAM_FARCLIPPINGPLANE,zappar._cameratransform.prototype.farClippingPlane=function(e){return void 0!==e?(this._farClippingPlane=e,zappar.sendMessage([this.refId,zappar._cameratransform.methods.PARAM_FARCLIPPINGPLANE,this._farClippingPlane]),this):this._farClippingPlane},zappar._cameratransform.prototype.focalLengthMode_valuify_=zappar._valuify.enum(zappar.CameraTransform.FocalLengthMode),zappar._cameratransform.prototype._focalLengthMode_id=zappar._cameratransform.methods.PARAM_FOCALLENGTHMODE,zappar._cameratransform.prototype.focalLengthMode=function(e){return void 0!==e?(this._focalLengthMode=this.focalLengthMode_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._cameratransform.methods.PARAM_FOCALLENGTHMODE,this._focalLengthMode]),this):this._focalLengthMode},zappar.SubmeshOrder={none:0,opacity:1,opacityAndDistance:2},zappar._object=function(e){zappar._node.call(this,zappar._types.OBJECT,e),this._type=null,this._skin=null,this._hotspot=!1,this._animationFrame=0,this._regionBounds=null,this._regionScale=null,this._materials=[],this._renderSorted=!1,this._multitouch=!1,this._primaryPointer=null,this._attachmentPointsByName={},this._submeshOrder=zappar.SubmeshOrder.none,this._fallbackMaterialIndex=-1},zappar._object.methods={PARAM_HOTSPOT:100,PARAM_TYPE:101,PARAM_MATERIALS:102,PARAM_ANIMATIONFRAME:103,PARAM_REGIONBOUNDS:104,PARAM_REGIONSCALE:105,PARAM_RENDERSORTED:106,METHOD_PUSHATTACHMENTPOINT:107,PARAM_SUBMESH_RENDER_ORDER:108,PARAM_FALLBACK_MATERIAL_INDEX:109},zappar._object.prototype=Object.create(zappar._node.prototype),zappar._object.prototype.constructor=zappar._object,zappar._object.prototype.toString=function(){return"Object"},zappar._object.prototype.type_valuify_=zappar._valuify.objectType,zappar._object.prototype.type=function(e){return void 0===e?this._type:(this._type!=e&&(this._type&&this._type.removeDependent(this),this._type=this.type_valuify_(this._ctx,e),this._type?(this._type.pushDependent(this),zappar.sendMessage([this.refId,zappar._object.methods.PARAM_TYPE,this._type.refId])):(this._type=null,zappar.sendMessage([this.refId,zappar._object.methods.PARAM_TYPE,null]))),this)},zappar._object.prototype._resolveToMaterial=function(e){var t=e;return"string"==typeof e&&(t=""===e?null:(t=this._ctx.byId(e))||this._ctx.ImageTexture(e)._material),t&&t._isTexture&&(t=t._material),t},zappar._object.prototype.material_valuify_=function(e,t){var a=t;return"string"==typeof t&&(a=""===t?null:(a=e.byId(t))||e.ImageTexture(e.filenameMap(t))._material),a&&a._isTexture&&(a=a._material),a},zappar._object.prototype.materials_valuify_=function(e,t){for(var a=[],r=0,p=t.length;r<p;r++){var i=zappar._object.prototype.material_valuify_(e,t[r]);a.push(i)}return a},zappar._object.prototype.materials=function(e){if(void 0===e)return this._materials.slice();for(var t=this.materials_valuify_(this._ctx,e),a=[],r=0,p=t.length;r<p;r++){(i=t[r])?(i.pushDependent(this),a.push(i.refId)):a.push(null)}for(r=0,p=this._materials.length;r<p;r++){var i;(i=this._materials[r])&&i.removeDependent(this)}return this._materials=t,zappar.sendMessage([this.refId,zappar._object.methods.PARAM_MATERIALS,a]),this},zappar._object.prototype.material=function(e,t){if(void 0===t)return this._materials[e];var a=this._materials.slice();return a[e]=t,this.materials(a),this},zappar._object.prototype.skin=function(e){return this.material(0,e)},zappar._object.prototype.hotspot=function(e){return void 0!==e?(e!=this._hotspot&&(this._hotspot=e,zappar.sendMessage([this.refId,zappar._object.methods.PARAM_HOTSPOT,this._hotspot])),this):this._hotspot},zappar._object.prototype._animationFrame_id=zappar._object.methods.PARAM_ANIMATIONFRAME,zappar._object.prototype.animationFrame=function(e){return void 0!==e?(e!=this._animationFrame&&(this._animationFrame=e,zappar.sendMessage([this.refId,zappar._object.methods.PARAM_ANIMATIONFRAME,this._animationFrame])),this):this._animationFrame},zappar._object.prototype._regionBounds_id=zappar._object.methods.PARAM_REGIONBOUNDS,zappar._object.prototype.regionBounds=function(e){return void 0===e?null!==this._regionBounds?this._regionBounds.slice():null:(this._regionBounds=null===e?null:e.slice(),zappar.sendMessage([this.refId,zappar._object.methods.PARAM_REGIONBOUNDS,this._regionBounds]),this)},zappar._object.prototype._regionScale_id=zappar._object.methods.PARAM_REGIONSCALE,zappar._object.prototype.regionScale=function(e){return void 0===e?null!==this._regionScale?this._regionScale.slice():null:(this._regionScale=null===e?null:e.slice(),zappar.sendMessage([this.refId,zappar._object.methods.PARAM_REGIONSCALE,this._regionScale]),this)},zappar._object.prototype._renderSorted_id=zappar._object.methods.PARAM_RENDERSORTED,zappar._object.prototype.renderSorted=function(e){return void 0!==e?(this._renderSorted=e,zappar.sendMessage([this.refId,zappar._object.methods.PARAM_RENDERSORTED,this._renderSorted]),this):this._renderSorted},zappar._object.prototype.multitouch=function(e){return void 0===e?this._multitouch:(this._multitouch=e,this)},zappar._object.prototype._message=function(e){if("hm"!==e[1])if("ho"!==e[1])if("he"!==e[1])if("hl"!==e[1])if("hd"!==e[1]){if("hu"!==e[1])return"bounds"===e[1]?(this._bounds=[],this._bounds[0]=e[2][0].slice(),void(this._bounds[1]=e[2][1].slice())):void zappar._node.prototype._message.call(this,e);this._pointerUp(e)}else this._pointerDown(e);else this._pointerLeave(e);else this._pointerEnter(e);else this._multitouch&&this._pointersMove(e[2]);else this._pointerMove(e)},zappar._object.prototype._pointerMove=function(e){!this._multitouch&&this._primaryPointer!==e[2]||this.emit("pointermove",{pointerId:e[2],pointerDown:e[3],screenPosition:e[4],localPosition:e[5],localUv:e[6],isPrimary:this._primaryPointer===e[2]})},zappar._object.prototype._pointersMove=function(e){for(var t={},a=0,r=e.length;a<r;a++){var p=e[a];t[p[0]]={pointerId:p[0],pointerDown:p[1],screenPosition:p[2],localPosition:p[3],localUv:p[4],isPrimary:this._primaryPointer===p[0]}}this.emit("pointersmove",t)},zappar._object.prototype._pointerDown=function(e){!this._multitouch&&this._primaryPointer!==e[2]||this.emit("pointerdown",{pointerId:e[2],pointerDown:e[3],screenPosition:e[4],localPosition:e[5],localUv:e[6],isPrimary:this._primaryPointer===e[2]})},zappar._object.prototype._pointerUp=function(e){!this._multitouch&&this._primaryPointer!==e[2]||this.emit("pointerup",{pointerId:e[2],pointerDown:!1,isPrimary:this._primaryPointer===e[2]})},zappar._object.prototype._pointerEnter=function(e){null===this._primaryPointer&&(this._primaryPointer=e[2]),!this._multitouch&&this._primaryPointer!==e[2]||this.emit("pointerenter",{pointerId:e[2],pointerDown:e[3],screenPosition:e[4],localPosition:e[5],localUv:e[6],isPrimary:this._primaryPointer===e[2]})},zappar._object.prototype._pointerLeave=function(e){if(this._multitouch||this._primaryPointer===e[2]){var t={pointerId:e[2],pointerDown:e[3],isPrimary:this._primaryPointer===e[2]};t.isPrimary&&(this._primaryPointer=null),this.emit("pointerleave",t)}},zappar._object.prototype.on=function(e,t){return"pointerenter"!==e&&"pointerleave"!==e&&"pointerdown"!==e&&"pointerup"!==e&&"pointermove"!==e&&"pointersmove"!==e||this.hotspot(!0),zappar._node.prototype.on.call(this,e,t)},zappar._object.prototype.layerMode_valuify_=zappar._valuify.enum(zappar.LayerMode),zappar._object.prototype.layerMode=function(e){if(void 0===e)return this._layerMode||(this._layerMode=zappar.LayerMode.unset),this._layerMode;switch(this._layerMode=this.layerMode_valuify_(this._ctx,e),this._layerMode){case zappar.LayerMode.full_3d:this.fillDepthBuffer(!0),this.depthTest(!0);break;case zappar.LayerMode.test_3d:this.fillDepthBuffer(!1),this.depthTest(!0);break;case zappar.LayerMode.overlay:this.fillDepthBuffer(!1),this.depthTest(!1)}return this},zappar._object.prototype.attachmentPoint=function(e){var t=this._attachmentPointsByName[e];return t||(t=this._ctx.ObjectAttachmentPoint(),this._pushAttachmentPoint(t,e),this._attachmentPointsByName[e]=t),t},zappar._object.prototype._pushAttachmentPoint=function(e,t){zappar.sendMessage([this.refId,zappar._object.methods.METHOD_PUSHATTACHMENTPOINT,[e.refId,t]])},zappar._object.prototype.reorderMeshes_valuify_=zappar._valuify.enum(zappar.SubmeshOrder),zappar._object.prototype.reorderMeshes=function(e){return void 0!==e?(this._submeshOrder=this.reorderMeshes_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._object.methods.PARAM_SUBMESH_RENDER_ORDER,this._submeshOrder]),this):this._submeshOrder},zappar._object.prototype._fallbackMaterialIndex_id=zappar._object.methods.PARAM_FALLBACK_MATERIAL_INDEX,zappar._object.prototype.fallbackMaterialIndex=function(e){return void 0!==e?(e!=this._fallbackMaterialIndex&&(this._fallbackMaterialIndex=e,zappar.sendMessage([this.refId,zappar._object.methods.PARAM_FALLBACK_MATERIAL_INDEX,this._fallbackMaterialIndex])),this):this._fallbackMaterialIndex},zappar.Object=function(e){var t=new zappar._object(this);for(var a in e)t[a].call(t,e[a]);return t},zappar.calendar={refId:0},zappar.calendar._methods={METHOD_ADD:50},zappar.calendar.add=function(e){void 0!==e.start&&(e.start=e.start.getTime()),void 0!==e.end&&(e.end=e.end.getTime()),void 0!==e.recurrence&&void 0!==e.recurrence.end&&(e.recurrence.end=e.recurrence.end.getTime()),zappar.sendMessage([zappar.calendar.refId,zappar.calendar._methods.METHOD_ADD,e])},zappar.Calendar={},zappar.Calendar.WeekDay={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6},zappar.Calendar.Month={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11},zappar.Calendar.Frequency={daily:0,weekly:1,monthly:2,yearly:3},zappar.contacts={refId:0},zappar.contacts._methods={METHOD_ADD:50},zappar.contacts.add=function(e){zappar.sendMessage([zappar.contacts.refId,zappar.contacts._methods.METHOD_ADD,e])},zappar.LaunchTarget={navigate:"navigate",embed:!0,noembed:!1},zappar._device=function(e){zappar._messageReceiver.call(this,zappar._types.DEVICE,e),this._themeColor=null,this._socialShare=!0,this._snapshotMessage="#ZapparPowered",this._gifMessage="#ZapparPowered",this._retrieveTokens={},this._nextRetrieveToken=0,this._showPhotoButton=!0,this._showGifButton=!0,this._showSwitchCameraButton=!0,this._snapshotCallbacks={},this._nextSnapshotCallbackToken=0,this._parsedQueryString=void 0,this._worldTrackingAvailabilityTokens={},this._nextWorldTrackingAvailabilityToken=0,this._worldTrackingInstallTokens={},this._nextWorldTrackingInstallToken=0,this._webFrameCallbacks={},this._nextWebFrameCallbackToken=0},zappar._device.methods={METHOD_VIBRATE:50,METHOD_TAKESNAPSHOT:51,METHOD_TAKEGIF:52,METHOD_THEMECOLOR:53,METHOD_LAUNCHURL:54,METHOD_PLAYFULLSCREENVIDEO:55,METHOD_SAVETODEVICE:56,METHOD_LOADCOMPLETE:57,METHOD_STORE:58,METHOD_RETRIEVE:59,METHOD_RESET:60,METHOD_SHOWPHOTOBUTTON:61,METHOD_SHOWGIFBUTTON:62,METHOD_SHOWSWITCHCAMERABUTTON:63,METHOD_MESSAGEHOST:64,METHOD_CLOSE:65,METHOD_TAKESNAPSHOT_TO_TEXTURE:66,METHOD_UPDATEWORLDTRACKINGAVAILABILITY:67,METHOD_REQUESTWORLDTRACKINGINSTALL:68,METHOD_PLAYSYSTEMCAMERASHUTTERSOUND:69,METHOD_LAUNCHWEBFRAME:70},zappar._device.prototype=Object.create(zappar._messageReceiver.prototype),zappar._device.prototype.constructor=zappar._device,zappar._device.prototype._processRetrieve=function(e){var t=e[2][0],a=e[2][1],r=void 0;0!==a.length&&(r=JSON.parse(a));var p=this._retrieveTokens[t];delete this._retrieveTokens[t],p(r)},zappar._device.prototype._processSnapshotCallback=function(e){var t=e[2][0],a=e[2][1],r=e[2][2];if(null!=t){var p=this._snapshotCallbacks[t];p&&(delete this._snapshotCallbacks[t],p(a,r))}},zappar._device.prototype._processWebFrameCallback=function(e){var t=e[2][0],a=e[2][1];if(a){a=a.slice();for(var r=0;r<a.length;r++)try{a[r]=JSON.parse(a[r])}catch(e){}}if(null!=t){var p=this._webFrameCallbacks[t];p&&(delete this._webFrameCallbacks[t],p(a))}},zappar._device.prototype._processSnapShotToTextureCallBack=function(e){var t=e[2][0],a=e[2][1];if(null!=t){var r=this._snapshotCallbacks[t];r&&(delete this._snapshotCallbacks[t],r(zappar.objectsByRef[a]))}},zappar._device.prototype._processWorldTrackingAvailabilityCallback=function(e){var t=e[2][0],a=e[2][1];null!=a&&a===zappar.Device.WorldTrackingAvailability.supported_installed!==this.supportsWorldTracking()&&(zappar._deviceCapabilities^=zappar._deviceCapabilityWorldTracking);if(null!=t){var r=this._worldTrackingAvailabilityTokens[t];r&&(delete this._worldTrackingAvailabilityTokens[t],r(a))}},zappar._device.prototype._processWorldTrackingInstallCallback=function(e){var t=e[2][0],a=e[2][1];if(null!=t){var r=this._worldTrackingInstallTokens[t];r&&(delete this._worldTrackingInstallTokens[t],r(a))}},zappar._device.prototype._message=function(e){"d"!==e[1]?"r"!==e[1]?"s"!==e[1]?"wf"!==e[1]?"t"!==e[1]?"wta"!==e[1]?"wti"!==e[1]?zappar._messageReceiver.prototype._message.call(this,e):this._processWorldTrackingInstallCallback(e):this._processWorldTrackingAvailabilityCallback(e):this._processSnapShotToTextureCallBack(e):this._processWebFrameCallback(e):this._processSnapshotCallback(e):this._processRetrieve(e):this._deepLinkId=e[2]},zappar._device.prototype.vibrate=function(){return zappar.sendMessage([this.refId,zappar._device.methods.METHOD_VIBRATE,null]),this},zappar._device.prototype.socialShare=function(e){return void 0===e?this._socialShare:(this._socialShare=e,this)},zappar._device.prototype.snapshotMessage=function(e){return void 0===e?this._snapshotMessage:(this._snapshotMessage=e,this)},zappar._device.prototype.gifMessage=function(e){return void 0===e?this._gifMessage:(this._gifMessage=e,this)},zappar._device.prototype.snapshot=function(e,t){var a=e;void 0===e?a={message:this._snapshotMessage,social:this._socialShare}:"string"==typeof e&&(a={message:e,social:this._socialShare});var r=this._nextSnapshotCallbackToken++;this._snapshotCallbacks[r]=t,zappar.sendMessage([this.refId,zappar._device.methods.METHOD_TAKESNAPSHOT,[a,r]])},zappar._device.prototype.launchWebFrame=function(e,t,a){var r=-1;t&&(r=this._nextWebFrameCallbackToken++,this._webFrameCallbacks[r]=t),a=a||{},zappar.sendMessage([this.refId,zappar._device.methods.METHOD_LAUNCHWEBFRAME,[e,r,a]])},zappar._device.prototype.launchWebFrame=function(e,t,a){var r=-1;t&&(r=this._nextWebFrameCallbackToken++,this._webFrameCallbacks[r]=t),a=a||{},zappar.sendMessage([this.refId,zappar._device.methods.METHOD_LAUNCHWEBFRAME,[e,r,a]])},zappar._device.prototype.snapshotToTexture=function(e,t){void 0===e&&(e=this._ctx.DataTexture());var a;a=this._nextSnapshotCallbackToken++,t&&(this._snapshotCallbacks[a]=t),zappar.sendMessage([this.refId,zappar._device.methods.METHOD_TAKESNAPSHOT_TO_TEXTURE,[e.refId,a]])},zappar._device.prototype.deepLinkId=function(){return this._deepLinkId},zappar._device.prototype.gif=function(e,t){var a=e;void 0===e?a={message:this._gifMessage,social:this._socialShare}:"string"==typeof e&&(a={message:e,social:this._socialShare}),zappar.sendMessage([this.refId,zappar._device.methods.METHOD_TAKEGIF,a]);var r=0,p=0,i=function(e){0===p&&(p=e),100<e-p&&(p=e,30<=++r&&(t&&t(),zappar.off("frame",i)))};zappar.on("frame",i)},zappar._device.prototype.themeColor=function(e){return void 0===e?this._themeColor:(this._themeColor=e?e.slice():e,zappar.sendMessage([this.refId,zappar._device.methods.METHOD_THEMECOLOR,this._themeColor]),this)},zappar._device.prototype.launchUrl=function(e,t){zappar.sendMessage([this.refId,zappar._device.methods.METHOD_LAUNCHURL,[e,t]])},zappar._device.prototype.messageHost=function(e){zappar.sendMessage([this.refId,zappar._device.methods.METHOD_MESSAGEHOST,e])},zappar._device.prototype.playFullscreenVideo=function(e){zappar.sendMessage([this.refId,zappar._device.methods.METHOD_PLAYFULLSCREENVIDEO,e])},zappar._device.prototype.saveToDevice=function(e){zappar.sendMessage([this.refId,zappar._device.methods.METHOD_SAVETODEVICE,e])},zappar._device.prototype.store=function(e,t){var a=JSON.stringify(t);return zappar.sendMessage([this.refId,zappar._device.methods.METHOD_STORE,[e,a]]),this},zappar._device.prototype.retrieve=function(e,t){var a=this._nextRetrieveToken;return this._nextRetrieveToken++,this._retrieveTokens[a]=t,zappar.sendMessage([this.refId,zappar._device.methods.METHOD_RETRIEVE,[a,e]]),this},zappar._device.prototype.loadComplete=function(){zappar.sendMessage([this.refId,zappar._device.methods.METHOD_LOADCOMPLETE,null])},zappar._device.prototype.reset=function(){zappar.sendMessage([this.refId,zappar._device.methods.METHOD_RESET,null])},zappar._device.prototype.showPhotoButton=function(e){return void 0===e?this._showPhotoButton:(this._showPhotoButton=e,zappar.sendMessage([this.refId,zappar._device.methods.METHOD_SHOWPHOTOBUTTON,this._showPhotoButton]),this)},zappar._device.prototype.showGifButton=function(e){return void 0===e?this._showGifButton:(this._showGifButton=e,zappar.sendMessage([this.refId,zappar._device.methods.METHOD_SHOWGIFBUTTON,this._showGifButton]),this)},zappar._device.prototype.showSwitchCameraButton=function(e){return void 0===e?this._showSwitchCameraButton:(this._showSwitchCameraButton=e,zappar.sendMessage([this.refId,zappar._device.methods.METHOD_SHOWSWITCHCAMERABUTTON,this._showSwitchCameraButton]),this)},zappar._device.prototype.close=function(){zappar.sendMessage([this.refId,zappar._device.methods.METHOD_CLOSE,null])},zappar._device.prototype.hasGyro=function(){return zappar._deviceCapabilities&zappar._deviceCapabilityGyro},zappar._device.prototype.supportsWorldTracking=function(){return 0!=(zappar._deviceCapabilities&zappar._deviceCapabilityWorldTracking)},zappar._device.prototype.updateWorldTrackingAvailability=function(e){var t=this._nextWorldTrackingAvailabilityToken;return this._nextWorldTrackingAvailabilityToken++,this._worldTrackingAvailabilityTokens[t]=e,zappar.sendMessage([this.refId,zappar._device.methods.METHOD_UPDATEWORLDTRACKINGAVAILABILITY,t]),this},zappar._device.prototype.requestWorldTrackingInstall=function(e,t,a){var r=this._nextWorldTrackingInstallToken;return this._nextWorldTrackingInstallToken++,this._worldTrackingInstallTokens[r]=a,zappar.sendMessage([this.refId,zappar._device.methods.METHOD_REQUESTWORLDTRACKINGINSTALL,[r,e,t]]),this},zappar._device.prototype.hasSystemCameraShutterSound=function(){return 0!=(zappar._deviceCapabilities&zappar._deviceCapabilitySystemCameraShutterSound)},zappar._device.prototype.playSystemCameraShutterSound=function(){return zappar.sendMessage([this.refId,zappar._device.methods.METHOD_PLAYSYSTEMCAMERASHUTTERSOUND,null]),this},zappar._device.prototype.launchAppStore=function(){-1<navigator.userAgent.toLowerCase().indexOf("Android")?this.launchUrl("market://details?id=com.zappar.Zappar",!1):this.launchUrl("http://itunes.apple.com/us/app/zappar/id429885268?mt=8&ls=1",!1)},zappar._device.prototype.launchMethod=function(){return zappar._deviceLaunchMethod},zappar._device.prototype.appIdentifier=function(){return zappar._deviceAppIdentifier},zappar._device.prototype.appData=function(){return zappar._deviceHostAppData},zappar._device.prototype.userLanguage=function(){return navigator.language.toLowerCase()},zappar._device.prototype.queryStringRaw=function(){return zappar._deviceQueryString},zappar._device.prototype.queryStringParameter=function(e){if(!this._parsedQueryString){this._parsedQueryString={};for(var t=zappar._deviceQueryString.split("&"),a=0,r=t.length;a<r;a++){var p=t[a].split("="),i=null;2<=p.length&&(i=decodeURIComponent(p[1]));var s=this._parsedQueryString[p[0]]||[];s.push(i),this._parsedQueryString[p[0]]=s}}return this._parsedQueryString[e]},zappar.Device=function(){return new zappar._device(this)},zappar.Device.LaunchMethod={unknown:0,scan:1,external_link:2,internal_link:3,favorites:4,recents:5,menu:6},zappar.Device.WorldTrackingAvailability={unknown_error:0,unknown_checking:1,unknown_timed_out:2,unsupported_device_not_capable:100,supported_not_installed:201,supported_apk_too_old:202,supported_installed:203},zappar.Device.WorldTrackingInstallStatus={installed:0,install_requested:1,error:2},zappar.Vec3={add:function(e,t){return[e[0]+t[0],e[1]+t[1],e[2]+t[2]]},subtract:function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},magnitude:function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])},dotMultiply:function(e,t){return[e[0]*t[0],e[1]*t[1],e[2]*t[2]]},scalarMultiply:function(e,t){return[e[0]*t,e[1]*t,e[2]*t]}},zappar.Mat={multiply:function(e,t){if(9===e.length||9===t.length)return[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]]},createRotationMatrix:function(e){var t=Math.cos(e[0]),a=Math.sin(e[0]),r=Math.cos(e[1]),p=Math.sin(e[1]),i=Math.cos(e[2]),s=Math.sin(e[2]);return[r*i,-s*r,p,i*a*p+s*t,t*i-a*p*s,-r*a,a*s-t*p*i,p*s*t+i*a,t*r]},anglesFromRotationMatrix:function(e,t){t=t||[0,0,0];var a=0,r=0,p=0,i=0,s=0,o=0,n=e[0],_=e[1],h=e[2],d=e[5],c=e[8],l=e[3],u=e[6];Math.abs(h)<.99999?(r=Math.asin(h),s=Math.PI-r,a=Math.atan2(-d/Math.cos(r),c/Math.cos(r)),i=Math.atan2(-d/Math.cos(s),c/Math.cos(s)),p=Math.atan2(-_/Math.cos(r),n/Math.cos(r)),o=Math.atan2(-_/Math.cos(s),n/Math.cos(s))):p=o=h<0?(r=s=-Math.PI/2,(a=i=t[0])+Math.atan2(l,u)):(r=s=Math.PI/2,a=i=t[0],Math.atan2(l,-u)-a);var z=[a,r,p],f=[i,s,o];z[0]+=2*Math.PI*Math.round((t[0]-z[0])/(2*Math.PI)),z[1]+=2*Math.PI*Math.round((t[1]-z[1])/(2*Math.PI)),z[2]+=2*Math.PI*Math.round((t[2]-z[2])/(2*Math.PI)),f[0]+=2*Math.PI*Math.round((t[0]-f[0])/(2*Math.PI)),f[1]+=2*Math.PI*Math.round((t[1]-f[1])/(2*Math.PI)),f[2]+=2*Math.PI*Math.round((t[2]-f[2])/(2*Math.PI));var M=Z.Vec3.magnitude(Z.Vec3.subtract(z,t));return Z.Vec3.magnitude(Z.Vec3.subtract(f,t))<M?f:z}},zappar._prompt=function(e){zappar._messageReceiver.call(this,zappar._types.PROMPT,e),this._title="Zappar",this._text="",this._defaultValue="",this._filterProfanity=!1,this._maxLength=255},zappar._prompt.methods={METHOD_SHOW:50},zappar._prompt.prototype=Object.create(zappar._messageReceiver.prototype),zappar._prompt.prototype.constructor=zappar._prompt,zappar._prompt.prototype.show=function(){return zappar.sendMessage([this.refId,zappar._prompt.methods.METHOD_SHOW,[this._title,this._text,this._defaultValue,this._maxLength,this._filterProfanity]]),this},zappar._prompt.prototype.title=function(e){return void 0===e?this._title:(this._title=e,this)},zappar._prompt.prototype.text=function(e){return void 0===e?this._text:(this._text=e,this)},zappar._prompt.prototype.defaultValue=function(e){return void 0===e?this._defaultValue:(this._defaultValue=e,this)},zappar._prompt.prototype.filterProfanity=function(e){return void 0===e?this._filterProfanity:(this._filterProfanity=e,this)},zappar._prompt.prototype.maxLength=function(e){return void 0===e?this._maxLength:(this._maxLength=e,this)},zappar._prompt.prototype._message=function(e){if("d"===e[1])return null===e[2]?this.emit("cancel"):this.emit("confirm",e[2]),void this.emit("done",e[2]);zappar._messageReceiver.prototype._message.call(this,e)},zappar.Prompt=function(e){var t=new zappar._prompt(this);for(var a in e)t[a].call(t,e[a]);return t},zappar.prompt=function(e,t){var a=zappar.Prompt({title:"Zappar",text:e});return a.on("done",function(e){t(e)}),a.show(),a},zappar._keyboard=function(e){zappar._messageReceiver.call(this,zappar._types.KEYBOARD,e)},zappar._keyboard.methods={METHOD_SHOW:50,METHOD_HIDE:51},zappar._keyboard.prototype=Object.create(zappar._messageReceiver.prototype),zappar._keyboard.prototype.constructor=zappar._keyboard,zappar._keyboard.prototype.show=function(){return zappar.sendMessage([this.refId,zappar._keyboard.methods.METHOD_SHOW,null]),this},zappar._keyboard.prototype.hide=function(){return zappar.sendMessage([this.refId,zappar._keyboard.methods.METHOD_HIDE,null]),this},zappar._keyboard.prototype._message=function(e){"k"!==e[1]?"b"!==e[1]?zappar._messageReceiver.prototype._message.call(this,e):this.emit("backspace"):this.emit("key",e[2])},zappar.Keyboard=function(){return new zappar._keyboard(this)},zappar.Helper={degToRad:function(e){for(var t=e.slice(),a=0;a<t.length;a++)t[a]*=.017453292519943295;return t},radToDeg:function(e){for(var t=e.slice(),a=0;a<t.length;a++)t[a]/=.017453292519943295;return t},combineRotations:function(e,t,a){var r=Z.Mat.createRotationMatrix(e),p=Z.Mat.createRotationMatrix(t),i=zappar.Mat.multiply(r,p);return Z.Mat.anglesFromRotationMatrix(i,a)},combineDegRotations:function(e,t,a){e=Z.Helper.degToRad(e),t=Z.Helper.degToRad(t),a=Z.Helper.degToRad(a);var r=Z.Helper.combineRotations(e,t,a);return Z.Helper.radToDeg(r)}},zappar.prompt=function(t,a,r){return setTimeout(function(){var e=prompt(t,a,r);r(e)},20),zappar},zappar.getJSON=function(e,t,a){var r=new XMLHttpRequest;return r.onreadystatechange=function(){4===r.readyState&&(200===r.status?t&&t(JSON.parse(r.responseText)):a&&a(r))},r.open("GET",e,!0),r.send(),r},zappar._target=function(e,t){this._id=e,zappar._messageReceiver.call(this,zappar._types.TARGET,t),this._targetFinder=null,this._instances=[],this._identifier=null},zappar._target.methods={METHOD_ADDINSTANCE:50},zappar._target.prototype=Object.create(zappar._messageReceiver.prototype),zappar._target.prototype.constructor=zappar._target,zappar._target.prototype._message=function(e){if("instance"===e[1]){var t=this._ctx.TargetInstance(e[2]);return zappar.camera.push(t),(t._target=this)._instances.push(t),zappar.sendMessage([this.refId,zappar._target.methods.METHOD_ADDINSTANCE,[t.refId,e[2]]]),this.emit("newinstance",t),this._targetFinder.emit("newinstance",t),t.emit("seen"),this.emit("seen",t),void this._targetFinder.emit("seen",t)}zappar._messageReceiver.prototype._message.call(this,e)},zappar._target.prototype.identifier=function(e){return void 0===e?this._identifier:(this._identifier=e,this)},zappar._target.prototype.toString=function(){return"Target"},zappar.Target=function(e){return new zappar._target(e,this)},zappar._targetInstance=function(e,t){this._id=e,zappar._node.call(this,zappar._types.TARGETINSTANCE,t),this._target=null,this._useGyro=!1},zappar._targetInstance.methods={PARAM_USEGYRO:101},zappar._targetInstance.prototype=Object.create(zappar._node.prototype),zappar._targetInstance.prototype.constructor=zappar._targetInstance,zappar._targetInstance.prototype._message=function(e){return"seen"===e[1]?(this.emit("seen"),this._target.emit("seen",this),void this._target._targetFinder.emit("seen",this)):"notseen"===e[1]?(this.emit("notseen"),this._target.emit("notseen",this),void this._target._targetFinder.emit("notseen",this)):void zappar._messageReceiver.prototype._message.call(this,e)},zappar._targetInstance.prototype._useGyro_id=zappar._targetInstance.methods.PARAM_USEGYRO,zappar._targetInstance.prototype.useGyro=function(e){return void 0===e?this._useGyro:(this._useGyro=e,zappar.sendMessage([this.refId,zappar._targetInstance.methods.PARAM_USEGYRO,this._useGyro]),this)},zappar._targetInstance.prototype.identifier=function(e){return this._target.identifier(e)},zappar._targetInstance.prototype.toString=function(){return"TargetInstance"},zappar.TargetInstance=function(e){return new zappar._targetInstance(e,this)},zappar._billboard=function(e){zappar._group.call(this,zappar._types.BILLBOARD,e),this._axis=[0,0,0]},zappar._billboard.methods={PARAM_AXIS:200},zappar._billboard.prototype=Object.create(zappar._group.prototype),zappar._billboard.prototype.constructor=zappar._billboard,zappar._billboard.prototype.toString=function(){return"Billboard"},zappar._billboard.prototype._axis_id=zappar._billboard.methods.PARAM_AXIS,zappar._billboard.prototype.axis=function(e){return e?(this._axis=e.slice(),zappar.sendMessage([this.refId,zappar._billboard.methods.PARAM_AXIS,this._axis]),this):this._axis.slice()},zappar.Billboard=function(){return new zappar._billboard(this)},zappar._screenSizeConstrain=function(e){zappar._group.call(this,zappar._types.SCREENSIZECONSTRAIN,e),this._displaySizeMin=-1,this._displaySizeMax=-1,this._mode=zappar.ScreenSizeConstrain.Mode.legacy},zappar._screenSizeConstrain.methods={PARAM_DISPLAYSIZEMIN:200,PARAM_DISPLAYSIZEMAX:201,PARAM_MODE:202},zappar._screenSizeConstrain.prototype=Object.create(zappar._group.prototype),zappar._screenSizeConstrain.prototype.constructor=zappar._screenSizeConstrain,zappar.ScreenSizeConstrain=function(){return new zappar._screenSizeConstrain(this)},zappar.ScreenSizeConstrain.Mode={legacy:0,rotation_invariant:1},zappar._screenSizeConstrain.prototype.toString=function(){return"ScreenSizeConstrain"},zappar._screenSizeConstrain.prototype._displaySizeMin_id=zappar._screenSizeConstrain.methods.PARAM_DISPLAYSIZEMIN,zappar._screenSizeConstrain.prototype.displaySizeMin=function(e){return void 0!==e?(e!=this._displaySizeMin&&(this._displaySizeMin=e,zappar.sendMessage([this.refId,zappar._screenSizeConstrain.methods.PARAM_DISPLAYSIZEMIN,this._displaySizeMin])),this):this._displaySizeMin},zappar._screenSizeConstrain.prototype._displaySizeMax_id=zappar._screenSizeConstrain.methods.PARAM_DISPLAYSIZEMAX,zappar._screenSizeConstrain.prototype.displaySizeMax=function(e){return void 0!==e?(e!=this._displaySizeMax&&(this._displaySizeMax=e,zappar.sendMessage([this.refId,zappar._screenSizeConstrain.methods.PARAM_DISPLAYSIZEMAX,this._displaySizeMax])),this):this._displaySizeMax},zappar._screenSizeConstrain.prototype.mode_valuify_=zappar._valuify.enum(zappar.ScreenSizeConstrain.Mode),zappar._screenSizeConstrain.prototype._mode_id=zappar._screenSizeConstrain.methods.PARAM_MODE,zappar._screenSizeConstrain.prototype.mode=function(e){return void 0!==e?(this._mode=this.mode_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._screenSizeConstrain.methods.PARAM_MODE,this._mode]),this):this._mode},zappar._bezier=function(e){zappar._group.call(this,zappar._types.BEZIER,e),this._points=[],this._distance=0},zappar._bezier.methods={PARAM_POINTS:200,PARAM_DISTANCE:201},zappar._bezier.prototype=Object.create(zappar._group.prototype),zappar._bezier.prototype.constructor=zappar._bezier,zappar._bezier.prototype.toString=function(){return"Bezier"},zappar._bezier.prototype._pointsSlice=function(e){for(var t=e.slice(),a=0,r=t.length;a<r;a++){t[a]=t[a].slice();for(var p=t[a],i=0,s=p.length;i<s;i++)p[i]=p[i].slice()}return t},zappar._bezier.prototype._points_id=zappar._bezier.methods.PARAM_POINTS,zappar._bezier.prototype.points=function(e){return void 0!==e?(this._points=this._pointsSlice(e),zappar.sendMessage([this.refId,zappar._bezier.methods.PARAM_POINTS,this._points]),this):this._pointsSlice(this._points)},zappar._bezier.prototype._distance_id=zappar._bezier.methods.PARAM_DISTANCE,zappar._bezier.prototype.distance=function(e){return void 0!==e?(e!=this._distance&&(this._distance=e,zappar.sendMessage([this.refId,zappar._bezier.methods.PARAM_DISTANCE,this._distance])),this):this._distance},zappar.Bezier=function(){return new zappar._bezier(this)},zappar._targetFinder=function(e,t){zappar._messageReceiver.call(this,zappar._types.TARGETFINDER,t),this._targets=[],this._enabled=!0,this._defaultScale=1,e&&this.source(e)},zappar._targetFinder.methods={METHOD_SRC:50,METHOD_ADDTARGET:51,PARAM_ENABLED:52,PARAM_DEFAULTSCALE:53},zappar._targetFinder.prototype=Object.create(zappar._messageReceiver.prototype),zappar._targetFinder.prototype.constructor=zappar._targetFinder,zappar._targetFinder.prototype.source_valuify_=zappar._valuify.mediaFile,zappar._targetFinder.prototype.source=function(e){if(void 0===e)return this._source;var t=this;return this.one("seen",function(){t._ctx.stats.logTarget(e)}),this._source=this.source_valuify_(this._ctx,e),this._ctx.FileLoader(this._source).on("downloaded",function(e){zappar.sendMessage([t.refId,zappar._targetFinder.methods.METHOD_SRC,e])}),this},zappar._targetFinder.prototype.enabled=function(e){return void 0!==e?(this._enabled=e,zappar.sendMessage([this.refId,zappar._targetFinder.methods.PARAM_ENABLED,this._enabled]),this):this._enabled},zappar._targetFinder.prototype.defaultScale=function(e){return void 0!==e?(this._defaultScale=e,zappar.sendMessage([this.refId,zappar._targetFinder.methods.PARAM_DEFAULTSCALE,this._defaultScale]),this):this._defaultScale},zappar._targetFinder.prototype._message=function(e){if("target"===e[1]){var t=this._ctx.Target(e[2]);return t.identifier(e[3]),(t._targetFinder=this)._targets.push(t),zappar.sendMessage([this.refId,zappar._targetFinder.methods.METHOD_ADDTARGET,[t.refId,e[2],e[3]]]),void this.emit("newtarget",t)}zappar._messageReceiver.prototype._message.call(this,e)},zappar._targetFinder.prototype.toString=function(){return"TargetFinder"},zappar.TargetFinder=function(e){return new zappar._targetFinder(e,this)},zappar.Orientation={LANDSCAPE:0,PORTRAIT:1,LANDSCAPEINVERTED:2,PORTRAITINVERTED:3,UNKNOWN:4},zappar._accelerometer=function(e){zappar._messageReceiver.call(this,zappar._types.ACCELEROMETER,e),this._orientation=zappar.Orientation.UNKNOWN},zappar._accelerometer.prototype=Object.create(zappar._messageReceiver.prototype),zappar._accelerometer.prototype.constructor=zappar._accelerometer,zappar._accelerometer.prototype.orientation=function(){return this._orientation},zappar._accelerometer.prototype._message=function(e){if("o"===e[1])return this._orientation=e[2],void this.emit(zappar._accelerometer._orientationEventMapping[this._orientation],this._orientation);zappar._messageReceiver.prototype._message.call(this,e)},zappar._accelerometer._orientationEventMapping=["landscape","portrait","landscapeinverted","portraitinverted","unknown"],zappar.Accelerometer=function(){return new zappar._accelerometer(this)},zappar._tagManager=function(e){zappar._messageReceiver.call(this,zappar._types.TAGMANAGER,e),this._tags={}},zappar._tagManager.methods={METHOD_PUSHTAG:50,METHOD_REMOVETAG:51},zappar._tagManager.prototype=Object.create(zappar._messageReceiver.prototype),zappar._tagManager.prototype.constructor=zappar._tagManager,zappar._tagManager.prototype.registerTags=function(e,t){"string"==typeof t&&(t=[t]);for(var a=0,r=t.length;a<r;a++){var p=t[a];0===p.indexOf("global:")&&this!==zappar.tagManager&&zappar.tagManager.registerTags(e,p);var i=this._tags[p],s=(i=i||(this._tags[p]=[])).indexOf(e);0<=s&&i.splice(s,1),e.refId&&zappar.sendMessage([this.refId,zappar._tagManager.methods.METHOD_PUSHTAG,[p,e.refId]]),i.push(e)}return this},zappar._tagManager.prototype.unregisterTags=function(e,t){"string"==typeof t&&(t=[t]);for(var a=0,r=t.length;a<r;a++){var p=t[a];0===p.indexOf("global:")&&this!==zappar.tagManager&&zappar.tagManager.unregisterTags(e,p);var i=this._tags[p];if(i){var s=i.indexOf(e);0<=s&&(i.splice(s,1),e.refId&&zappar.sendMessage([this.refId,zappar._tagManager.methods.METHOD_REMOVETAG,[p,e.refId]]))}}return this},zappar._tagManager.prototype.managerForTag=function(e){return 0===e.indexOf("global:")&&this!==zappar.tagManager?zappar.tagManager:this},zappar._tagManager.prototype.byTag=function(e){return 0===e.indexOf("global:")&&this!==zappar.tagManager?zappar.tagManager.byTag(e):this._tags[e]||[]},zappar._tagManager.prototype.tagCall=function(e,t){for(var a=this.byTag(e),r=Array.prototype.splice.call(arguments,2),p=[],i=0,s=a.length;i<s;i++){var o=a[i];"function"==typeof o[t]&&p.push(o[t].apply(o,r))}return p},zappar.TagManager=function(){return new zappar._tagManager(this)},zappar.finger=[],zappar._deviceCapabilityGyro=2,zappar._deviceCapabilityFrontCamera=4,zappar._deviceCapabilityWorldTracking=8,zappar._deviceCapabilitySystemCameraShutterSound=16,zappar._deviceCapabilities=0,zappar._deviceLaunchMethod=zappar.Device.LaunchMethod.unknown,zappar._deviceAppIdentifier="unknown",zappar._deviceHostAppData="",zappar._deviceQueryString="",zappar._package=function(e){zappar._base.call(this,e),0!=zappar.nextObject&&console.log("Error! Package should be first message receiver!"),this.refId=zappar.nextObject++,zappar.objectsByRef.push(this),this._usingContentStore=!1},zappar._package.prototype=Object.create(zappar._base.prototype),zappar._package.prototype.constructor=zappar._package,zappar._package.prototype._message=function(e){"dc"===e[1]?zappar._deviceCapabilities=e[2]:"lm"===e[1]?zappar._deviceLaunchMethod=e[2]:"ai"===e[1]?zappar._deviceAppIdentifier=e[2]:"ad"===e[1]?zappar._deviceHostAppData=e[2]:"cs"===e[1]?this._usingContentStore=e[2]:"qs"===e[1]?zappar._deviceQueryString=e[2]:console.log("Package message "+e)},zappar._package.prototype.usingContentStore=function(){return this._usingContentStore},zappar._package.prototype.loadingPercent=function(e){zappar.sendMessage([0,zappar._methods.METHOD_LOADINGPERCENT,e])},zappar._package.prototype.error=function(){zappar.sendMessage([0,zappar._methods.METHOD_ERROR,null])},zappar.Package=function(){return new zappar._package(this)},zappar.package=zappar.Package(),zappar.calendar.refId=zappar.nextObject++,zappar.objectsByRef.push(zappar.calendar),zappar.contacts.refId=zappar.nextObject++,zappar.objectsByRef.push(zappar.contacts),zappar.scene=zappar.Group(),zappar.sendMessage([0,zappar._methods.METHOD_SETSCENE,zappar.scene.refId]),zappar._layoutList=zappar.Group(),zappar.sendMessage([0,zappar._methods.METHOD_SETLAYOUTLIST,zappar._layoutList.refId]),zappar.screen=zappar.ScreenTransform().push([zappar.screenLeft=zappar.Group().position([-1,0,0]).depthRange([0,.3]),zappar.screenRight=zappar.Group().position([1,0,0]).depthRange([0,.3])]).depthRange([0,.3]),zappar.screen.on("resize",function(e,t){var a=e/t;zappar.screenLeft.position([-1*a,0,0]),zappar.screenRight.position([a,0,0])}),zappar._layoutList.push(zappar.screen),zappar.camera=zappar.CameraTransform().depthRange([.3,1]),zappar._layoutList.push(zappar.camera),zappar.device=new zappar._device(zappar),zappar.stats=new zappar._stats(zappar),zappar.tagManager=new zappar._tagManager(zappar),zappar.byTag=function(e){return zappar.tagManager.byTag(e)},zappar._hibernate=function(){zappar.sendMessage([0,zappar._methods.METHOD_HIBERNATE,null])},zappar._timeline=function(e,t){for(var a in zappar._base.call(this,t),this._spec=e,this._time=0,this._spec.overrides){var r=this._spec.overrides[a];for(var p in r)for(var i=r[p],s=0,o=i.length;s<o;s++)zappar._timeline.processBlock(i[s])}},zappar._timeline.prototype=Object.create(zappar._base.prototype),zappar._timeline.prototype.constructor=zappar._timeline,zappar._timeline.prototype.valueForParameterAtTime=function(e,t,a){var r=this._spec.overrides[e][t];if(0===r.length)return null;if(a<r[0].st)return r[0].sv;for(var p=0,i=r.length;p<i;p++){var s=r[p];if(a<r[p].st)return r[p-1].ev;if(a<s.et)return s._i(a-s.st,s.et-s.st,s.sv,s.ev,s._tf)}return r[r.length-1].ev},zappar._timeline.arrayNumberInterpolator=function(e,t,a,r,p){if(0===t)return r;for(var i=p(e/t),s=[],o=0,n=a.length;o<n;o++)s[o]=a[o]+(r[o]-a[o])*i;return s},zappar._timeline.numberInterpolator=function(e,t,a,r,p){return 0===t?r:a+(r-a)*p(e/t)},zappar._timeline.flipInterpolator=function(e,t,a,r,p){return 0===t||.5<=p(e/t)?r:a},zappar._timeline.interp={linear:function(e){return e},smooth:function(e){return-.5*Math.cos(3.1415926*e)+.5},accelerating:function(e){return e*e},decelerating:function(e){return 2*e-e*e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return-e*(e-2)},easeInOutQuad:function(e){return e<.5?2*e*e:-2*e*e+4*e-1},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){var t=e-1;return t*t*t+1},easeInOutCubic:function(e){if(e<.5)return 4*e*e*e;var t=2*e-2;return.5*t*t*t+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){var t=e-1;return 1-t*t*t*t},easeInOutQuart:function(e){if(e<.5)return 8*e*e*e*e;var t=e-1;return-8*t*t*t*t+1},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){var t=e-1;return t*t*t*t*t+1},easeInOutQuint:function(e){var t=2*e;return t<1?.5*t*t*t*t*t:.5*(t-=2)*t*t*t*t+1},easeInSine:function(e){return Math.sin(1.5707963*(e-1))+1},easeOutSine:function(e){return Math.sin(1.5707963*e)},easeInOutSine:function(e){return.5*(1-Math.cos(e*Math.PI))},easeInCirc:function(e){return 1-Math.sqrt(1-e*e)},easeOutCirc:function(e){return Math.sqrt((2-e)*e)},easeInOutCirc:function(e){return e<.5?.5*(1-Math.sqrt(1-e*e*4)):.5*(Math.sqrt(-(2*e-3)*(2*e-1))+1)},easeInExpo:function(e){return Math.pow(2,10*(e-1))},easeOutExpo:function(e){return 1-Math.pow(2,-10*e)},easeInOutExpo:function(e){return e<.5?.5*Math.pow(2,20*e-10):-.5*Math.pow(2,-20*e+10)+1},easeInElastic:function(e){return--e,-Math.pow(2,10*e)*Math.sin(1.5707963*(e-.075)/.075)},easeOutElastic:function(e){return Math.pow(2,-10*e)*Math.sin(1.5707963*(e-.075)/.075)+1},easeInOutElastic:function(e){var t=.3*1.5/4,a=2*e-1;return e<.5?-.5*Math.pow(2,10*a)*Math.sin(1.5707963*(a-t)/t):.5*Math.pow(2,-10*a)*Math.sin(1.5707963*(a-t)/t)+1},easeInBack:function(e){return e*e*(2.70158*e-1.70158)},easeOutBack:function(e){var t=1-e;return 1-t*t*(2.70158*t-1.70158)},easeInOutBack:function(e){var t=2*e,a=2.5949095;return t<1?t*t*((1+a)*t-a)*.5:1-(t=2-t)*t*((1+a)*t-a)*.5},easeOutBounce:function(e){return e<4/11?121*e*e/16:e<8/11?121*(e-=6/11)*e/16+1-.25:e<10/11?121*(e-=9/11)*e/16+1-.0625:121*(e-=10.5/11)*e/16+1-.015625},easeInBounce:function(e){return 1-zappar._timeline.interp.easeOutBounce(1-e)},easeInOutBounce:function(e){return e<.5?.5*zappar._timeline.interp.easeInBounce(2*e):.5*zappar._timeline.interp.easeOutBounce(2*e-1)+.5}},zappar._timeline.linearTime=function(e){return e},zappar._timeline.processBlock=function(e){if(e.i?e._tf=zappar._timeline.interp[e.i]:e._tf=zappar._timeline.interp.linear,void 0!==e.sv.length)return 0<e.sv.length&&"number"==typeof e.sv[0]?void(e._i=zappar._timeline.arrayNumberInterpolator):void(e._i=zappar._timeline.flipInterpolator);"number"!=typeof e.sv?e._i=zappar._timeline.flipInterpolator:e._i=zappar._timeline.numberInterpolator},zappar._timeline.prototype.performActionsBetween=function(e,t){if(e!==t){var a=e<t;for(var r in this._spec.actions)for(var p=this._spec.actions[r],i=0,s=p.length;i<s;i++){var o=p[i];if(a){if(o.t>t)break;if(o.t<e)continue;if(!o.f)continue}else{if(o.t<t)continue;if(o.t>e)break;if(!o.b)continue}var n=this._ctx.byId(r);n[o.a].call(n)}}},zappar._timeline.prototype.time=function(e){if(void 0===e)return this._time;for(;e<0;)e+=this._spec.length;for(;e>=this._spec.length;)e-=this._spec.length;for(var t in this._time=e,this._spec.overrides){var a=this._spec.overrides[t];for(var r in a){var p=this.valueForParameterAtTime(t,r,e);if(null!==p){var i=this._ctx.byId(t);i[r].call(i,p)}}}return this},zappar._timeline.prototype.play=function(t,a){void 0===t&&(t=1),zappar.off("frame",this._playCallback);var r,p,i=zappar._currentTime,s=this._time,o=this._spec.length,n=this;this._playCallback=function(e){for(r=e-i,i=e,p=s+r*t;o<=p;){if(!a){p=o-1,zappar.off("frame",n._playCallback),n.emit("complete");break}n.performActionsBetween(s,o-1),s=-1,p-=o}for(;p<0;){if(!a){p=0,zappar.off("frame",n._playCallback),n.emit("complete");break}n.performActionsBetween(s,0),p+=s=o}n.performActionsBetween(s,p),s=p,n.time(p)},zappar.on("frame",this._playCallback)},zappar._timeline.prototype.stop=function(){zappar.off("frame",this._playCallback)},zappar.Timeline=function(e){return new zappar._timeline(e,this)},zappar._baseMaterial=function(e,t){zappar._messageReceiver.call(this,e,t),this._color=[1,1,1,1],this._fillDepthBuffer=null,this._depthTest=null,this._blend=zappar.Blend.inherit,this._cullFaces=zappar.CullFaces.inherit},zappar._baseMaterial.methods={METHOD_COLOR:50,METHOD_FILLDEPTHBUFFER:51,METHOD_DEPTHTEST:52,METHOD_BLEND:53,METHOD_CULLFACES:54,METHOD_BAKE_LIGHT_MAP:55},zappar._baseMaterial.prototype=Object.create(zappar._messageReceiver.prototype),zappar._baseMaterial.prototype.constructor=zappar._baseMaterial,zappar._baseMaterial.prototype._color_id=zappar._baseMaterial.methods.METHOD_COLOR,zappar._baseMaterial.prototype.color=function(e){return e?(this._color=e.slice(),zappar.sendMessage([this.refId,zappar._baseMaterial.methods.METHOD_COLOR,this._color]),this):this._color.slice()},zappar._baseMaterial.prototype.blend_valuify_=zappar._valuify.enum(zappar.Blend),zappar._baseMaterial.prototype.blend=function(e){return void 0!==e?(this._blend=this.blend_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._baseMaterial.methods.METHOD_BLEND,this._blend]),this):this._blend},zappar._baseMaterial.prototype.cullFaces_valuify_=zappar._valuify.enum(zappar.CullFaces),zappar._baseMaterial.prototype.cullFaces=function(e){return void 0!==e?(this._cullFaces=this.cullFaces_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._baseMaterial.methods.METHOD_CULLFACES,this._cullFaces]),this):this._cullFaces},zappar._baseMaterial.prototype.bakeLightMap=function(e){!0===e&&zappar.sendMessage([this.refId,zappar._baseMaterial.methods.METHOD_BAKE_LIGHT_MAP,null])},zappar._material=function(e){zappar._baseMaterial.call(this,zappar._types.MATERIAL,e),this._skin=null,this._mask=null,this._maskAlphaChannel=zappar.Texture.Channel.a,this._alphaCutoutThreshold=-1},zappar._material.methods={METHOD_SKIN:100,METHOD_MASK:101,METHOD_MASKALPHACHANNEL:102,METHOD_ALPHACUTOUTTHRESHOLD:103},zappar._material.prototype=Object.create(zappar._baseMaterial.prototype),zappar._material.prototype.constructor=zappar._material,zappar._material.prototype.skin_valuify_=zappar._valuify.imageTexture,zappar._material.prototype._skin_id=zappar._material.methods.METHOD_SKIN,zappar._material.prototype.skin=function(e){if(void 0===e)return this._skin;var t=this.skin_valuify_(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._material.methods.METHOD_SKIN,t.refId]):zappar.sendMessage([this.refId,zappar._material.methods.METHOD_SKIN,null]),this._skin&&this._skin.removeDependent(this),this._skin=t,this},zappar._material.prototype.dispose=function(e){e&&(this._skin&&this._skin.dispose&&this._skin.dispose(!0),this._mask&&this._mask.dispose&&this._mask.dispose(!0))},zappar._material.prototype.mask_valuify_=zappar._valuify.imageTexture,zappar._material.prototype._mask_id=zappar._material.methods.METHOD_MASK,zappar._material.prototype.mask=function(e){if(void 0===e)return this._mask;var t=this.mask_valuify_(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._material.methods.METHOD_MASK,t.refId]):zappar.sendMessage([this.refId,zappar._material.methods.METHOD_MASK,null]),this._mask&&this._mask.removeDependent(this),this._mask=t,this},zappar._material.prototype.maskAlphaChannel_valuify_=zappar._valuify.enum(zappar.Texture.Channel),zappar._material.prototype.maskAlphaChannel=function(e){return void 0!==e?(this._maskAlphaChannel=this.maskAlphaChannel_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._material.methods.METHOD_MASKALPHACHANNEL,this._maskAlphaChannel]),this):this._maskAlphaChannel},zappar._material.prototype.alphaCutoutThreshold=function(e){return void 0!==e?(this._alphaCutoutThreshold=e,zappar.sendMessage([this.refId,zappar._material.methods.METHOD_ALPHACUTOUTTHRESHOLD,this._alphaCutoutThreshold]),this):this._alphaCutoutThreshold},zappar.Material=function(){return new zappar._material(this)},zappar._standardLigthingMaterial=function(e){zappar._baseMaterial.call(this,zappar._types.STANDARDLIGHTINGMATERIAL,e),this._ambientColor=[.4,.4,.4,1],this._diffuseColor=[.7,.7,.7,1],this._specularColor=[.9,.9,.9,1],this._rimLightColor=[0,0,0,1],this._rimLightCutoff=.6,this._diffuseMap=null,this._normalMap=null,this._specularMap=null,this._ambientMap=null,this._emissiveMap=null,this._glossinessMap=null,this._opacityMap=null,this._shininess=64,this._opacity=1,this._reflectance=0,this._refraction=0,this._numPixelLights=1,this._numVertexLights=4,this._useGammaCorrection=!1,this._gamma=2.2,this._useRimlight=!1,this._flipY=!1},zappar._standardLigthingMaterial.methods={METHOD_AMBIENT_COLOR:200,METHOD_DIFFUSE_COLOR:201,METHOD_SPECULAR_COLOR:202,METHOD_DIFFUSE_MAP:203,METHOD_NORMAL_MAP:204,METHOD_SPECULAR_MAP:205,METHOD_AMBIENT_MAP:206,METHOD_EMISSIVE_MAP:207,METHOD_GLOSSINESS_MAP:208,METHOD_OPACITY_MAP:209,METHOD_SHININESS:210,METHOD_OPACITY:211,METHOD_NUM_PIXEL_LIGHTS:212,METHOD_NUM_VERTEX_LIGHTS:213,PARAM_USE_GAMMA_CORRECTION:214,PARAM_GAMMA:215,PARAM_USE_RIMLIGHT:216,PARAM_RIMLIGHT_COLOR:217,PARAM_RIMLIGHT_CUTOFF:218,PARAM_REFLECTANCE:219,PARAM_REFRACTION:220,PARAM_FLIP_Y_NORMALMAP:221},zappar._standardLigthingMaterial.prototype=Object.create(zappar._baseMaterial.prototype),zappar._standardLigthingMaterial.prototype.constructor=zappar._standardLigthingMaterial,zappar._standardLigthingMaterial.prototype.dispose=function(e){e&&(this._diffuseMap&&this._diffuseMap.dispose&&this._diffuseMap.dispose(!0),this._normalMap&&this._normalMap.dispose&&this._normalMap.dispose(!0),this._specularMap&&this._specularMap.dispose&&this._specularMap.dispose(!0),this._ambientMap&&this._ambientMap.dispose&&this._ambientMap.dispose(!0),this._emissiveMap&&this._emissiveMap.dispose&&this._emissiveMap.dispose(!0),this._glossinessMap&&this._glossinessMap.dispose&&this._glossinessMap.dispose(!0),this._opacityMap&&this._opacityMap.dispose&&this._opacityMap.dispose(!0))},zappar._standardLigthingMaterial.prototype._ambientColor_id=zappar._standardLigthingMaterial.methods.METHOD_AMBIENT_COLOR,zappar._standardLigthingMaterial.prototype.ambientColor=function(e){return e?(this._ambientColor=e.slice(),zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_AMBIENT_COLOR,this._ambientColor]),this):this._ambientColor.slice()},zappar._standardLigthingMaterial.prototype._diffuseColor_id=zappar._standardLigthingMaterial.methods.METHOD_DIFFUSE_COLOR,zappar._standardLigthingMaterial.prototype.diffuseColor=function(e){return e?(this._diffuseColor=e.slice(),zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_DIFFUSE_COLOR,this._diffuseColor]),this):this._diffuseColor.slice()},zappar._standardLigthingMaterial.prototype._specularColor_id=zappar._standardLigthingMaterial.methods.METHOD_SPECULAR_COLOR,zappar._standardLigthingMaterial.prototype.specularColor=function(e){return e?(this._specularColor=e.slice(),zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_SPECULAR_COLOR,this._specularColor]),this):this._specularColor.slice()},zappar._standardLigthingMaterial.prototype._rimLightColor_id=zappar._standardLigthingMaterial.methods.PARAM_RIMLIGHT_COLOR,zappar._standardLigthingMaterial.prototype.rimLightColor=function(e){return e?(this._rimLightColor=e.slice(),zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.PARAM_RIMLIGHT_COLOR,this._rimLightColor]),this):this._rimLightColor.slice()},zappar._standardLigthingMaterial.prototype._rimLightCutoff_id=zappar._standardLigthingMaterial.methods.PARAM_RIMLIGHT_CUTOFF,zappar._standardLigthingMaterial.prototype.rimLightCutoff=function(e){return void 0!==e?(e!==this._rimLightCutoff&&(this._rimLightCutoff=e,zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.PARAM_RIMLIGHT_CUTOFF,this._rimLightCutoff])),this):this._rimLightCutoff},zappar._standardLigthingMaterial.prototype.diffuseMap_valuify_=zappar._valuify.imageTexture,zappar._standardLigthingMaterial.prototype._diffuseMap_id=zappar._standardLigthingMaterial.methods.METHOD_DIFFUSE_MAP,zappar._standardLigthingMaterial.prototype.diffuseMap=function(e){if(void 0===e)return this._diffuseMap;var t=this.diffuseMap_valuify_(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_DIFFUSE_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_DIFFUSE_MAP,null]),this._diffuseMap&&this._diffuseMap.removeDependent(this),this._diffuseMap=t,this},zappar._standardLigthingMaterial.prototype.normalMap_valuify_=zappar._valuify.imageTexture,zappar._standardLigthingMaterial.prototype._normalMap_id=zappar._standardLigthingMaterial.methods.METHOD_NORMAL_MAP,zappar._standardLigthingMaterial.prototype.normalMap=function(e){if(void 0===e)return this._normalMap;var t=this.normalMap_valuify_(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_NORMAL_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_NORMAL_MAP,null]),this._normalMap&&this._normalMap.removeDependent(this),this._normalMap=t,this},zappar._standardLigthingMaterial.prototype.specularMap_valuify_=zappar._valuify.imageTexture,zappar._standardLigthingMaterial.prototype._specularMap_id=zappar._standardLigthingMaterial.methods.METHOD_SPECULAR_MAP,zappar._standardLigthingMaterial.prototype.specularMap=function(e){if(void 0===e)return this._specularMap;var t=this.specularMap_valuify_(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_SPECULAR_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_SPECULAR_MAP,null]),this._specularMap&&this._specularMap.removeDependent(this),this._specularMap=t,this},zappar._standardLigthingMaterial.prototype.ambientMap_valuify_=zappar._valuify.imageTexture,zappar._standardLigthingMaterial.prototype._ambientMap_id=zappar._standardLigthingMaterial.methods.METHOD_AMBIENT_MAP,zappar._standardLigthingMaterial.prototype.ambientMap=function(e){if(void 0===e)return this._ambientMap;var t=this.ambientMap_valuify_(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_AMBIENT_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_AMBIENT_MAP,null]),this._ambientMap&&this._ambientMap.removeDependent(this),this._ambientMap=t,this},zappar._standardLigthingMaterial.prototype.emissiveMap_valuify_=zappar._valuify.imageTexture,zappar._standardLigthingMaterial.prototype._emissiveMap_id=zappar._standardLigthingMaterial.methods.METHOD_EMISSIVE_MAP,zappar._standardLigthingMaterial.prototype.emissiveMap=function(e){if(void 0===e)return this._emissiveMap;var t=this.emissiveMap_valuify_(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_EMISSIVE_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_EMISSIVE_MAP,null]),this._emissiveMap&&this._emissiveMap.removeDependent(this),this._emissiveMap=t,this},zappar._standardLigthingMaterial.prototype.glossinessMap_valuify_=zappar._valuify.imageTexture,zappar._standardLigthingMaterial.prototype._glossinessMap_id=zappar._standardLigthingMaterial.methods.METHOD_GLOSSINESS_MAP,zappar._standardLigthingMaterial.prototype.glossinessMap=function(e){if(void 0===e)return this._glossinessMap;var t=this.glossinessMap_valuify_(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_GLOSSINESS_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_GLOSSINESS_MAP,null]),this._glossinessMap&&this._glossinessMap.removeDependent(this),this._glossinessMap=t,this},zappar._standardLigthingMaterial.prototype.opacityMap_valuify_=zappar._valuify.imageTexture,zappar._standardLigthingMaterial.prototype._opacityMap_id=zappar._standardLigthingMaterial.methods.METHOD_OPACITY_MAP,zappar._standardLigthingMaterial.prototype.opacityMap=function(e){if(void 0===e)return this._opacityMap;var t=this.opacityMap_valuify_(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_OPACITY_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_OPACITY_MAP,null]),this._opacityMap&&this._opacityMap.removeDependent(this),this._opacityMap=t,this},zappar._standardLigthingMaterial.prototype._shininess_id=zappar._standardLigthingMaterial.methods.METHOD_SHININESS,zappar._standardLigthingMaterial.prototype.shininess=function(e){return void 0!==e?(e!=this._shininess&&(this._shininess=e,zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_SHININESS,this._shininess])),this):this._shininess},zappar._standardLigthingMaterial.prototype._opacity_id=zappar._standardLigthingMaterial.methods.METHOD_OPACITY,zappar._standardLigthingMaterial.prototype.opacity=function(e){return void 0!==e?(e!=this._opacity&&(this._opacity=e,zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_OPACITY,this._opacity])),this):this._opacity},zappar._standardLigthingMaterial.prototype._reflection_id=zappar._standardLigthingMaterial.methods.PARAM_REFLECTANCE,zappar._standardLigthingMaterial.prototype.reflection=function(e){return void 0!==e?(e!=this._reflectance&&(this._reflectance=e,zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.PARAM_REFLECTANCE,this._reflectance])),this):this._reflectance},zappar._standardLigthingMaterial.prototype._refraction_id=zappar._standardLigthingMaterial.methods.PARAM_REFRACTION,zappar._standardLigthingMaterial.prototype.refraction=function(e){return void 0!==e?(e!=this._refraction&&(this._refraction=e,zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.PARAM_REFRACTION,this._refraction])),this):this._refraction},zappar._standardLigthingMaterial.prototype._numPixelLights_id=zappar._standardLigthingMaterial.methods.METHOD_NUM_PIXEL_LIGHTS,zappar._standardLigthingMaterial.prototype.numPixelLights=function(e){return void 0!==e?(e!=this._numPixelLights&&(this._numPixelLights=e,zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_NUM_PIXEL_LIGHTS,this._numPixelLights])),this):this._numPixelLights},zappar._standardLigthingMaterial.prototype._numVertexLights_id=zappar._standardLigthingMaterial.methods.METHOD_NUM_VERTEX_LIGHTS,zappar._standardLigthingMaterial.prototype.numVertexLights=function(e){return void 0!==e?(e!=this._numVertexLights&&(this._numVertexLights=e,zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.METHOD_NUM_VERTEX_LIGHTS,this._numVertexLights])),this):this._numVertexLights},zappar._standardLigthingMaterial.prototype.gammaCorrection=function(e){return void 0!==e?(this._useGammaCorrection=e,zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.PARAM_USE_GAMMA_CORRECTION,this._useGammaCorrection]),this):this._useGammaCorrection},zappar._standardLigthingMaterial.prototype._gamma_id=zappar._standardLigthingMaterial.methods.PARAM_GAMMA,zappar._standardLigthingMaterial.prototype.gamma=function(e){return void 0!==e?(e!=this._gamma&&(this._gamma=e,zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.PARAM_GAMMA,this._gamma])),this):this._gamma},zappar._standardLigthingMaterial.prototype.useRimLight=function(e){return void 0!==e?(this._useRimlight=e,zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.PARAM_USE_RIMLIGHT,this._useRimlight]),this):this._useRimlight},zappar._standardLigthingMaterial.prototype.normalFlipY=function(e){return void 0!==e?(this._flipY=e,zappar.sendMessage([this.refId,zappar._standardLigthingMaterial.methods.PARAM_FLIP_Y_NORMALMAP,this._flipY]),this):this._flipY},zappar.StandardLightingMaterial=function(){return new zappar._standardLigthingMaterial(this)},zappar._toonMaterial=function(e){zappar._baseMaterial.call(this,zappar._types.TOONMATERIAL,e),this._ambientColor=[.4,.4,.4,1],this._diffuseColor=[.7,.7,.7,1],this._specularColor=[.9,.9,.9,1],this._rimLightColor=[0,0,0,1],this._rimLightCutoff=.6,this._diffuseMap=null,this._specularMap=null,this._ambientMap=null,this._emissiveMap=null,this._glossinessMap=null,this._opacityMap=null,this._shininess=64,this._opacity=1,this._numPixelLights=1,this._numVertexLights=4,this._rampMap=null,this._numShades=4,this._drawOutline=!0,this._outlineWidth=.65,this._outlineColor=[0,0,0,1],this._useGammaCorrection=!1,this._gamma=2.2,this._useRimlight=!1},zappar._toonMaterial.methods={PARAM_AMBIENT_COLOR:300,PARAM_DIFFUSE_COLOR:301,PARAM_SPECULAR_COLOR:302,PARAM_OUTLINE_COLOR:303,PARAM_DIFFUSE_MAP:304,PARAM_SPECULAR_MAP:305,PARAM_AMBIENT_MAP:306,PARAM_EMISSIVE_MAP:307,PARAM_GLOSSINESS_MAP:308,PARAM_RAMP_MAP:309,PARAM_OPACITY_MAP:310,PARAM_NUM_SHADES:311,PARAM_SHININESS:312,PARAM_OPACITY:313,PARAM_NUM_PIXEL_LIGHTS:314,PARAM_NUM_VERTEX_LIGHTS:315,PARAM_DRAW_OUTLINE:316,PARAM_OUTLINE_WIDTH:317,PARAM_USE_GAMMA_CORRECTION:318,PARAM_GAMMA:319,PARAM_USE_RIMLIGHT:320,PARAM_RIMLIGHT_COLOR:321,PARAM_RIMLIGHT_CUTOFF:322},zappar._toonMaterial.prototype=Object.create(zappar._baseMaterial.prototype),zappar._toonMaterial.prototype.constructor=zappar._toonMaterial,zappar._toonMaterial.prototype.dispose=function(e){e&&(this._diffuseMap&&this._diffuseMap.dispose&&this._diffuseMap.dispose(!0),this._specularMap&&this._specularMap.dispose&&this._specularMap.dispose(!0),this._ambientMap&&this._ambientMap.dispose&&this._ambientMap.dispose(!0),this._emissiveMap&&this._emissiveMap.dispose&&this._emissiveMap.dispose(!0),this._glossinessMap&&this._glossinessMap.dispose&&this._glossinessMap.dispose(!0),this._opacityMap&&this._opacityMap.dispose&&this._opacityMap.dispose(!0),this._rampMap&&this._rampMap.dispose&&this._rampMap.dispose(!0))},zappar._toonMaterial.prototype._ambientColor_id=zappar._toonMaterial.methods.PARAM_AMBIENT_COLOR,zappar._toonMaterial.prototype.ambientColor=function(e){return e?(this._ambientColor=e.slice(),zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_AMBIENT_COLOR,this._ambientColor]),this):this._ambientColor.slice()},zappar._toonMaterial.prototype._diffuseColor_id=zappar._toonMaterial.methods.PARAM_DIFFUSE_COLOR,zappar._toonMaterial.prototype.diffuseColor=function(e){return e?(this._diffuseColor=e.slice(),zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_DIFFUSE_COLOR,this._diffuseColor]),this):this._diffuseColor.slice()},zappar._toonMaterial.prototype._specularColor_id=zappar._toonMaterial.methods.PARAM_SPECULAR_COLOR,zappar._toonMaterial.prototype.specularColor=function(e){return e?(this._specularColor=e.slice(),zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_SPECULAR_COLOR,this._specularColor]),this):this._specularColor.slice()},zappar._toonMaterial.prototype._rimLightColor_id=zappar._toonMaterial.methods.PARAM_RIMLIGHT_COLOR,zappar._toonMaterial.prototype.rimLightColor=function(e){return e?(this._rimLightColor=e.slice(),zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_RIMLIGHT_COLOR,this._rimLightColor]),this):this._rimLightColor.slice()},zappar._toonMaterial.prototype._rimLightCutoff_id=zappar._toonMaterial.methods.PARAM_RIMLIGHT_CUTOFF,zappar._toonMaterial.prototype.rimLightCutoff=function(e){return void 0!==e?(e!==this._rimLightCutoff&&(this._rimLightCutoff=e,zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_RIMLIGHT_CUTOFF,this._rimLightCutoff])),this):this._rimLightCutoff},zappar._toonMaterial.prototype._outlineColor_id=zappar._toonMaterial.methods.PARAM_OUTLINE_COLOR,zappar._toonMaterial.prototype.outlineColor=function(e){return e?(this._outlineColor=e.slice(),zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_OUTLINE_COLOR,this._outlineColor]),this):this._outlineColor.slice()},zappar._toonMaterial.prototype._diffuseMap_id=zappar._toonMaterial.methods.PARAM_DIFFUSE_MAP,zappar._toonMaterial.prototype.diffuseMap=function(e){if(void 0===e)return this._diffuseMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_DIFFUSE_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_DIFFUSE_MAP,null]),this._diffuseMap&&this._diffuseMap.removeDependent(this),this._diffuseMap=t,this},zappar._toonMaterial.prototype._specularMap_id=zappar._toonMaterial.methods.PARAM_SPECULAR_MAP,zappar._toonMaterial.prototype.specularMap=function(e){if(void 0===e)return this._specularMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_SPECULAR_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_SPECULAR_MAP,null]),this._specularMap&&this._specularMap.removeDependent(this),this._specularMap=t,this},zappar._toonMaterial.prototype._ambientMap_id=zappar._toonMaterial.methods.PARAM_AMBIENT_MAP,zappar._toonMaterial.prototype.ambientMap=function(e){if(void 0===e)return this._ambientMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_AMBIENT_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_AMBIENT_MAP,null]),this._ambientMap&&this._ambientMap.removeDependent(this),this._ambientMap=t,this},zappar._toonMaterial.prototype._emissiveMap_id=zappar._toonMaterial.methods.PARAM_EMISSIVE_MAP,zappar._toonMaterial.prototype.emissiveMap=function(e){if(void 0===e)return this._emissiveMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_EMISSIVE_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_EMISSIVE_MAP,null]),this._emissiveMap&&this._emissiveMap.removeDependent(this),this._emissiveMap=t,this},zappar._toonMaterial.prototype._glossinessMap_id=zappar._toonMaterial.methods.PARAM_GLOSSINESS_MAP,zappar._toonMaterial.prototype.glossinessMap=function(e){if(void 0===e)return this._glossinessMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_GLOSSINESS_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_GLOSSINESS_MAP,null]),this._glossinessMap&&this._glossinessMap.removeDependent(this),this._glossinessMap=t,this},zappar._toonMaterial.prototype._opacityMap_id=zappar._toonMaterial.methods.PARAM_OPACITY_MAP,zappar._toonMaterial.prototype.opacityMap=function(e){if(void 0===e)return this._opacityMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_OPACITY_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_OPACITY_MAP,null]),this._opacityMap&&this._opacityMap.removeDependent(this),this._opacityMap=t,this},zappar._toonMaterial.prototype._rampMap_id=zappar._toonMaterial.methods.PARAM_RAMP_MAP,zappar._toonMaterial.prototype.rampMap=function(e){if(void 0===e)return this._rampMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_RAMP_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_RAMP_MAP,null]),this._rampMap&&this._rampMap.removeDependent(this),this._rampMap=t,this},zappar._toonMaterial.prototype._numShades_id=zappar._toonMaterial.methods.PARAM_NUM_SHADES,zappar._toonMaterial.prototype.numShades=function(e){return void 0!==e?(e!=this._numShades&&(this._numShades=e,zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_NUM_SHADES,this._numShades])),this):this._numShades},zappar._toonMaterial.prototype._shininess_id=zappar._toonMaterial.methods.PARAM_SHININESS,zappar._toonMaterial.prototype.shininess=function(e){return void 0!==e?(e!=this._shininess&&(this._shininess=e,zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_SHININESS,this._shininess])),this):this._shininess},zappar._toonMaterial.prototype._opacity_id=zappar._toonMaterial.methods.PARAM_OPACITY,zappar._toonMaterial.prototype.opacity=function(e){return void 0!==e?(e!=this._opacity&&(this._opacity=e,zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_OPACITY,this._opacity])),this):this._opacity},zappar._toonMaterial.prototype._numPixelLights_id=zappar._toonMaterial.methods.PARAM_NUM_PIXEL_LIGHTS,zappar._toonMaterial.prototype.numPixelLights=function(e){return void 0!==e?(e!=this._numPixelLights&&(this._numPixelLights=e,zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_NUM_PIXEL_LIGHTS,this._numPixelLights])),this):this._numPixelLights},zappar._toonMaterial.prototype._numVertexLights_id=zappar._toonMaterial.methods.PARAM_NUM_VERTEX_LIGHTS,zappar._toonMaterial.prototype.numVertexLights=function(e){return void 0!==e?(e!=this._numVertexLights&&(this._numVertexLights=e,zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_NUM_VERTEX_LIGHTS,this._numVertexLights])),this):this._numVertexLights},zappar._toonMaterial.prototype._outline_id=zappar._toonMaterial.methods.PARAM_DRAW_OUTLINE,zappar._toonMaterial.prototype.outiline=function(e){return void 0===e?this._drawOutline:(this._drawOutline=e,zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_DRAW_OUTLINE,e]),this)},zappar._toonMaterial.prototype._outlineWidth_id=zappar._toonMaterial.methods.PARAM_OUTLINE_WIDTH,zappar._toonMaterial.prototype.outlineWidth=function(e){return void 0!==e?(e!=this._outlineWidth&&(this._outlineWidth=e,zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_OUTLINE_WIDTH,this._outlineWidth])),this):this._outlineWidth},zappar._toonMaterial.prototype.gammaCorrection=function(e){return void 0!==e?(this._useGammaCorrection=e,zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_USE_GAMMA_CORRECTION,this._useGammaCorrection]),this):this._useGammaCorrection},zappar._toonMaterial.prototype.useRimLight=function(e){return void 0!==e?(this._useRimlight=e,zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_USE_RIMLIGHT,this._useRimlight]),this):this._useRimlight},zappar._toonMaterial.prototype._gamma_id=zappar._toonMaterial.methods.PARAM_GAMMA,zappar._toonMaterial.prototype.gamma=function(e){return void 0!==e?(e!=this._gamma&&(this._gamma=e,zappar.sendMessage([this.refId,zappar._toonMaterial.methods.PARAM_GAMMA,this._gamma])),this):this._gamma},zappar.ToonMaterial=function(){return new zappar._toonMaterial(this)},zappar._pbrMaterial=function(e){zappar._baseMaterial.call(this,zappar._types.PBRMATERIAL,e),this._color=[.7,.7,.7,1],this._metalness=.1,this._roughness=.05,this._albedoMap=null,this._normalMap=null,this._specularMap=null,this._ambientMap=null,this._emissiveMap=null,this._smoothnessMap=null,this._roughnessMap=null,this._metalnessMap=null,this._metallicRoughnessMap=null,this._opacityMap=null,this._opacity=1,this._numPixelLights=1,this._useGammaCorrection=!0,this._gamma=2.2,this._flipY=!1},zappar._pbrMaterial.methods={PARAM_COLOR:400,PARAM_METALNESS:401,PARAM_ROUGHNESS:402,PARAM_ALBEDO_MAP:403,PARAM_NORMAL_MAP:404,PARAM_SPECULAR_MAP:405,PARAM_AMBIENT_MAP:406,PARAM_EMISSIVE_MAP:407,PARAM_SMOOTHNESS_MAP:408,PARAM_ROUGHNESS_MAP:409,PARAM_METALNESS_MAP:410,PARAM_OPACITY_MAP:411,PARAM_METALLICROUGHNESS_MAP:412,PARAM_NUM_PIXEL_LIGHTS:423,PARAM_USE_GAMMA_CORRECTION:425,PARAM_GAMMA:426,PARAM_FLIP_Y_NORMALMAP:427,PARAM_OPACITY:428},zappar._pbrMaterial.prototype=Object.create(zappar._baseMaterial.prototype),zappar._pbrMaterial.prototype.constructor=zappar._pbrMaterial,zappar._pbrMaterial.prototype.dispose=function(e){e&&(this._albedoMap&&this._albedoMap.dispose&&this._albedoMap.dispose(!0),this._normalMap&&this._normalMap.dispose&&this._normalMap.dispose(!0),this._specularMap&&this._specularMap.dispose&&this._specularMap.dispose(!0),this._ambientMap&&this._ambientMap.dispose&&this._ambientMap.dispose(!0),this._emissiveMap&&this._emissiveMap.dispose&&this._emissiveMap.dispose(!0),this._smoothnessMap&&this._smoothnessMap.dispose&&this._smoothnessMap.dispose(!0),this._roughnessMap&&this._roughnessMap.dispose&&this._roughnessMap.dispose(!0),this._metalnessMap&&this._metalnessMap.dispose&&this._metalnessMap.dispose(!0),this._metallicRoughnessMap&&this._metallicRoughnessMap.dispose&&this._metallicRoughnessMap.dispose(!0),this._opacityMap&&this._opacityMap.dispose&&this._opacityMap.dispose(!0))},zappar._pbrMaterial.prototype._color_id=zappar._pbrMaterial.methods.PARAM_COLOR,zappar._pbrMaterial.prototype.color=function(e){return e?(this._color=e.slice(),zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_COLOR,this._color]),this):this._color.slice()},zappar._pbrMaterial.prototype._metalness_id=zappar._pbrMaterial.methods.PARAM_METALNESS,zappar._pbrMaterial.prototype.metalness=function(e){return void 0!==e?(e!=this._metalness&&(this._metalness=e,zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_METALNESS,this._metalness])),this):this._metalness},zappar._pbrMaterial.prototype._roughness_id=zappar._pbrMaterial.methods.PARAM_ROUGHNESS,zappar._pbrMaterial.prototype.roughness=function(e){return void 0!==e?(e!=this._roughness&&(this._roughness=e,zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_ROUGHNESS,this._roughness])),this):this._roughness},zappar._pbrMaterial.prototype._albedoMap_id=zappar._pbrMaterial.methods.PARAM_ALBEDO_MAP,zappar._pbrMaterial.prototype.albedoMap=function(e){if(void 0===e)return this._albedoMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_ALBEDO_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_ALBEDO_MAP,null]),this._albedoMap&&this._albedoMap.removeDependent(this),this._albedoMap=t,this},zappar._pbrMaterial.prototype._normalMap_id=zappar._pbrMaterial.methods.PARAM_NORMAL_MAP,zappar._pbrMaterial.prototype.normalMap=function(e){if(void 0===e)return this._normalMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_NORMAL_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_NORMAL_MAP,null]),this._normalMap&&this._normalMap.removeDependent(this),this._normalMap=t,this},zappar._pbrMaterial.prototype._specularMap_id=zappar._pbrMaterial.methods.PARAM_SPECULAR_MAP,zappar._pbrMaterial.prototype.specularMap=function(e){if(void 0===e)return this._specularMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_SPECULAR_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_SPECULAR_MAP,null]),this._specularMap&&this._specularMap.removeDependent(this),this._specularMap=t,this},zappar._pbrMaterial.prototype._ambientMap_id=zappar._pbrMaterial.methods.PARAM_AMBIENT_MAP,zappar._pbrMaterial.prototype.ambientMap=function(e){if(void 0===e)return this._ambientMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_AMBIENT_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_AMBIENT_MAP,null]),this._ambientMap&&this._ambientMap.removeDependent(this),this._ambientMap=t,this},zappar._pbrMaterial.prototype._emissiveMap_id=zappar._pbrMaterial.methods.PARAM_EMISSIVE_MAP,zappar._pbrMaterial.prototype.emissiveMap=function(e){if(void 0===e)return this._emissiveMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_EMISSIVE_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_EMISSIVE_MAP,null]),this._emissiveMap&&this._emissiveMap.removeDependent(this),this._emissiveMap=t,this},zappar._pbrMaterial.prototype._smoothnessMap_id=zappar._pbrMaterial.methods.PARAM_SMOOTHNESS_MAP,zappar._pbrMaterial.prototype.smoothnessMap=function(e){if(void 0===e)return this._smoothnessMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_SMOOTHNESS_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_SMOOTHNESS_MAP,null]),this._smoothnessMap&&this._smoothnessMap.removeDependent(this),this._smoothnessMap=t,this},zappar._pbrMaterial.prototype._roughnessMap_id=zappar._pbrMaterial.methods.PARAM_ROUGHNESS_MAP,zappar._pbrMaterial.prototype.roughnessMap=function(e){if(void 0===e)return this._roughnessMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_ROUGHNESS_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_ROUGHNESS_MAP,null]),this._roughnessMap&&this._roughnessMap.removeDependent(this),this._roughnessMap=t,this},zappar._pbrMaterial.prototype._metalnessMap_id=zappar._pbrMaterial.methods.PARAM_METALNESS_MAP,zappar._pbrMaterial.prototype.metalnessMap=function(e){if(void 0===e)return this._metalnessMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_METALNESS_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_METALNESS_MAP,null]),this._metalnessMap&&this._metalnessMap.removeDependent(this),this._metalnessMap=t,this},zappar._pbrMaterial.prototype._metallicRoughnessMap_id=zappar._pbrMaterial.methods.PARAM_METALLICROUGHNESS_MAP,zappar._pbrMaterial.prototype.metallicRoughnessMap=function(e){if(void 0===e)return this._metallicRoughnessMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_METALLICROUGHNESS_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_METALLICROUGHNESS_MAP,null]),this._metallicRoughnessMap&&this._metallicRoughnessMap.removeDependent(this),this._metallicRoughnessMap=t,this},zappar._pbrMaterial.prototype._numPixelLights_id=zappar._pbrMaterial.methods.PARAM_NUM_PIXEL_LIGHTS,zappar._pbrMaterial.prototype.numPixelLights=function(e){return void 0!==e?(e!=this._numPixelLights&&(this._numPixelLights=e,zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_NUM_PIXEL_LIGHTS,this._numPixelLights])),this):this._numPixelLights},zappar._pbrMaterial.prototype.gammaCorrection=function(e){return void 0!==e?(this._useGammaCorrection=e,zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_USE_GAMMA_CORRECTION,this._useGammaCorrection]),this):this._useGammaCorrection},zappar._pbrMaterial.prototype._gamma_id=zappar._pbrMaterial.methods.PARAM_GAMMA,zappar._pbrMaterial.prototype.gamma=function(e){return void 0!==e?(e!=this._gamma&&(this._gamma=e,zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_GAMMA,this._gamma])),this):this._gamma},zappar._pbrMaterial.prototype.normalFlipY=function(e){return void 0!==e?(this._flipY=e,zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_FLIP_Y_NORMALMAP,this._flipY]),this):this._flipY},zappar._pbrMaterial.prototype._opacity_id=zappar._pbrMaterial.methods.PARAM_OPACITY,zappar._pbrMaterial.prototype.opacity=function(e){return void 0!==e?(e!=this._opacity&&(this._opacity=e,zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_OPACITY,this._opacity])),this):this._opacity},zappar._pbrMaterial.prototype._opacityMap_id=zappar._pbrMaterial.methods.PARAM_OPACITY_MAP,zappar._pbrMaterial.prototype.opacityMap=function(e){if(void 0===e)return this._opacityMap;var t=zappar._valuify.imageTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_OPACITY_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._pbrMaterial.methods.PARAM_OPACITY_MAP,null]),this._opacityMap&&this._opacityMap.removeDependent(this),this._opacityMap=t,this},zappar.PBRMaterial=function(){return new zappar._pbrMaterial(this)},zappar._light=function(e,t){zappar._node.call(this,e,t),this._lightColor=[1,1,1,1],this._intensity=.8,this._priority=0},zappar._light.methods={METHOD_LIGHT_COLOR:100,METHOD_LIGHT_INTENSITY:101,METHOD_LIGHT_PRIORITY:102,METHOD_DRAW_GIZMO:103},zappar._light.prototype=Object.create(zappar._node.prototype),zappar._light.prototype.constructor=zappar._light,zappar.Light=function(){return new zappar._light(this)},zappar.Light.Priority={auto:0,important:1,unimportant:2},zappar._light.prototype._lightColor_id=zappar._light.methods.METHOD_LIGHT_COLOR,zappar._light.prototype.lightColor=function(e){return e?(this._lightColor=e.slice(),zappar.sendMessage([this.refId,zappar._light.methods.METHOD_LIGHT_COLOR,this._lightColor]),this):this._lightColor.slice()},zappar._light.prototype._intensity_id=zappar._light.methods.METHOD_LIGHT_INTENSITY,zappar._light.prototype.intensity=function(e){return void 0!==e?(e!=this._intensity&&(this._intensity=e,zappar.sendMessage([this.refId,zappar._light.methods.METHOD_LIGHT_INTENSITY,this._intensity])),this):this._intensity},zappar._light.prototype.priority_valuify_=zappar._valuify.enum(zappar.Light.Priority),zappar._light.prototype.priority=function(e){return void 0!==e?(this._priority=this.priority_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._light.methods.METHOD_LIGHT_PRIORITY,this._priority]),this):this._priority},zappar._light.prototype.drawGizmo=function(e){return zappar.sendMessage([this.refId,zappar._light.methods.METHOD_DRAW_GIZMO,e]),this},zappar._directionalLight=function(e){zappar._light.call(this,zappar._types.DIRECTIONALLIGHT,e)},zappar._directionalLight.prototype=Object.create(zappar._light.prototype),zappar._directionalLight.prototype.constructor=zappar._directionalLight,zappar.DirectionalLight=function(){return new zappar._directionalLight(this)},zappar._pointLight=function(e,t){zappar._light.call(this,e,t),this._range=3},zappar._pointLight.methods={METHOD_RANGE:200},zappar._pointLight.prototype=Object.create(zappar._light.prototype),zappar._pointLight.prototype.constructor=zappar._pointLight,zappar._pointLight.prototype._range_id=zappar._pointLight.methods.METHOD_RANGE,zappar._pointLight.prototype.range=function(e){return void 0!==e?(e!=this._range&&(this._range=e,zappar.sendMessage([this.refId,zappar._pointLight.methods.METHOD_RANGE,this._range])),this):this._range},zappar.PointLight=function(){return new zappar._pointLight(zappar._types.POINTLIGHT,this)},zappar._spotLight=function(e){zappar._light.call(this,zappar._types.SPOTLIGHT,e),this._angle=45,this._range=3},zappar._spotLight.methods={METHOD_ANGLE:300,METHOD_RANGE:301},zappar._spotLight.prototype=Object.create(zappar._light.prototype),zappar._spotLight.prototype.constructor=zappar._spotLight,zappar._spotLight.prototype._angle_id=zappar._spotLight.methods.METHOD_ANGLE,zappar._spotLight.prototype.angle=function(e){return void 0!==e?(e!=this._angle&&(this._angle=e,zappar.sendMessage([this.refId,zappar._spotLight.methods.METHOD_ANGLE,this._angle])),this):this._angle},zappar._spotLight.prototype._range_id=zappar._spotLight.methods.METHOD_RANGE,zappar._spotLight.prototype.range=function(e){return void 0!==e?(e!=this._range&&(this._range=e,zappar.sendMessage([this.refId,zappar._spotLight.methods.METHOD_RANGE,this._range])),this):this._range},zappar.SpotLight=function(){return new zappar._spotLight(this)},zappar._environmentLight=function(e){zappar._light.call(this,zappar._types.ENVIRONMENTLIGHT,e),this._reflectionCubeMap=null,this._irradianceCubeMap=null,this._mipLevel=0},zappar._environmentLight.methods={PARAM_REFLECTION_MAP:400,PARAM_IRRADIANCE_MAP:401,PARAM_MIPLEVEL:402},zappar._environmentLight.prototype=Object.create(zappar._light.prototype),zappar._environmentLight.prototype.constructor=zappar._environmentLight,zappar._environmentLight.prototype._reflectionCubeMap_id=zappar._environmentLight.methods.PARAM_REFLECTION_MAP,zappar._environmentLight.prototype.reflectionCubeMap=function(e){if(void 0===e)return this._reflectionCubeMap;var t=zappar._valuify.cubemapTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._environmentLight.methods.PARAM_REFLECTION_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._environmentLight.methods.PARAM_REFLECTION_MAP,null]),this._reflectionCubeMap&&this._reflectionCubeMap.removeDependent(this),this._reflectionCubeMap=t,this},zappar._environmentLight.prototype._irradianceCubeMap_id=zappar._environmentLight.methods.PARAM_IRRADIANCE_MAP,zappar._environmentLight.prototype.irradianceCubeMap=function(e){if(void 0===e)return this._irradianceCubeMap;var t=zappar._valuify.cubemapTexture(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._environmentLight.methods.PARAM_IRRADIANCE_MAP,t.refId]):zappar.sendMessage([this.refId,zappar._environmentLight.methods.PARAM_IRRADIANCE_MAP,null]),this._irradianceCubeMap&&this._irradianceCubeMap.removeDependent(this),this._irradianceCubeMap=t,this},zappar._environmentLight.prototype._mipLevel_id=zappar._environmentLight.methods.PARAM_MIPLEVEL,zappar._environmentLight.prototype.mipLevel=function(e){return void 0!==e?(e!=this._mipLevel&&(this._mipLevel=e,zappar.sendMessage([this.refId,zappar._environmentLight.methods.PARAM_MIPLEVEL,this._mipLevel])),this):this._mipLevel},zappar.EnvironmentLight=function(){return new zappar._environmentLight(this)},zappar._cameraManager=function(e){zappar._messageReceiver.call(this,zappar._types.CAMERAMANAGER,e);var t=this;this.rearCamera={use:function(){zappar.sendMessage([t.refId,zappar._cameraManager.methods.METHOD_USEREARCAMERA,null])}},zappar._deviceCapabilities&zappar._deviceCapabilityFrontCamera?this.frontCamera={use:function(){zappar.sendMessage([t.refId,zappar._cameraManager.methods.METHOD_USEFRONTCAMERA,null])}}:this.frontCamera=null,this.defaultCamera=this.rearCamera},zappar._cameraManager.methods={METHOD_USEREARCAMERA:50,METHOD_USEFRONTCAMERA:51,METHOD_ENABLE:52,METHOD_FOCUSINTENSIVE:53,METHOD_RESETEXPOSUREPOINTOFINTEREST:54},zappar._cameraManager.prototype=Object.create(zappar._messageReceiver.prototype),zappar._cameraManager.prototype.constructor=zappar._cameraManager,zappar._cameraManager.prototype._message=function(e){"cc"!==e[1]?zappar._messageReceiver.prototype._message.call(this,e):!0===e[2]?this.emit("frontcamera"):this.emit("rearcamera")},zappar._cameraManager.prototype.useFrontCamera=function(){return this.frontCamera&&this.frontCamera.use(),this},zappar._cameraManager.prototype.useRearCamera=function(){return this.rearCamera.use(),this},zappar._cameraManager.prototype.useDefaultCamera=zappar._cameraManager.prototype.useRearCamera,zappar._cameraManager.prototype.enable=function(e){return zappar.sendMessage([this.refId,zappar._cameraManager.methods.METHOD_ENABLE,e]),this},zappar._cameraManager.prototype.focusIntensive=function(e){return zappar.sendMessage([this.refId,zappar._cameraManager.methods.METHOD_FOCUSINTENSIVE,e]),this},zappar._cameraManager.prototype.resetExposurePointOfInterest=function(){return zappar.sendMessage([this.refId,zappar._cameraManager.methods.METHOD_RESETEXPOSUREPOINTOFINTEREST,null]),this},zappar.CameraManager=function(){return new zappar._cameraManager(this)},zappar._cameraTexture=function(e){zappar._texture.call(this,zappar._types.CAMERATEXTURE,e),this._cropMode=zappar.CameraTexture.CropMode.camera_full},zappar._cameraTexture.methods={PARAM_CROPMODE:100,METHOD_CLONETODATATEXTURE:101},zappar._cameraTexture.prototype=Object.create(zappar._texture.prototype),zappar._cameraTexture.prototype.constructor=zappar._cameraTexture,zappar.CameraTexture=function(){return new zappar._cameraTexture(this)},zappar.CameraTexture.CropMode={camera_full:0,screen_full:1,screen_square:2},zappar._cameraTexture.prototype._message=function(e){zappar._texture.prototype._message.call(this,e)},zappar._cameraTexture.prototype.toString=function(){return"CameraTexture"},zappar._cameraTexture.prototype.cropMode_valuify_=zappar._valuify.enum(zappar.CameraTexture.CropMode),zappar._cameraTexture.prototype._cropMode_id=zappar._cameraTexture.methods.PARAM_CROPMODE,zappar._cameraTexture.prototype.cropMode=function(e){return void 0!==e?(this._cropMode=this.cropMode_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._cameraTexture.methods.PARAM_CROPMODE,this._cropMode]),this):this._cropMode},zappar._cameraTexture.prototype.snapshot=function(e){return void 0===e&&(e=this._ctx.DataTexture()),zappar.sendMessage([this.refId,zappar._cameraTexture.methods.METHOD_CLONETODATATEXTURE,e.refId]),e},zappar._dataTexture=function(e){zappar._texture.call(this,zappar._types.DATATEXTURE,e),this._retrieveTokens={},this._nextRetrieveToken=0,this._saveResolveFunctions={},this._nextSaveResolveFunction=0,this._fromPromiseFunctions={},this._nextFromPromiseFunction=0},zappar._dataTexture.methods={METHOD_STORE:100,METHOD_RETRIEVE:101,METHOD_SAVE:102,METHOD_SHARE:103,METHOD_TODATAURL:104,METHOD_FROMDATAURL:105},zappar._dataTexture.prototype=Object.create(zappar._texture.prototype),zappar._dataTexture.prototype.constructor=zappar._dataTexture,zappar.DataTexture=function(){return new zappar._dataTexture(this)},zappar.DataTexture.ImageFormat={png:1,jpg:2},zappar._dataTexture.prototype._message=function(e){if("load"===e[1])return this._isLoading=!1,void this.addDependCount(-1);"r"!==e[1]?"save"!==e[1]&&"share"!==e[1]&&"dataurl"!==e[1]?"from"!==e[1]?zappar._texture.prototype._message.call(this,e):this._processFrom(e):this._processSaveShare(e):this._processRetrieve(e)},zappar._dataTexture.prototype.toString=function(){return"DataTexture"},zappar._dataTexture.prototype.store=function(e){zappar.sendMessage([this.refId,zappar._dataTexture.methods.METHOD_STORE,e])},zappar._dataTexture.prototype.share=function(a){var r=this;return new Promise(function(e){var t=r._nextSaveResolveFunction;r._nextSaveResolveFunction++,r._saveResolveFunctions[t]=e,zappar.sendMessage([r.refId,zappar._dataTexture.methods.METHOD_SHARE,[t,a]])})},zappar._dataTexture.prototype.save=function(a){var r=this;return new Promise(function(e){var t=r._nextSaveResolveFunction;r._nextSaveResolveFunction++,r._saveResolveFunctions[t]=e,zappar.sendMessage([r.refId,zappar._dataTexture.methods.METHOD_SAVE,[t,a]])})},zappar._dataTexture.prototype.toDataURL=function(a){var r=this;return new Promise(function(e){var t=r._nextSaveResolveFunction;r._nextSaveResolveFunction++,r._saveResolveFunctions[t]=e,zappar.sendMessage([r.refId,zappar._dataTexture.methods.METHOD_TODATAURL,[t,a]])})},zappar._dataTexture.prototype.toBlob=function(e){return this.toDataURL(e).then(function(e){return fetch(e)}).then(function(e){return e.blob()})},zappar._dataTexture.prototype.toArrayBuffer=function(e){return this.toDataURL(e).then(function(e){return fetch(e)}).then(function(e){return e.arrayBuffer()})},zappar._dataTexture.prototype.fromDataURL=function(r){var p=this;return new Promise(function(e,t){var a=p._nextFromPromiseFunction;p._nextFromPromiseFunction++,p._fromPromiseFunctions[a]=[e,t],zappar.sendMessage([p.refId,zappar._dataTexture.methods.METHOD_FROMDATAURL,[a,r]])})},zappar._dataTexture.prototype._dataURLFromBlob=function(r){return new Promise(function(e,t){var a=new FileReader;a.addEventListener("load",function(){e(a.result)}),a.addEventListener("error",function(){t(new Error("An error occurred reading data"))}),a.readAsDataURL(r)})},zappar._dataTexture.prototype.fromBlob=function(e){var t=this;return this._dataURLFromBlob(e).then(function(e){return t.fromDataURL(e)})},zappar._dataTexture.prototype.fromArrayBuffer=function(e){return this.fromBlob(new Blob([e]))},zappar._dataTexture.prototype.retrieve=function(e,t){var a=this._nextRetrieveToken;this._nextRetrieveToken++,void 0!==t&&(this._retrieveTokens[a]=t),zappar.sendMessage([this.refId,zappar._dataTexture.methods.METHOD_RETRIEVE,[a,e]])},zappar._dataTexture.prototype._processRetrieve=function(e){var t=e[2][0],a=e[2][1],r=this._retrieveTokens[t];void 0!==r&&(r(a),delete this._retrieveTokens[t])},zappar._dataTexture.prototype._processSaveShare=function(e){var t=e[2][0],a=e[2][1],r=this._saveResolveFunctions[t];void 0!==r&&(r(a),delete this._saveResolveFunctions[t])},zappar._dataTexture.prototype._processFrom=function(e){var t=e[2][0],a=e[2][1],r=this._fromPromiseFunctions[t];void 0!==r&&(a&&0<a.length?r[1](new Error(a)):r[0](),delete this._fromPromiseFunctions[t])},zappar._attitudeOrient=function(e){zappar._group.call(this,zappar._types.ATTITUDEORIENT,e)},zappar._attitudeOrient.methods={METHOD_RESETHEADING:200},zappar._attitudeOrient.prototype=Object.create(zappar._group.prototype),zappar._attitudeOrient.prototype.constructor=zappar._attitudeOrient,zappar._attitudeOrient.prototype.toString=function(){return"AttitudeOrient"},zappar._attitudeOrient.prototype.resetHeading=function(){zappar.sendMessage([this.refId,zappar._attitudeOrient.methods.METHOD_RESETHEADING,null])},zappar.AttitudeOrient=function(){return new zappar._attitudeOrient(this)},zappar._raycaster=function(e){zappar._node.call(this,zappar._types.RAYCASTER,e),this._colliderTag="",this._colliderLimit=-1,this._updatePhase=zappar.FramePhase.after_render},zappar._raycaster.methods={METHOD_SETCOLLIDERTAG:100,PARAM_COLLIDERLIMIT:101,PARAM_UPDATEPHASE:102},zappar._raycaster.prototype=Object.create(zappar._node.prototype),zappar._raycaster.prototype.constructor=zappar._raycaster,zappar._raycaster.prototype.colliderTag=function(e){if(void 0===e)return this._colliderTag;this._colliderTag=e;var t=this._ctx.tagManager.managerForTag(e);return zappar.sendMessage([this.refId,zappar._raycaster.methods.METHOD_SETCOLLIDERTAG,[t.refId,e]]),this},zappar._raycaster.prototype.colliderLimit=function(e){return void 0===e?this._colliderLimit:(this._colliderLimit=e,zappar.sendMessage([this.refId,zappar._raycaster.methods.PARAM_COLLIDERLIMIT,e]),this)},zappar._raycaster.prototype.updatePhase_valuify_=zappar._valuify.enum(zappar.FramePhase),zappar._raycaster.prototype.updatePhase=function(e){return void 0!==e?(this._updatePhase=e,zappar.sendMessage([this.refId,zappar._raycaster.methods.PARAM_UPDATEPHASE,this._updatePhase]),this):this._updatePhase},zappar._raycaster.prototype._processData=function(e){for(var t=0,a=e[2].length;t<a;t++){var r=zappar.objectsByRef[e[2][t]];r&&(r.emit("intersectionleave"),this.emit("intersectionleave",r))}var p=e[1],i=[];for(t=0,a=e[0].length;t<a;t++){var s=e[0][t],o={node:zappar.objectsByRef[s[0]],distance:s[1],raycaster:this,localPosition:[s[2],s[3],s[4]],localUv:[s[5],s[6]]};0<=p.indexOf(s[0])&&(o.node.emit("intersectionenter",o),this.emit("intersectionenter",o)),o.node.emit("intersection",o),i.push(o)}this.emit("intersections",i)},zappar._raycaster.prototype._message=function(e){"int"!==e[1]?zappar._node.prototype._message.call(this,e):this._processData(e[2])},zappar._raycaster.prototype.toString=function(){return"Raycaster"},zappar.Raycaster=function(){return new zappar._raycaster(this)},zappar._headsetManager=function(e){zappar._messageReceiver.call(this,zappar._types.HEADSETMANAGER,e),this._usingHeadset=!1},zappar._headsetManager.methods={METHOD_USEHEADSET:50,METHOD_SETDEVICEPARAMS:51},zappar._headsetManager.prototype=Object.create(zappar._messageReceiver.prototype),zappar._headsetManager.prototype.constructor=zappar._headsetManager,zappar._headsetManager.prototype._message=function(e){if("inhs"===e[1])return this._usingHeadset=e[2],void(!0===e[2]?this.emit("headsetenter"):this.emit("headsetleave"));"button"!==e[1]?zappar._messageReceiver.prototype._message.call(this,e):this.emit("headsetbutton")},zappar._headsetManager.prototype.useHeadset=function(){return zappar.sendMessage([this.refId,zappar._headsetManager.methods.METHOD_USEHEADSET,null]),this},zappar._headsetManager.prototype.usingHeadset=function(){return this._usingHeadset},zappar._headsetManager.prototype.setDeviceParameters=function(e,t,a,r){return zappar.sendMessage([this.refId,zappar._headsetManager.methods.METHOD_SETDEVICEPARAMS,[e,t,a,r]]),this},zappar.HeadsetManager=function(){return new zappar._headsetManager(this)},zappar._gravityBillboard=function(e){zappar._group.call(this,zappar._types.GRAVITYBILLBOARD,e)},zappar._gravityBillboard.prototype=Object.create(zappar._group.prototype),zappar._gravityBillboard.prototype.constructor=zappar._gravityBillboard,zappar._gravityBillboard.prototype.toString=function(){return"GravityBillboard"},zappar.GravityBillboard=function(){return new zappar._gravityBillboard(this)},zappar._video=function(e,t){zappar._texture.call(this,zappar._types.VIDEO,t),this._mask=!1,e&&this.source(e),this._currentTime=0,this._duration=-1,this._state=zappar.Video.PlaybackState.IDLE,this._size=[1,1],this._aspectRatio=-1,this._volume=[1,1]},zappar._video.methods={METHOD_SRC:100,METHOD_START:101,METHOD_PAUSE:102,METHOD_RESTART:103,METHOD_SEEKTO:104,PARAM_VOLUME:105},zappar._video.prototype=Object.create(zappar._texture.prototype),zappar._video.prototype.constructor=zappar._video,zappar.Video=function(e){return new zappar._video(e,this)},zappar.Video.PlaybackState={IDLE:0,READY:1,BUFFERING:2,PLAYING:3,ERROR:4,FINISH:5},zappar.Video.ErrorReason={NETWORK:0,SERVER:1,UNSUPPORTED_CONTENT:2},zappar._video.prototype.source=function(e){if(void 0===e)return this._source;var t=e.toLowerCase();if(0===t.indexOf("http://")||0===t.indexOf("https://")||0===t.indexOf("rtsp://")||0===t.indexOf("rtspu://")||0===t.indexOf("rtsps://"))this._source=e,zappar.sendMessage([this.refId,zappar._video.methods.METHOD_SRC,this._source]);else{this._source=this._ctx.filenameMap(e);var a=this._ctx.FileLoader(this._source),r=this;this._isLoading||(this._isLoading=!0,this.addDependCount(1)),a.on("downloaded",function(e){zappar.sendMessage([r.refId,zappar._video.methods.METHOD_SRC,e]),r._isLoading=!1,r.addDependCount(-1)})}return this},zappar._video.prototype.start=function(){return zappar.sendMessage([this.refId,zappar._video.methods.METHOD_START,null]),this},zappar._video.prototype.pause=function(){return zappar.sendMessage([this.refId,zappar._video.methods.METHOD_PAUSE,null]),this},zappar._video.prototype.restart=function(){return zappar.sendMessage([this.refId,zappar._video.methods.METHOD_RESTART,null]),this},zappar._video.prototype.time=function(e){return void 0===e?this._currentTime:(zappar.sendMessage([this.refId,zappar._video.methods.METHOD_SEEKTO,e]),this)},zappar._video.prototype.duration=function(){return this._duration},zappar._video.prototype.volume=function(e){return void 0===e?this._volume.slice():(this._volume=e.slice(),zappar.sendMessage([this.refId,zappar._video.methods.PARAM_VOLUME,this._volume]),this)},zappar._video.prototype.size=function(){return this._size},zappar._video.prototype.aspectRatio=function(){return this._aspectRatio},zappar._video._playbackStateEventMapping=["idle","paused","buffering","playing","error","finish"],zappar._video.prototype._stateChange=function(e){this._state=e[0],this._state===zappar.Video.PlaybackState.ERROR?this.emit("error",e[1],e[2]):this.emit(zappar._video._playbackStateEventMapping[this._state])},zappar._video.prototype._message=function(e){if("of"!==e[1]){if("st"!==e[1])return"dims"===e[1]?(this._size=e[2],void this.emit("resize",this._size[0],this._size[1])):"aspect"===e[1]?(this._aspectRatio=e[2],void this.emit("aspectratio",this._aspectRatio)):"ct"===e[1]?(this._currentTime=e[2],void this.emit("time",this._currentTime)):"dur"===e[1]?(this._duration=e[2],void this.emit("duration",this._duration)):void zappar._texture.prototype._message.call(this,e);this._stateChange(e[2])}else this.emit("finish")},zappar._video.prototype.toString=function(){return"Video"},zappar._triggerRegion=function(e){zappar._node.call(this,zappar._types.TRIGGERREGION,e),this._triggerTag="",this._reportLocalPosition=!0,this._reportParentPosition=!1,this._shape=zappar.TriggerRegion.Shape.cube,this._updatePhase=zappar.FramePhase.after_render},zappar._triggerRegion.methods={METHOD_SETTRIGGERTAG:100,PARAM_REPORTLOCALPOSITION:101,PARAM_REPORTPARENTPOSITION:102,PARAM_SHAPE:103,PARAM_UPDATEPHASE:104},zappar.TriggerRegion=function(){return new zappar._triggerRegion(this)},zappar.TriggerRegion.Shape={cube:0,sphere:1,cylinder:2,xy_square:3,xy_circle:4,none:5},zappar._triggerRegion.prototype=Object.create(zappar._node.prototype),zappar._triggerRegion.prototype.constructor=zappar._triggerRegion,zappar._triggerRegion.prototype.triggerTag=function(e){if(void 0===e)return this._triggerTag;if(null===e)return this;this._triggerTag=e;var t=this._ctx.tagManager.managerForTag(e);return zappar.sendMessage([this.refId,zappar._triggerRegion.methods.METHOD_SETTRIGGERTAG,[t.refId,e]]),this},zappar._triggerRegion.prototype.reportLocalPosition=function(e){return void 0===e?this._reportLocalPosition:(this._reportLocalPosition=e,zappar.sendMessage([this.refId,zappar._triggerRegion.methods.PARAM_REPORTLOCALPOSITION,e]),this)},zappar._triggerRegion.prototype.reportParentPosition=function(e){return void 0===e?this._reportParentPosition:(this._reportParentPosition=e,zappar.sendMessage([this.refId,zappar._triggerRegion.methods.PARAM_REPORTPARENTPOSITION,e]),this)},zappar._triggerRegion.prototype.shape_valuify_=zappar._valuify.enum(zappar.TriggerRegion.Shape),zappar._triggerRegion.prototype.shape=function(e){return void 0===e?this._shape:(this._shape=this.shape_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._triggerRegion.methods.PARAM_SHAPE,this._shape]),this)},zappar._triggerRegion.prototype.updatePhase_valuify_=zappar._valuify.enum(zappar.FramePhase),zappar._triggerRegion.prototype.updatePhase=function(e){return void 0!==e?(this._updatePhase=e,zappar.sendMessage([this.refId,zappar._triggerRegion.methods.PARAM_UPDATEPHASE,this._updatePhase]),this):this._updatePhase},zappar._triggerRegion.prototype._processData=function(e){for(var t=0,a=e[3].length;t<a;t++){var r=zappar.objectsByRef[e[3][t]];if(r){var p={node:r,triggerRegion:this};r.emit("triggerleave",p),this.emit("triggerleave",p)}}var i=e[0],s=e[2],o=[];for(t=0,a=e[1].length;t<a;t++){var n=e[1][t];p={node:zappar.objectsByRef[n[0]],triggerRegion:this};switch(i){case 1:p.localPosition=[n[1],n[2],n[3]];break;case 2:p.parentPosition=[n[1],n[2],n[3]];break;case 3:p.localPosition=[n[1],n[2],n[3]],p.parentPosition=[n[4],n[5],n[6]]}0<=s.indexOf(n[0])&&(p.node.emit("triggerenter",p),this.emit("triggerenter",p)),0<i&&(p.node.emit("triggermove",p),this.emit("triggermove",p)),o.push(p)}this.emit("triggers",o)},zappar._triggerRegion.prototype._message=function(e){"trgs"!==e[1]?zappar._node.prototype._message.call(this,e):this._processData(e[2])},zappar._triggerRegion.prototype.toString=function(){return"TriggerRegion"},zappar._dataObjectType=function(e){zappar._messageReceiver.call(this,zappar._types.DATAOBJECTTYPE,e)},zappar._dataObjectType.methods={METHOD_LOADTRIANGLE:100},zappar._dataObjectType.prototype=Object.create(zappar._messageReceiver.prototype),zappar._dataObjectType.prototype.constructor=zappar._dataObjectType,zappar._dataObjectType.prototype.loadTriangle=function(){return zappar.sendMessage([this.refId,zappar._dataObjectType.methods.METHOD_LOADTRIANGLE,null]),this},zappar._dataObjectType.prototype.toString=function(){return"DataObjectType"},zappar.DataObjectType=function(){return new zappar._dataObjectType(this)},zappar._faceFinder=function(e){zappar._messageReceiver.call(this,zappar._types.FACEFINDER,e),this._faces=[],this._trackingEnabled=!0,this._maxFaces=1},zappar._faceFinder.methods={METHOD_ADDFACE:50,PARAM_TRACKING_ENABLED:51,PARAM_MAX_FACES:52},zappar._faceFinder.prototype=Object.create(zappar._messageReceiver.prototype),zappar._faceFinder.prototype.constructor=zappar._faceFinder,zappar._faceFinder.prototype.trackingEnabled=function(e){return void 0!==e?(this._trackingEnabled=e,zappar.sendMessage([this.refId,zappar._faceFinder.methods.PARAM_TRACKING_ENABLED,this._trackingEnabled]),this):this._trackingEnabled},zappar._faceFinder.prototype.maxFaces=function(e){return void 0!==e?(this._maxFaces=e,zappar.sendMessage([this.refId,zappar._faceFinder.methods.PARAM_MAX_FACES,this._maxFaces]),this):this._maxFaces},zappar._faceFinder.prototype.enabled=function(e){return void 0===this._enabledDummy&&(this._enabledDummy=!0),void 0!==e?(this._enabledDummy=e,this):this._enabledDummy},zappar._faceFinder.prototype._message=function(e){if("face"===e[1]){var t=this._ctx.FaceInstance(e[2]);return(t._faceFinder=this)._faces.push(t),zappar.sendMessage([this.refId,zappar._faceFinder.methods.METHOD_ADDFACE,[t.refId,e[2]]]),void this.emit("newinstance",t)}zappar._messageReceiver.prototype._message.call(this,e)},zappar._faceFinder.prototype.toString=function(){return"FaceFinder"},zappar.FaceFinder=function(){return new zappar._faceFinder(this)},zappar._faceInstance=function(e,t){this._id=e,zappar._messageReceiver.call(this,zappar._types.FACEINSTANCE,t),this._faceFinder=null,this._warp2DObjectType=null,this._objectType=null,this._textureMapMode=zappar.FaceInstance.TextureMapMode.reference,this._attachmentPointsByName={}},zappar._faceInstance.methods={PARAM_WARP2DOBJECTTYPE:100,PARAM_WARP2DTEXTUREMAPMODE:101,PARAM_OBJECTTYPE:102,METHOD_PUSHATTACHMENTPOINT:103},zappar._faceInstance.prototype=Object.create(zappar._messageReceiver.prototype),zappar._faceInstance.prototype.constructor=zappar._faceInstance,zappar.FaceInstance=function(e){return new zappar._faceInstance(e,this)},zappar.FaceInstance.TextureMapMode={reference:1,camera_full:2},zappar.FaceInstance.AttachmentPoint={center_3d:"center_3d",center_2d:"center_2d",origin:"origin",left_eye:"left_eye",right_eye:"right_eye",left_ear:"left_ear",right_ear:"right_ear",nose_bridge:"nose_bridge",nose_tip:"nose_tip",nose_base:"nose_base",top_lip:"top_lip",mouth_center:"mouth_center",bottom_lip:"bottom_lip",chin:"chin",left_eyebrow:"left_eyebrow",right_eyebrow:"right_eyebrow"},zappar._faceInstance.prototype._message=function(e){return"seen"===e[1]?(this.emit("seen"),void this._faceFinder.emit("seen",this)):"notseen"===e[1]?(this.emit("notseen"),void this._faceFinder.emit("notseen",this)):"mouthopen"===e[1]||"mouthclose"===e[1]||"lefteyeopen"===e[1]||"lefteyeclose"===e[1]||"righteyeopen"===e[1]||"righteyeclose"===e[1]?(this.emit(e[1]),void this._faceFinder.emit(e[1],this)):void zappar._messageReceiver.prototype._message.call(this,e)},zappar._faceInstance.prototype.warp2DObjectType_valuify_=function(e,t){return"string"!=typeof t?t:e.byId(t)},zappar._faceInstance.prototype.warp2DObjectType=function(e){return void 0===e?(null===this._warp2DObjectType&&this.warp2DObjectType(this._ctx.DataObjectType()),this._warp2DObjectType):(this._warp2DObjectType=e,zappar.sendMessage([this.refId,zappar._faceInstance.methods.PARAM_WARP2DOBJECTTYPE,this._warp2DObjectType?this._warp2DObjectType.refId:null]),this)},zappar._faceInstance.prototype.objectType_valuify_=function(e,t){return"string"!=typeof t?t:e.byId(t)},zappar._faceInstance.prototype.objectType=function(e){return void 0===e?(null===this._objectType&&this.objectType(this._ctx.DataObjectType()),this._objectType):(this._objectType=e,zappar.sendMessage([this.refId,zappar._faceInstance.methods.PARAM_OBJECTTYPE,this._objectType?this._objectType.refId:null]),this)},zappar._faceInstance.prototype.warp2DtextureMapMode_valuify_=zappar._valuify.enum(zappar.FaceInstance.TextureMapMode),zappar._faceInstance.prototype.warp2DtextureMapMode=function(e){return console.log("OUT SETTING MODE: ",e),void 0!==e?(console.log("SETTING MODE: ",e),this._textureMapMode=this.warp2DtextureMapMode_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._faceInstance.methods.PARAM_WARP2DTEXTUREMAPMODE,this._textureMapMode]),this):this._textureMapMode},zappar._faceInstance.prototype.attachmentPoint=function(e){var t=this._attachmentPointsByName[e];return t||(t=this._ctx.ObjectAttachmentPoint(),"center_2d"===e?zappar.screen.push(t):zappar.camera.push(t),this._pushAttachmentPoint(t,e),this._attachmentPointsByName[e]=t),t},zappar._faceInstance.prototype._pushAttachmentPoint=function(e,t){zappar.sendMessage([this.refId,zappar._faceInstance.methods.METHOD_PUSHATTACHMENTPOINT,[e.refId,t]])},zappar._faceInstance.prototype.toString=function(){return"FaceInstance"},zappar._objectAttachmentPoint=function(e){zappar._group.call(this,zappar._types.OBJECTATTACHMENTPOINT,e)},zappar._objectAttachmentPoint.prototype=Object.create(zappar._group.prototype),zappar._objectAttachmentPoint.prototype.constructor=zappar._objectAttachmentPoint,zappar._objectAttachmentPoint.prototype.toString=function(){return"ObjectAttachmentPoint"},zappar.ObjectAttachmentPoint=function(){return new zappar._objectAttachmentPoint(this)},zappar._flashlightStatic=function(e){zappar._messageReceiver.call(this,zappar._types.FLASHLIGHTSTATIC,e),this._has=!1,this._active=null},zappar._flashlightStatic.methods={METHOD_ACTIVE:50},zappar._flashlightStatic.prototype=Object.create(zappar._messageReceiver.prototype),zappar._flashlightStatic.prototype.constructor=zappar._flashlightStatic,zappar._flashlightStatic.prototype._message=function(e){if("has"!==e[1])return"active"===e[1]?(this._active=!0,void this.emit("active")):"inactive"===e[1]?(this._active=!1,void this.emit("inactive")):void zappar._messageReceiver.prototype._message.call(this,e);this._has=e[2]},zappar._flashlightStatic.prototype.active=function(e){return void 0===e?this._active:(zappar.sendMessage([this.refId,zappar._flashlightStatic.methods.METHOD_ACTIVE,e]),this)},zappar._flashlightStatic.prototype.has=function(){return this._has},zappar._flashlightStatic.prototype.toString=function(){return"Flashlight Static"},zappar.flashlightStatic=new zappar._flashlightStatic(zappar),zappar._flashlight=function(e){zappar._base.call(this,e);var t=this;zappar.flashlightStatic.on("active",function(){t.emit("active")}),zappar.flashlightStatic.on("inactive",function(){t.emit("inactive")})},zappar._flashlight.prototype=Object.create(zappar._base.prototype),zappar._flashlight.prototype.constructor=zappar._flashlight,zappar._flashlight.prototype.toString=function(){return"Flashlight"},zappar._flashlight.prototype.has=function(){return zappar.flashlightStatic.has()},zappar._flashlight.prototype.active=function(e){return zappar.flashlightStatic.active(e),this},zappar._flashlight.prototype.on=function(e,t){zappar._base.prototype.on.call(this,e,t);var a=zappar.flashlightStatic.active();return("active"===e&&!0===a||"inactive"===e&&!1===a)&&t.call(this),this},zappar.Flashlight=function(){return new zappar._flashlight(this)},zappar._transformedTexture=function(e,t){zappar._texture.call(this,zappar._types.TRANSFORMEDTEXTURE,t),this._texture=null,e&&this.texture(e)},zappar._transformedTexture.methods={PARAM_TEXTURE:100},zappar._transformedTexture.prototype=Object.create(zappar._texture.prototype),zappar._transformedTexture.prototype.constructor=zappar._transformedTexture,zappar._transformedTexture.prototype.texture_valuify_=zappar._valuify.imageTexture,zappar._transformedTexture.prototype._skin_id=zappar._transformedTexture.methods.PARAM_TEXTURE,zappar._transformedTexture.prototype.texture=function(e){if(void 0===e)return this._texture;var t=this.texture_valuify_(this._ctx,e);return t&&t.pushDependent(this),t?zappar.sendMessage([this.refId,zappar._transformedTexture.methods.PARAM_TEXTURE,t.refId]):zappar.sendMessage([this.refId,zappar._transformedTexture.methods.PARAM_TEXTURE,null]),this._texture&&this._texture.removeDependent(this),this._texture=t,this},zappar._transformedTexture.prototype._message=function(e){zappar._texture.prototype._message.call(this,e)},zappar._transformedTexture.prototype.toString=function(){return"TransformedTexture"},zappar.TransformedTexture=function(e){return new zappar._transformedTexture(e,this)},zappar._videoRecorder=function(e){zappar._messageReceiver.call(this,zappar._types.VIDEORECORDER,e),this._orientation=0,this._captureAudio=!0},zappar._videoRecorder.prototype=Object.create(zappar._messageReceiver.prototype),zappar._videoRecorder.prototype.constructor=zappar._videoRecorder,zappar.VideoRecorder=function(){return new zappar._videoRecorder(this)},zappar.VideoRecorder.Orientation={auto:0,landscape:1,portrait:2,landscapeinverted:3,portraitinverted:4},zappar._videoRecorder.methods={METHOD_START:50,METHOD_STOP:51,METHOD_SAVE:52,METHOD_SHARE:53,PARAM_ORIENTATION:54,PARAM_CAPTUREAUDIO:55},zappar._videoRecorder._statusMapping=["idle","preparing","record","stop","finish","error"],zappar._videoRecorder.prototype._message=function(e){if("s"===e[1])return console.log("Got status:",e[2]),void(4===e[2]?this.emit("finish",e[3]):this.emit(zappar._videoRecorder._statusMapping[e[2]]));zappar._messageReceiver.prototype._message.call(this,e)},zappar._videoRecorder.prototype.start=function(){return zappar.sendMessage([this.refId,zappar._videoRecorder.methods.METHOD_START,null]),this},zappar._videoRecorder.prototype.stop=function(){return zappar.sendMessage([this.refId,zappar._videoRecorder.methods.METHOD_STOP,null]),this},zappar._videoRecorder.prototype.save=function(){return zappar.sendMessage([this.refId,zappar._videoRecorder.methods.METHOD_SAVE,null]),this},zappar._videoRecorder.prototype.orientation_valuify_=zappar._valuify.enum(zappar.VideoRecorder.Orientation),zappar._videoRecorder.prototype.orientation=function(e){return e?(this._orientation=this.orientation_valuify_(this._ctx,e),zappar.sendMessage([this.refId,zappar._videoRecorder.methods.PARAM_ORIENTATION,this._orientation]),this):this._orientation},zappar._videoRecorder.prototype._captureAudio_id=zappar._videoRecorder.methods.PARAM_CAPTUREAUDIO,zappar._videoRecorder.prototype.captureAudio=function(e){return void 0!==e?(this._captureAudio=e,zappar.sendMessage([this.refId,zappar._videoRecorder.methods.PARAM_CAPTUREAUDIO,this._captureAudio]),this):this._captureAudio},zappar._videoRecorder.prototype.share=function(e){console.log("SHARE 1");var t=e;return void 0===e?t={message:this._snapshotMessage,social:this._socialShare}:"string"==typeof e&&(t={message:e,social:this._socialShare}),console.log("SHARE 2"),zappar.sendMessage([this.refId,zappar._videoRecorder.methods.METHOD_SHARE,t]),this},zappar._worldTracker=function(e){zappar._messageReceiver.call(this,zappar._types.WORLDTRACKER,e);var t=this._ctx.Anchor("worldanchor"),a=this._ctx.Anchor("groundanchor");zappar.camera.push(t),(t._worldTracker=this)._worldAnchor=t,zappar.camera.push(a),a.relativeTo(t),(a._worldTracker=this)._groundAnchor=a,zappar.sendMessage([this.refId,50,[t.refId,a.refId]]),this._planeAnchors=[],this._trackingEnabled=!0,this._horizontalPlaneDetection=!1,this._verticalPlaneDetection=!1,this._relocalization=!1,this._trackingQuality=zappar.WorldTracker.TrackingQuality.initializing,this._groundEstimateQuality=zappar.WorldTracker.GroundEstimateQuality.initial},zappar._worldTracker.methods={METHOD_SET_ANCHORS:50,PARAM_TRACKING_ENABLED:51,PARAM_HORIZONTAL_PLANE_DETECTION:52,PARAM_VERTICAL_PLANE_DETECTION:53,PARAM_RELOCALIZATION:54,METHOD_ADD_PLANE_ANCHOR:55,METHOD_RESET_COORDINATES:56,METHOD_RESET_TRACKING:57},zappar._worldTracker.prototype=Object.create(zappar._messageReceiver.prototype),zappar._worldTracker.prototype.constructor=zappar._worldTracker,zappar.WorldTracker=function(){return new zappar._worldTracker(this)},zappar.WorldTracker.AnchorTrackingState={initial:0,limited:1,good:2,stopped:3},zappar.WorldTracker.PlaneOrientation={horizontal_upward_facing:0,horizontal_downward_facing:1,vertical:2},zappar.WorldTracker.TrackingQuality={gravity_only:0,gyro_only:1,initializing:2,relocalizing:3,limited:4,good:5},zappar.WorldTracker.GroundEstimateQuality={initial:0,previous_plane:1,current_plane:2},zappar._worldTracker.prototype.trackingEnabled=function(e){return void 0!==e?(this._trackingEnabled=e,zappar.sendMessage([this.refId,zappar._worldTracker.methods.PARAM_TRACKING_ENABLED,this._trackingEnabled]),this):this._trackingEnabled},zappar._worldTracker.prototype.positionTracking=zappar._worldTracker.prototype.trackingEnabled,zappar._worldTracker.prototype.horizontalPlaneDetection=function(e){return void 0!==e?(this._horizontalPlaneDetection=e,zappar.sendMessage([this.refId,zappar._worldTracker.methods.PARAM_HORIZONTAL_PLANE_DETECTION,this._horizontalPlaneDetection]),this):this._horizontalPlaneDetection},zappar._worldTracker.prototype.verticalPlaneDetection=function(e){return void 0!==e?(this._verticalPlaneDetection=e,zappar.sendMessage([this.refId,zappar._worldTracker.methods.PARAM_VERTICAL_PLANE_DETECTION,this._verticalPlaneDetection]),this):this._verticalPlaneDetection},zappar._worldTracker.prototype.relocalization=function(e){return void 0!==e?(this._relocalization=e,zappar.sendMessage([this.refId,zappar._worldTracker.methods.PARAM_RELOCALIZATION,this._relocalization]),this):this._relocalization},zappar._worldTracker.prototype.resetCoordinates=function(){return zappar.sendMessage([this.refId,zappar._worldTracker.methods.METHOD_RESET_COORDINATES,null]),this},zappar._worldTracker.prototype.resetTracking=function(){return zappar.sendMessage([this.refId,zappar._worldTracker.methods.METHOD_RESET_TRACKING,null]),this},zappar._worldTracker.prototype._message=function(e){if("newplaneanchor"!==e[1])return"tq"===e[1]?(this._trackingQuality=e[2],void this.emit("trackingqualitychanged",e[2])):"gq"===e[1]?(this._groundEstimateQuality=e[2],void this.emit("groundestimatequalitychanged",e[2])):void zappar._messageReceiver.prototype._message.call(this,e);var t=this._ctx.PlaneAnchor(e[2][0],e[2][1]);return t.relativeTo(this._worldAnchor),zappar.camera.push(t),(t._worldTracker=this)._planeAnchors.push(t),zappar.sendMessage([this.refId,zappar._worldTracker.methods.METHOD_ADD_PLANE_ANCHOR,[t.refId,e[2][0]]]),void this.emit("newplaneanchor",t)},zappar._worldTracker.prototype.worldAnchor=function(){return this._worldAnchor},zappar._worldTracker.prototype.groundAnchor=function(){return this._groundAnchor},zappar._worldTracker.prototype.groundEstimateQuality=function(){return this._groundEstimateQuality},zappar._worldTracker.prototype.trackingQuality=function(){return this._trackingQuality},zappar._worldTracker.prototype.toString=function(){return"WorldTracker"},zappar._anchor=function(e,t,a){zappar._node.call(this,t,a),this._identifier=e,this._worldTracker=null,this._trackingState=zappar.WorldTracker.AnchorTrackingState.initial},zappar._anchor.prototype=Object.create(zappar._node.prototype),zappar._anchor.prototype.constructor=zappar._anchor,zappar._anchor.prototype._message=function(e){if("ts"!==e[1])return"found"===e[1]?(this.emit("found"),void(this._worldTracker&&this._worldTracker.emit("found",this))):"notfound"===e[1]?(this.emit("notfound"),void(this._worldTracker&&this._worldTracker.emit("notfound",this))):void zappar._messageReceiver.prototype._message.call(this,e);this._updateTrackingState(e[2])},zappar._anchor.prototype.identifier=function(e){return void 0===e?this._identifier:(this._identifier=e,this)},zappar._anchor.prototype._updateTrackingState=function(e){this._trackingState!==e&&(this._trackingState=e,this.emit("trackingstatechanged",this._trackingState),this._worldTracker&&this._worldTracker.emit("anchortrackingstatechanged",this,this._trackingState))},zappar._anchor.prototype.trackingState=function(){return this._trackingState},zappar._anchor.prototype.toString=function(){return"Anchor"},zappar.Anchor=function(e){return new zappar._anchor(e,zappar._types.ANCHOR,this)},zappar._planeAnchor=function(e,t,a){zappar._anchor.call(this,e,zappar._types.PLANEANCHOR,a),this._planeOrientation=t,this._objectType=null},zappar._planeAnchor.methods={PARAM_OBJECTTYPE:150},zappar._planeAnchor.prototype=Object.create(zappar._anchor.prototype),zappar._planeAnchor.prototype.constructor=zappar._planeAnchor,zappar._planeAnchor.prototype._message=function(e){if("ec"===e[1])return this.emit("extentchanged",e[2].slice()),void(this._worldTracker&&this._worldTracker.emit("planeextentchanged",this,e[2].slice()));zappar._anchor.prototype._message.call(this,e)},zappar._planeAnchor.prototype.planeOrientation=function(){return this._planeOrientation},zappar._planeAnchor.prototype.objectType_valuify_=function(e,t){return"string"!=typeof t?t:e.byId(t)},zappar._planeAnchor.prototype.objectType=function(e){return void 0===e?(null===this._objectType&&this.objectType(this._ctx.PlaneAnchorDataObjectType()),this._objectType):(this._objectType=e,zappar.sendMessage([this.refId,zappar._planeAnchor.methods.PARAM_OBJECTTYPE,this._objectType?this._objectType.refId:null]),this)},zappar._planeAnchor.prototype.toString=function(){return"PlaneAnchor"},zappar.PlaneAnchor=function(e,t){return new zappar._planeAnchor(e,t,this)},zappar._faceDataObjectType=function(e){zappar._messageReceiver.call(this,zappar._types.FACEDATAOBJECTTYPE,e),this._setExpressionCoefficients=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},zappar._faceDataObjectType.methods={PARAM_EXPRESSION:150,METHOD_SET_IDENTITY_COEFFICIENTS:151},zappar._faceDataObjectType.prototype=Object.create(zappar._dataObjectType.prototype),zappar._faceDataObjectType.prototype.constructor=zappar._faceDataObjectType,zappar._faceDataObjectType.prototype._setExpressionCoefficients_id=zappar._faceDataObjectType.methods.PARAM_EXPRESSION,zappar._faceDataObjectType.prototype.setExpressionCoefficients=function(e){return void 0===e?this._setExpressionCoefficients.slice():(this._setExpressionCoefficients=e.slice(),zappar.sendMessage([this.refId,zappar._faceDataObjectType.methods.PARAM_EXPRESSION,this._setExpressionCoefficients]),this)},zappar._faceDataObjectType.prototype.setIdentityCoefficients=function(e){return zappar.sendMessage([this.refId,zappar._faceDataObjectType.methods.METHOD_SET_IDENTITY_COEFFICIENTS,e]),this},zappar._faceDataObjectType.prototype.toString=function(){return"FaceDataObjectType"},zappar.FaceDataObjectType=function(){return new zappar._faceDataObjectType(this)},zappar._dataFiles={},zappar._dataFile=function(e,t){zappar._messageReceiver.call(this,zappar._types.DATAFILE,t),(zappar._dataFiles[e]=this)._fileLoader=t.FileLoader(e);var a=this;this.addDependCount(1),this._fileLoader.on("downloaded",function(e){zappar.sendMessage([a.refId,zappar._dataFile.methods.PARAM_SRC,e]),a.addDependCount(-1)})},zappar._dataFile.methods={PARAM_SRC:50},zappar._dataFile.prototype=Object.create(zappar._messageReceiver.prototype),zappar._dataFile.prototype.constructor=zappar._dataFile,zappar.DataFile=function(e){return e=this.filenameMap(e),zappar._dataFiles[e]?zappar._dataFiles[e]:new zappar._dataFile(e,this)},zappar._embeddedTexture=function(e,t,a){zappar._texture.call(this,zappar._types.EMBEDDEDTEXTURE,a),this._objectType=null,void(this._textureIndex=0)!==e&&this.objectType(e),void 0!==t&&this.textureIndex(t)},zappar._embeddedTexture.methods={PARAM_OBJECTTYPE:100,PARAM_TEXTUREINDEX:101,METHOD_DISPOSE:102},zappar._embeddedTexture.prototype=Object.create(zappar._texture.prototype),zappar._embeddedTexture.prototype.constructor=zappar._embeddedTexture,zappar._embeddedTexture.prototype._message=function(e){zappar._texture.prototype._message.call(this,e)},zappar._embeddedTexture.prototype.toString=function(){return"EmbeddedTexture"},zappar._embeddedTexture.prototype.objectType_valuify_=zappar._valuify.objectType,zappar._embeddedTexture.prototype.objectType=function(e){return void 0===e?this._objectType:(this._objectType!=e&&(this._objectType=this.objectType_valuify_(this._ctx,e),this._objectType?zappar.sendMessage([this.refId,zappar._embeddedTexture.methods.PARAM_OBJECTTYPE,this._objectType.refId]):(this._objectType=null,zappar.sendMessage([this.refId,zappar._embeddedTexture.methods.PARAM_OBJECTTYPE,null]))),this)},zappar._embeddedTexture.prototype.dispose=function(){return zappar.sendMessage([this.refId,zappar._embeddedTexture.methods.METHOD_DISPOSE,null]),this},zappar._embeddedTexture.prototype.textureIndex=function(e){if(void 0===e)return this._textureIndex;this._textureIndex=e,zappar.sendMessage([this.refId,zappar._embeddedTexture.methods.PARAM_TEXTUREINDEX,e])},zappar.EmbeddedTexture=function(e,t){return new zappar._embeddedTexture(e,t,this)},zappar._customAnchor=function(e,t){zappar._anchor.call(this,e,zappar._types.CUSTOMANCHOR,t)},zappar._customAnchor.methods={METHOD_SETTRANSFORMFROMANCHOR:101,METHOD_SETTRANSFORMFROMCAMERA:102,METHOD_DETACH:103},zappar._customAnchor.prototype=Object.create(zappar._anchor.prototype),zappar._customAnchor.prototype.constructor=zappar._customAnchor,zappar.CustomAnchor=function(e){return void 0===e&&(e="customanchor"),new zappar._customAnchor(e,this)},zappar.CustomAnchor.TransformOrientation={reference:0,z_reference_y_away_from_user:1,z_reference_y_heading:2,z_reference_y_up:3,z_reference_y_ground:4,world:5,y_up_minusz_away_from_user:6,y_up_minusz_heading:7,ground:8,z_up_y_away_from_user:9,z_up_y_heading:10,unchanged:11},zappar._customAnchor.prototype.detach=function(){this._updateTrackingState(zappar.WorldTracker.AnchorTrackingState.stopped),this._worldTracker=null,zappar.sendMessage([this.refId,zappar._customAnchor.methods.METHOD_DETACH,null])},zappar._customAnchor.prototype.setTransformFromAnchor=function(e,t,a){if(e._worldTracker){this.detach(),this._worldTracker=e._worldTracker,this.relativeTo(e._worldTracker._worldAnchor);var r=a;void 0===r&&(r=zappar.CustomAnchor.TransformOrientation.reference),this._updateTrackingState(zappar.WorldTracker.AnchorTrackingState.initial),zappar.sendMessage([this.refId,zappar._customAnchor.methods.METHOD_SETTRANSFORMFROMANCHOR,[e.refId,t.slice(),r]])}},zappar._customAnchor.prototype.setTransformFromCamera=function(e,t,a){this.detach(),this._worldTracker=e,this.relativeTo(e._worldAnchor);var r=a;void 0===r&&(r=zappar.CustomAnchor.TransformOrientation.reference),this._updateTrackingState(zappar.WorldTracker.AnchorTrackingState.initial),zappar.sendMessage([this.refId,zappar._customAnchor.methods.METHOD_SETTRANSFORMFROMCAMERA,[e.refId,t.slice(),r]])},zappar._customAnchor.prototype.toString=function(){return"CustomAnchor"},zappar._planeAnchorDataObjectType=function(e){zappar._messageReceiver.call(this,zappar._types.PLANEANCHORDATAOBJECTTYPE,e),this._fadeLength=0,this._maxFadeFactor=.2},zappar._planeAnchorDataObjectType.methods={PARAM_FADELENGTH:150,PARAM_MAXFADEFACTOR:151},zappar._planeAnchorDataObjectType.prototype=Object.create(zappar._dataObjectType.prototype),zappar._planeAnchorDataObjectType.prototype.constructor=zappar._planeAnchorDataObjectType,zappar._planeAnchorDataObjectType.prototype._fadeLength_id=zappar._planeAnchorDataObjectType.methods.PARAM_FADELENGTH,zappar._planeAnchorDataObjectType.prototype.fadeLength=function(e){return void 0!==e?(this._fadeLength=e,zappar.sendMessage([this.refId,zappar._planeAnchorDataObjectType.methods.PARAM_FADELENGTH,this._fadeLength]),this):this._fadeLength},zappar._planeAnchorDataObjectType.prototype._maxFadeFactor_id=zappar._planeAnchorDataObjectType.methods.PARAM_MAXFADEFACTOR,zappar._planeAnchorDataObjectType.prototype.maxFadeFactor=function(e){return void 0!==e?(this._maxFadeFactor=e,zappar.sendMessage([this.refId,zappar._planeAnchorDataObjectType.methods.PARAM_MAXFADEFACTOR,this._maxFadeFactor]),this):this._maxFadeFactor},zappar._planeAnchorDataObjectType.prototype.toString=function(){return"PlaneAnchorDataObjectType"},zappar.PlaneAnchorDataObjectType=function(){return new zappar._planeAnchorDataObjectType(this)},zappar._instantTrackerAnchor=function(e){zappar._node.call(this,zappar._types.INSTANTTRACKERANCHOR,e)},zappar._instantTrackerAnchor.prototype=Object.create(zappar._node.prototype),zappar._instantTrackerAnchor.prototype.constructor=zappar._instantTrackerAnchor,zappar._instantTrackerAnchor.prototype.toString=function(){return"InstantTrackerAnchor"},zappar.InstantTrackerAnchor=function(){return new zappar._instantTrackerAnchor(this)},zappar._instantTracker=function(e){zappar._messageReceiver.call(this,zappar._types.INSTANTTRACKER,e),this._enabled=!0,this._anchor=this._ctx.InstantTrackerAnchor(),zappar.camera.push(this._anchor),zappar.sendMessage([this.refId,zappar._instantTracker.methods.METHOD_SET_ANCHOR,this._anchor.refId])},zappar._instantTracker.methods={METHOD_SET_ANCHOR:50,METHOD_SET_ANCHOR_TRANSFORM:51,PARAM_ENABLED:52},zappar._instantTracker.prototype=Object.create(zappar._messageReceiver.prototype),zappar._instantTracker.prototype.constructor=zappar._instantTracker,zappar.InstantTracker=function(){return new zappar._instantTracker(this)},zappar.InstantTracker.TransformOrientation={ground:0,z_up_y_away_from_user:1,z_up_y_heading:2,world:3,y_up_minusz_away_from_user:4,y_up_minusz_heading:5,unchanged:6},zappar._instantTracker.prototype.anchor=function(){return this._anchor},zappar._instantTracker.prototype.enabled=function(e){return void 0!==e?(this._enabled=e,zappar.sendMessage([this.refId,zappar._instantTracker.methods.PARAM_ENABLED,this._enabled]),this):this._enabled},zappar._instantTracker.prototype.setAnchorTransformFromCamera=function(e,t){if(!e)return this;var a=e.slice(),r=t;return void 0===r&&(r=zappar.InstantTracker.TransformOrientation.ground),zappar.sendMessage([this.refId,zappar._instantTracker.methods.METHOD_SET_ANCHOR_TRANSFORM,[a,r]]),this},zappar._instantTracker.prototype.toString=function(){return"InstantTracker"},zappar._barcodeFinder=function(e){zappar._messageReceiver.call(this,zappar._types.BARCODEFINDER,e),this._barcodes=[],this._trackingEnabled=!0,this._decodeOnly=null},zappar._barcodeFinder.methods={METHOD_ADDINSTANCE:50,PARAM_TRACKING_ENABLED:51,PARAM_DECODEONLY:52},zappar._barcodeFinder.prototype=Object.create(zappar._messageReceiver.prototype),zappar._barcodeFinder.prototype.constructor=zappar._barcodeFinder,zappar.BarcodeFinder=function(){return new zappar._barcodeFinder(this)},zappar.BarcodeFinder.Format={aztec:0,codabar:1,code_39:2,code_93:3,code_128:4,data_matrix:5,ean_8:6,ean_13:7,itf:8,maxicode:9,pdf_417:10,qr_code:11,rss_14:12,rss_expanded:13,upc_a:14,upc_e:15,upc_ean_extension:16,format_unknown:17},zappar._barcodeFinder.prototype.trackingEnabled=function(e){return void 0!==e?(this._trackingEnabled=e,zappar.sendMessage([this.refId,zappar._barcodeFinder.methods.PARAM_TRACKING_ENABLED,this._trackingEnabled]),this):this._trackingEnabled},zappar._barcodeFinder.prototype.decodeOnly=function(e){return void 0===e?this._decodeOnly:(e?Array.isArray(e)?this._decodeOnly=e.slice():this._decodeOnly=[e]:this._decodeOnly=null,zappar.sendMessage([this.refId,zappar._barcodeFinder.methods.PARAM_DECODEONLY,this._decodeOnly]),this)},zappar._barcodeFinder.prototype._message=function(e){if("instance"===e[1]){var t=this._ctx.BarcodeInstance(e[2][0],e[2][1],e[2][2]);return zappar.camera.push(t),(t._barcodeFinder=this)._barcodes.push(t),zappar.sendMessage([this.refId,zappar._barcodeFinder.methods.METHOD_ADDINSTANCE,[t.refId,e[2][0]]]),void this.emit("newinstance",t)}zappar._messageReceiver.prototype._message.call(this,e)},zappar._barcodeFinder.prototype.toString=function(){return"BarcodeFinder"},zappar._barcodeInstance=function(e,t,a,r){this._id=e,this._data=t,this._format=a,zappar._node.call(this,zappar._types.BARCODEINSTANCE,r),this._barcodeFinder=null},zappar._barcodeInstance.methods={},zappar._barcodeInstance.prototype=Object.create(zappar._node.prototype),zappar._barcodeInstance.prototype.constructor=zappar._barcodeInstance,zappar.BarcodeInstance=function(e,t,a){return new zappar._barcodeInstance(e,t,a,this)},zappar._barcodeInstance.prototype._message=function(e){return"present"===e[1]?(this.emit("present"),void this._barcodeFinder.emit("present",this)):"notpresent"===e[1]?(this.emit("notpresent"),void this._barcodeFinder.emit("notpresent",this)):"seen"===e[1]?(this.emit("seen"),void this._barcodeFinder.emit("seen",this)):"notseen"===e[1]?(this.emit("notseen"),void this._barcodeFinder.emit("notseen",this)):void zappar._messageReceiver.prototype._message.call(this,e)},zappar._barcodeInstance.prototype.data=function(){return this._data},zappar._barcodeInstance.prototype.format=function(){return this._format},zappar._barcodeInstance.prototype.toString=function(){return"BarcodeInstance"},zappar._imageLookup=function(e,t){zappar._messageReceiver.call(this,zappar._types.IMAGELOOKUP,e),this._collectionUrl="",t&&this.collectionUrl(t),this._lookupResolves=[]},zappar._imageLookup.methods={PARAM_COLLECTIONURL:50,METHOD_STARTLOOKUP:51},zappar._imageLookup.prototype=Object.create(zappar._base.prototype),zappar._imageLookup.prototype.constructor=zappar._imageLookup,zappar.ImageLookup=function(e){return new zappar._imageLookup(this,e)},zappar._imageLookup._statusMapping=["idle","preparing","posting","posting","posting","complete","error"],zappar._imageLookup.prototype._message=function(e){if("s"!==e[1])zappar._messageReceiver.prototype._message.call(this,e);else if(console.log("Got status:",e[2]),5===e[2]){this.emit("complete",e[3]);for(var t=0,a=this._lookupResolves.length;t<a;t++)this._lookupResolves[t][0](e[3]);this._lookupResolves=[]}else if(6===e[2]){this.emit("error");for(t=0,a=this._lookupResolves.length;t<a;t++)this._lookupResolves[t][1]();this._lookupResolves=[]}else this.emit(zappar._imageLookup._statusMapping[e[2]])},zappar._imageLookup.prototype.toString=function(){return"ImageLookup"},zappar._imageLookup.prototype.collectionUrl=function(e){return"string"==typeof e?(this._collectionUrl=e,zappar.sendMessage([this.refId,zappar._imageLookup.methods.PARAM_COLLECTIONURL,this._collectionUrl]),this):this._collectionUrl},zappar._imageLookup.prototype.startLookup=function(){var a=this;return new Promise(function(e,t){a._lookupResolves.push([e,t]),zappar.sendMessage([a.refId,zappar._imageLookup.methods.METHOD_STARTLOOKUP,null])})};